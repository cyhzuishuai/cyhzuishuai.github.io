<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="大帅哥">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="大帅哥">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="陈永辉">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>大帅哥</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">大帅哥</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day24%20%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E5%92%8C%E8%80%83%E8%AF%95/%E7%AC%94%E8%AE%B0/day24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day24%20%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E5%92%8C%E8%80%83%E8%AF%95/%E7%AC%94%E8%AE%B0/day24/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:32" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:32+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:35" itemprop="dateModified" datetime="2024-08-28T18:21:35+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day24-阶段总结"><a href="#day24-阶段总结" class="headerlink" title="day24 阶段总结"></a>day24 阶段总结</h1><p>课程目标：对第三模块   阶段的知识点进行总结和考试，让学员更好的掌握此模块的相关知识。</p>
<p>课程概要：</p>
<ul>
<li>知识补充</li>
<li>阶段总结（思维导图）</li>
<li>考试题</li>
</ul>
<h2 id="1-知识点补充"><a href="#1-知识点补充" class="headerlink" title="1. 知识点补充"></a>1. 知识点补充</h2><p>我们来分析如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process</span>(<span class="params">request, client_address</span>):</span><br><span class="line">    <span class="built_in">print</span>(request,client_address)</span><br><span class="line">    conn = request</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sk.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>,<span class="number">8002</span>))</span><br><span class="line">sk.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r, w, e = select.select([sk,],[],[],<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> sk <span class="keyword">in</span> r:</span><br><span class="line">        request, client_address = sk.accept()</span><br><span class="line">        t = threading.Thread(target=process, args=(request, client_address))</span><br><span class="line">        t.daemon = <span class="literal">False</span></span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">sk.close()</span><br></pre></td></tr></table></figure>

<p>上述代码集成了：线程、网络编程、IO多路复用，实现了一个支持并发的服务端（可以同时接受多个客户端的连接）。</p>
<p>socketserver，是Python中的内置模块。该模块内部基于线程、进程 + socket + IO多路复用，帮我们实现了上述的功能（写的更加严谨）。</p>
<ul>
<li><p>服务端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRequestHandler</span>(socketserver.BaseRequestHandler):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        conn = self.request</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;收到消息:&quot;</span>, data.decode(<span class="string">&#x27;utf-8&#x27;</span>), threading.current_thread())</span><br><span class="line">		conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = socketserver.ThreadingTCPServer((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">9000</span>), MyRequestHandler)</span><br><span class="line">obj.serve_forever()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">9000</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    content = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> content.upper() == <span class="string">&#x27;Q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    client.sendall(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>在很多的框架和模块中已集成了并发相关的内容，让程序员可以只关注业务功能的开发，避免重复造轮子了（Stop Trying to Reinvent the Wheel）。</p>
<h2 id="2-阶段总结"><a href="#2-阶段总结" class="headerlink" title="2. 阶段总结"></a>2. 阶段总结</h2><p>思维导图</p>
<h2 id="3-考试题"><a href="#3-考试题" class="headerlink" title="3. 考试题"></a>3. 考试题</h2><p>考试题的目的是让大家对自己近期知识点学习练习 以及 自测，请大家务必【独立】完成（切勿翻看笔记 &amp; 切勿网上搜索 ）。</p>
<ul>
<li><p>第一步：自己独立完成（编程题目可以在pycharm中编写）</p>
</li>
<li><p>第二步：做完之后，翻看自己笔记去修改和更正。</p>
</li>
<li><p>第三步：觉自己做的没问题了，最后再去看考试题的参考答案和讲解。</p>
</li>
</ul>
<p>详情见附件《第三阶段考试题.md》文件。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day23%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day23%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day23/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:32" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:32+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:34" itemprop="dateModified" datetime="2024-08-28T18:21:34+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day23-并发编程（下）"><a href="#day23-并发编程（下）" class="headerlink" title="day23 并发编程（下）"></a>day23 并发编程（下）</h1><p><img src="/2024/09/07/python_course-master/day23%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day23/image-20210226164423992.png" alt="image-20210226164423992"></p>
<p>课程目标：掌握多进程开发的相关知识点并初步认识协程。</p>
<p>今日概要：</p>
<ul>
<li>多进程开发</li>
<li>进程之间数据共享</li>
<li>进程锁</li>
<li>进程池</li>
<li>协程</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day23%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day23%20(copy)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day23%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day23%20(copy)/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:32" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:32+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:34" itemprop="dateModified" datetime="2024-08-28T18:21:34+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day23-并发编程（下）"><a href="#day23-并发编程（下）" class="headerlink" title="day23 并发编程（下）"></a>day23 并发编程（下）</h1><p><img src="/2024/09/07/python_course-master/day23%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day23%20(copy)/image-20210226164423992.png" alt="image-20210226164423992"></p>
<p>课程目标：掌握多进程开发的相关知识点并初步认识协程。</p>
<p>今日概要：</p>
<ul>
<li>多进程开发</li>
<li>进程之间数据共享</li>
<li>进程锁</li>
<li>进程池</li>
<li>协程</li>
</ul>
<h2 id="1-多进程开发"><a href="#1-多进程开发" class="headerlink" title="1. 多进程开发"></a>1. 多进程开发</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行中...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = Process(target=task, args=(<span class="string">&#x27;xxx&#x27;</span>,))</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;继续执行...&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行中...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    p = Process(target=task, args=(<span class="string">&#x27;xxx&#x27;</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;继续执行...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>



<p>进程的常见方法：</p>
<ul>
<li><p><code>p.start()</code>，当前进程准备就绪，等待被CPU调度（工作单元其实是进程中的线程）。</p>
</li>
<li><p><code>p.join()</code>，等待当前进程的任务执行完毕后再向下继续执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行中...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = Process(target=task, args=(<span class="string">&#x27;xxx&#x27;</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;继续执行...&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>p.daemon = 布尔值</code>，守护进程（必须放在start之前）</p>
<ul>
<li><code>p.daemon =True</code>，设置为守护进程，主进程执行完毕后，子进程也自动关闭。</li>
<li><code>p.daemon =False</code>，设置为非守护进程，主进程等待子进程，子进程执行完毕后，主进程才结束。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行中...&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = Process(target=task, args=(<span class="string">&#x27;xxx&#x27;</span>,))</span><br><span class="line">    p.daemon = <span class="literal">True</span></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;继续执行...&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>进程的名称的设置和获取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;当前进程的名称：&quot;</span>, multiprocessing.current_process().name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = multiprocessing.Process(target=task, args=(<span class="string">&#x27;xxx&#x27;</span>,))</span><br><span class="line">    p.name = <span class="string">&quot;哈哈哈哈&quot;</span></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;继续执行...&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义进程类，直接将线程需要做的事写到run方法中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyProcess</span>(multiprocessing.Process):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;执行此进程&#x27;</span>, self._args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = MyProcess(args=(<span class="string">&#x27;xxx&#x27;</span>,))</span><br><span class="line">    p.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;继续执行...&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-进程数据共享"><a href="#2-进程数据共享" class="headerlink" title="2. 进程数据共享"></a>2. 进程数据共享</h2><p>进程是资源分配的最小单元，每个进程中都维护自己独立的数据，不共享。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        data.append(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;子进程中处理后的结果：&quot;</span>, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    data_list = []</span><br><span class="line">    p = multiprocessing.Process(target=task, args=(data_list,))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;主进程：&quot;</span>, data_list)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果想让进程间做数据共享，可以借助一些特殊的数据类型，例如：</p>
<ul>
<li><p>Value</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">n</span>):</span><br><span class="line">    n.value = <span class="number">3.1415927</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    num = Value(<span class="string">&#x27;d&#x27;</span>, <span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line">    p = Process(target=f, args=(num,))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(num.value)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x27;c&#x27;: ctypes.c_char,  &#x27;u&#x27;: ctypes.c_wchar,</span><br><span class="line">&#x27;b&#x27;: ctypes.c_byte,  &#x27;B&#x27;: ctypes.c_ubyte,</span><br><span class="line">&#x27;h&#x27;: ctypes.c_short, &#x27;H&#x27;: ctypes.c_ushort,</span><br><span class="line">&#x27;i&#x27;: ctypes.c_int,   &#x27;I&#x27;: ctypes.c_uint,</span><br><span class="line">&#x27;l&#x27;: ctypes.c_long,  &#x27;L&#x27;: ctypes.c_ulong,</span><br><span class="line">&#x27;f&#x27;: ctypes.c_float, &#x27;d&#x27;: ctypes.c_double</span><br></pre></td></tr></table></figure>
</li>
<li><p>Manager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A manager object returned by Manager() controls a server process which holds Python objects and allows other processes to manipulate them using proxies.</span><br><span class="line"></span><br><span class="line">A manager returned by Manager() will support types list, dict, Namespace, Lock, RLock, Semaphore, BoundedSemaphore, Condition, Event, Barrier, Queue, Value and Array. For example,</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        data.append(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;子进程中处理后的结果：&quot;</span>, data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager = multiprocessing.Manager()</span><br><span class="line">    data_list = manager.<span class="built_in">list</span>()</span><br><span class="line"></span><br><span class="line">    p = multiprocessing.Process(target=task, args=(data_list,))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;主进程：&quot;</span>, data_list)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>multiprocessing.Queue</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">q</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        q.put(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    queue = multiprocessing.Queue()</span><br><span class="line">    p = multiprocessing.Process(target=task, args=(queue,))</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;主进程&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(queue.get())</span><br><span class="line">    <span class="built_in">print</span>(queue.get())</span><br><span class="line">    <span class="built_in">print</span>(queue.get())</span><br><span class="line">    <span class="built_in">print</span>(queue.get())</span><br><span class="line">    <span class="built_in">print</span>(queue.get())</span><br></pre></td></tr></table></figure>
</li>
<li><p>multiprocessing.Pipe</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">conn</span>):</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    conn.send([<span class="number">111</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>])</span><br><span class="line">    data = conn.recv() <span class="comment"># 阻塞</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;子进程接收:&quot;</span>, data)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parent_conn, child_conn = multiprocessing.Pipe()</span><br><span class="line"></span><br><span class="line">    p = multiprocessing.Process(target=task, args=(child_conn,))</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    info = parent_conn.recv() <span class="comment"># 阻塞</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;主进程接收：&quot;</span>, info)</span><br><span class="line">    parent_conn.send(<span class="number">666</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>上述都是Python内部提供的进程之间数据共享的机制，作为了解即刻。一般在项目开发中很少使用，后期项目中一般会借助第三方的来做资源的共享，例如：MySQL、redis等。</p>
<p><img src="/2024/09/07/python_course-master/day23%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day23%20(copy)/image-20210220051730124.png" alt="image-20210220051730124"></p>
<h2 id="3-进程锁"><a href="#3-进程锁" class="headerlink" title="3. 进程锁"></a>3. 进程锁</h2><p>如果多个进程抢占式去做某些操作时候，为了防止操作出问题，可以通过进程锁来避免。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="comment"># 假设文件中保存的内容就是一个值：10</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        current_num = <span class="built_in">int</span>(f.read())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;排队抢票了&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    current_num -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(current_num))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        p = multiprocessing.Process(target=task)</span><br><span class="line">        p.start()</span><br></pre></td></tr></table></figure>



<p>很显然，多进程在操作时就会出问题，此时就需要锁来介入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">lock</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="comment"># 假设文件中保存的内容就是一个值：10</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        current_num = <span class="built_in">int</span>(f.read())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;排队抢票了&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    current_num -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(current_num))</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    lock = multiprocessing.RLock()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        p = multiprocessing.Process(target=task, args=(lock,))</span><br><span class="line">        p.start()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">10</span>) <span class="comment"># windows系统是spawn模式创建的进程，需要特殊处理。（window系统）- 【也可以通过join等待】</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">lock</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    lock.acquire()</span><br><span class="line">    <span class="comment"># 假设文件中保存的内容就是一个值：10</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        current_num = <span class="built_in">int</span>(f.read())</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;排队抢票了&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    current_num -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="built_in">str</span>(current_num))</span><br><span class="line">    lock.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    multiprocessing.set_start_method(<span class="string">&#x27;fork&#x27;</span>) <span class="comment"># Linux系统fork；mac支持：fork和spawn（python3.8默认设置spawn）。</span></span><br><span class="line">    lock = multiprocessing.RLock()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        p = multiprocessing.Process(target=task, args=(lock,))</span><br><span class="line">        p.start()</span><br></pre></td></tr></table></figure>



<h2 id="4-进程池"><a href="#4-进程池" class="headerlink" title="4. 进程池"></a>4. 进程池</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.process <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行&quot;</span>, num)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    pool = ProcessPoolExecutor(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        pool.submit(task, i)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.process <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行&quot;</span>, num)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    pool = ProcessPoolExecutor(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        pool.submit(task, i)</span><br><span class="line">    pool.shutdown(<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.process <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行&quot;</span>, num)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">done</span>(<span class="params">res</span>):</span><br><span class="line">    <span class="built_in">print</span>(multiprocessing.current_process())</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(res.result())</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    pool = ProcessPoolExecutor(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        fur = pool.submit(task, i)</span><br><span class="line">        fur.add_done_callback(done) <span class="comment"># done的调用由主进程处理（与线程池不同）</span></span><br><span class="line">        </span><br><span class="line">    <span class="built_in">print</span>(multiprocessing.current_process())</span><br><span class="line">    pool.shutdown(<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>注意：如果在线程池中要使用线程锁，则需要结束Manager中的Lock和RLock。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.process <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">lock</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> lock:</span><br><span class="line">        <span class="comment"># 假设文件中保存的内容就是一个值：10</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            current_num = <span class="built_in">int</span>(f.read())</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;排队抢票了&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        current_num -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;f1.txt&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(<span class="built_in">str</span>(current_num))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pool = ProcessPoolExecutor()</span><br><span class="line">    <span class="comment"># lock_object = multiprocessing.RLock() # 不能使用</span></span><br><span class="line">    m = multiprocessing.Manager()</span><br><span class="line">    lock_object = m.RLock()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        pool.submit(task, lock_object)</span><br></pre></td></tr></table></figure>



<h2 id="5-协程"><a href="#5-协程" class="headerlink" title="5. 协程"></a>5. 协程</h2><p>计算机中提供了：线程、进程 用于实现并发编程（真实存在）。</p>
<p>协程（Coroutine），是程序员通过代码搞出来的一个东西（非真实存在）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">协程也可以被称为微线程，是一种用户态内的上下文切换技术。</span><br><span class="line">简而言之，其实就是通过一个线程实现代码块相互切换执行。</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">def func1():</span><br><span class="line">    print(1)</span><br><span class="line">    ...</span><br><span class="line">    print(2)</span><br><span class="line">def func2():</span><br><span class="line">    print(3)</span><br><span class="line">    ...</span><br><span class="line">    print(4)</span><br><span class="line">func1()</span><br><span class="line">func2()</span><br></pre></td></tr></table></figure>

<p>上述代码是普通的函数定义和执行，按流程分别执行两个函数中的代码，并先后会输出：<code>1、2、3、4</code>。</p>
<p>但如果介入协程技术那么就可以实现函数见代码切换执行，最终输入：<code>1、3、2、4</code> 。</p>
<p>在Python中有多种方式可以实现协程，例如：</p>
<ul>
<li><p>greenlet</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)        <span class="comment"># 第1步：输出 1</span></span><br><span class="line">    gr2.switch()    <span class="comment"># 第3步：切换到 func2 函数</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)        <span class="comment"># 第6步：输出 2</span></span><br><span class="line">    gr2.switch()    <span class="comment"># 第7步：切换到 func2 函数，从上一次执行的位置继续向后执行</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">3</span>)        <span class="comment"># 第4步：输出 3</span></span><br><span class="line">    gr1.switch()    <span class="comment"># 第5步：切换到 func1 函数，从上一次执行的位置继续向后执行</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">4</span>)        <span class="comment"># 第8步：输出 4</span></span><br><span class="line">gr1 = greenlet(func1)</span><br><span class="line">gr2 = greenlet(func2)</span><br><span class="line">gr1.switch() <span class="comment"># 第1步：去执行 func1 函数</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>yield</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> func2()</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line">    </span><br><span class="line">f1 = func1()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> f1:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>虽然上述两种都实现了协程，但这种编写代码的方式没啥意义。</p>
<p>这种来回切换执行，可能反倒让程序的执行速度更慢了（相比较于串行）。</p>
<p><strong>协程如何才能更有意义呢？</strong></p>
<blockquote>
<p>不要让用户手动去切换，而是遇到IO操作时能自动切换。</p>
<p>Python在3.4之后推出了asyncio模块 + Python3.5推出async、async语法 ，内部基于协程并且遇到IO请求自动化切换。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">4</span>)</span><br><span class="line">    </span><br><span class="line">tasks = [</span><br><span class="line">    asyncio.ensure_future(func1()),</span><br><span class="line">    asyncio.ensure_future(func2())</span><br><span class="line">]</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">需要先安装：pip3 install aiohttp</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">session, url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;发送请求：&quot;</span>, url)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(url, verify_ssl=<span class="literal">False</span>) <span class="keyword">as</span> response:</span><br><span class="line">        content = <span class="keyword">await</span> response.content.read()</span><br><span class="line">        file_name = url.rsplit(<span class="string">&#x27;_&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">            file_object.write(content)</span><br><span class="line">            </span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        url_list = [</span><br><span class="line">            <span class="string">&#x27;https://www3.autoimg.cn/newsdfs/g26/M02/35/A9/120x90_0_autohomecar__ChsEe12AXQ6AOOH_AAFocMs8nzU621.jpg&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://www2.autoimg.cn/newsdfs/g30/M01/3C/E2/120x90_0_autohomecar__ChcCSV2BBICAUntfAADjJFd6800429.jpg&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://www3.autoimg.cn/newsdfs/g26/M0B/3C/65/120x90_0_autohomecar__ChcCP12BFCmAIO83AAGq7vK0sGY193.jpg&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">        tasks = [asyncio.create_task(fetch(session, url)) <span class="keyword">for</span> url <span class="keyword">in</span> url_list]</span><br><span class="line">        <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>



<p>通过上述内容发现，在处理IO请求时，协程通过一个线程就可以实现并发的操作。</p>
<p><strong>协程、线程、进程的区别？</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">线程，是计算机中可以被cpu调度的最小单元。</span><br><span class="line">进程，是计算机资源分配的最小单元（进程为线程提供资源）。</span><br><span class="line"></span><br><span class="line">一个进程中可以有多个线程,同一个进程中的线程可以共享此进程中的资源。</span><br><span class="line"></span><br><span class="line">由于CPython中GIL的存在：</span><br><span class="line">	- 线程，适用于IO密集型操作。</span><br><span class="line">    - 进程，适用于计算密集型操作。</span><br><span class="line"></span><br><span class="line">协程，协程也可以被称为微线程，是一种用户态内的上下文切换技术，在开发中结合遇到IO自动切换，就可以通过一个线程实现并发操作。</span><br><span class="line">所以，在处理IO操作时，协程比线程更加节省开销（协程的开发难度大一些）。</span><br></pre></td></tr></table></figure>



<p>现在很多Python中的框架都在支持协程，比如：FastAPI、Tornado、Sanic、Django 3、aiohttp等，企业开发使用的也越来越多（目前不是特别多）。</p>
<p>关于协程，目前同学们先了解这些概念即可，更深入的开发、应用 暂时不必过多了解，等大家学了Web框架和爬虫相关知识之后，再来学习和补充效果更佳。有兴趣想要研究的同学可以参考我写的文章和专题视频：</p>
<ul>
<li><p>文章</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://pythonav.com/wiki/detail/<span class="number">6</span>/<span class="number">91</span>/</span><br><span class="line">https://zhuanlan.zhihu.com/p/<span class="number">137057192</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>视频</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/video/BV1NA411g7yf</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>掌握进程和进程池的操作</li>
<li>进程之间数据共享</li>
<li>进程锁</li>
<li>协程、进程、线程的区别</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day22%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day22%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day22/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:32" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:32+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:34" itemprop="dateModified" datetime="2024-08-28T18:21:34+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day22-并发编程（上）"><a href="#day22-并发编程（上）" class="headerlink" title="day22 并发编程（上）"></a>day22 并发编程（上）</h1><img src="/2024/09/07/python_course-master/day22%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day22/image-20210224144810148.png" alt="image-20210224144810148">

<p><strong>网络编程</strong>，了解网络相关的<strong>知识点</strong>并且要知道几乎所有网络的通信本质上都是通过socket模块实现。例如：网站、网络爬虫。</p>
<p><strong>并发编程</strong>，提升代码执行的效率。原来代码执行需要20分钟，学习并发编程后可以加快到1分钟执行完毕。</p>
<p>今日课程目标：初步了解进程和线程并可以基于线程实现并发编程。</p>
<p>今日概要：</p>
<ul>
<li>初识进程和线程</li>
<li>多线程开发</li>
<li>线程安全</li>
<li>线程锁</li>
<li>死锁</li>
<li>线程池</li>
</ul>
<h2 id="1-进程和线程"><a href="#1-进程和线程" class="headerlink" title="1. 进程和线程"></a>1. 进程和线程</h2><p>先来了解下进程和线程。</p>
<p>类比：</p>
<ul>
<li><p>一个<strong>工厂</strong>，至少有一个<strong>车间</strong>，一个车间中至少有一个<strong>工人</strong>，最终是工人在工作。</p>
</li>
<li><p>一个<strong>程序</strong>，至少有一个<strong>进程</strong>，一个进程中至少有一个<strong>线程</strong>，最终是线程在工作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上述串行的代码示例就是一个程序，在使用python xx.py 运行时，内部就创建一个进程（主进程），在进程中创建了一个线程（主线程），由线程逐行运行代码。</span><br></pre></td></tr></table></figure></li>
</ul>
<p>进程和线程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">线程，是计算机中可以被cpu调度的最小单元(真正在工作）。</span><br><span class="line">进程，是计算机资源分配的最小单元（进程为线程提供资源）。</span><br><span class="line"></span><br><span class="line">一个进程中可以有多个线程,同一个进程中的线程可以共享此进程中的资源。</span><br></pre></td></tr></table></figure>



<p>以前我们开发的程序中所有的行为都只能通过串行的形式运行，排队逐一执行，前面未完成，后面也无法继续。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">result = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">    result += i</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url_list = [</span><br><span class="line">    (<span class="string">&quot;东北F4模仿秀.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0300f570000bvbmace0gvch7lo53oog&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;卡特扣篮.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f3e0000bv52fpn5t6p007e34q1g&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;罗斯mvp.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(time.time())</span><br><span class="line"><span class="keyword">for</span> file_name, url <span class="keyword">in</span> url_list:</span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(res.content)</span><br><span class="line">    <span class="built_in">print</span>(file_name, time.time())</span><br></pre></td></tr></table></figure>

<p>通过 <strong>进程</strong> 和 <strong>线程</strong> 都可以将 <code>串行</code> 的程序变为<code>并发</code>，对于上述示例来说就是同时下载三个视频，这样很短的时间内就可以下载完成。</p>
<h3 id="1-1-多线程"><a href="#1-1-多线程" class="headerlink" title="1.1 多线程"></a>1.1 多线程</h3><p>基于多线程对上述串行示例进行优化：</p>
<ul>
<li>一个<strong>工厂</strong>，创建一个<strong>车间</strong>，这个车间中创建 <strong>3个工人</strong>，并行处理任务。</li>
<li>一个<strong>程序</strong>，创建一个<strong>进程</strong>，这个进程中创建 <strong>3个线程</strong>，并行处理任务。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url_list = [</span><br><span class="line">    (<span class="string">&quot;东北F4模仿秀.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0300f570000bvbmace0gvch7lo53oog&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;卡特扣篮.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f3e0000bv52fpn5t6p007e34q1g&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;罗斯mvp.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file_name, url <span class="keyword">in</span> url_list:</span><br><span class="line">    res = requests.get(url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(res.content)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">def func(a1,a2,a3):</span></span><br><span class="line"><span class="string">    pass</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">t = threaing.Thread(target=func,args=(11,22,33))</span></span><br><span class="line"><span class="string">t.start()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">url_list = [</span><br><span class="line">    (<span class="string">&quot;东北F4模仿秀.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0300f570000bvbmace0gvch7lo53oog&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;卡特扣篮.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f3e0000bv52fpn5t6p007e34q1g&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;罗斯mvp.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">file_name, video_url</span>):</span><br><span class="line">    res = requests.get(video_url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(res.content)</span><br><span class="line">    <span class="built_in">print</span>(time.time())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, url <span class="keyword">in</span> url_list:</span><br><span class="line">    <span class="comment"># 创建线程，让每个线程都去执行task函数（参数不同）</span></span><br><span class="line">    t = threading.Thread(target=task, args=(name, url))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>



<h3 id="1-2-多进程"><a href="#1-2-多进程" class="headerlink" title="1.2 多进程"></a>1.2 多进程</h3><p>基于多进程对上述串行示例进行优化：</p>
<ul>
<li>一个<strong>工厂</strong>，创建 <strong>三个车间</strong>，每个车间 <strong>一个工人（共3人）</strong>，并行处理任务。</li>
<li>一个<strong>程序</strong>，创建 <strong>三个进程</strong>，每个进程 <strong>一个线程（共3人）</strong>，并行处理任务。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程创建之后，在进程中还会创建一个线程。</span></span><br><span class="line"><span class="comment"># t = multiprocessing.Process(target=函数名, args=(name, url))</span></span><br><span class="line"><span class="comment"># t.start()</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">url_list = [</span><br><span class="line">    (<span class="string">&quot;东北F4模仿秀.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0300f570000bvbmace0gvch7lo53oog&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;卡特扣篮.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f3e0000bv52fpn5t6p007e34q1g&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;罗斯mvp.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">file_name, video_url</span>):</span><br><span class="line">    res = requests.get(video_url)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(res.content)</span><br><span class="line">    <span class="built_in">print</span>(time.time())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(time.time())</span><br><span class="line">    <span class="keyword">for</span> name, url <span class="keyword">in</span> url_list:</span><br><span class="line">        t = multiprocessing.Process(target=task, args=(name, url))</span><br><span class="line">        t.start()</span><br></pre></td></tr></table></figure>



<p>综上所述，大家会发现 <strong>多进程</strong> 的开销比 <strong>多线程</strong> 的开销大。哪是不是使用多线程要比多进程更好呀？</p>
<p>接下来，给大家再来介绍一个Python内置的GIL锁的知识，然后再根据 进程 和 线程 各自的特点总结各自适合应用场景。</p>
<h3 id="1-3-GIL锁"><a href="#1-3-GIL锁" class="headerlink" title="1.3 GIL锁"></a>1.3 GIL锁</h3><p>GIL， 全局解释器锁（Global Interpreter Lock），是CPython解释器特有一个玩意，让一个进程中同一个时刻只能有一个线程可以被CPU调用。</p>
<p><img src="/2024/09/07/python_course-master/day22%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day22/image-20210218184651385.png" alt="image-20210218184651385"></p>
<p>如果程序想利用 计算机的多核优势，让CPU同时处理一些任务，适合用多进程开发（即使资源开销大）。</p>
<p><img src="/2024/09/07/python_course-master/day22%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day22/image-20210218185849637.png" alt="image-20210218185849637"></p>
<p>如果程序不利用 计算机的多核优势，适合用多线程开发。</p>
<p><img src="/2024/09/07/python_course-master/day22%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day22/image-20210218185953326.png" alt="image-20210218185953326"></p>
<p>常见的程序开发中，计算操作需要使用CPU多核优势，IO操作不需要利用CPU的多核优势，所以，就有这一句话：</p>
<ul>
<li>计算密集型，用多进程，例如：大量的数据计算【累加计算示例】。</li>
<li>IO密集型，用多线程，例如：文件读写、网络数据传输【下载抖音视频示例】。</li>
</ul>
<p>累加计算示例（计算密集型）：</p>
<ul>
<li><p>串行处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"></span><br><span class="line">result = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">    result += i</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;耗时：&quot;</span>, end - start) <span class="comment"># 耗时： 9.522780179977417</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>多进程处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">start, end, queue</span>):</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start, end):</span><br><span class="line">        result += i</span><br><span class="line">    queue.put(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    queue = multiprocessing.Queue()</span><br><span class="line"></span><br><span class="line">    start_time = time.time()</span><br><span class="line"></span><br><span class="line">    p1 = multiprocessing.Process(target=task, args=(<span class="number">0</span>, <span class="number">50000000</span>, queue))</span><br><span class="line">    p1.start()</span><br><span class="line"></span><br><span class="line">    p2 = multiprocessing.Process(target=task, args=(<span class="number">50000000</span>, <span class="number">100000000</span>, queue))</span><br><span class="line">    p2.start()</span><br><span class="line"></span><br><span class="line">    v1 = queue.get(block=<span class="literal">True</span>)</span><br><span class="line">    v2 = queue.get(block=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(v1 + v2)</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;耗时:&quot;</span>, end_time - start_time) <span class="comment"># 耗时: 2.6232550144195557</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>当然，在程序开发中 多线程 和 多进程 是可以结合使用，例如：创建2个进程（建议与CPU个数相同），每个进程中创建3个线程。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">thread_task</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">start, end</span>):</span><br><span class="line">    t1 = threading.Thread(target=thread_task)</span><br><span class="line">    t1.start()</span><br><span class="line"></span><br><span class="line">    t2 = threading.Thread(target=thread_task)</span><br><span class="line">    t2.start()</span><br><span class="line"></span><br><span class="line">    t3 = threading.Thread(target=thread_task)</span><br><span class="line">    t3.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p1 = multiprocessing.Process(target=task, args=(<span class="number">0</span>, <span class="number">50000000</span>))</span><br><span class="line">    p1.start()</span><br><span class="line"></span><br><span class="line">    p2 = multiprocessing.Process(target=task, args=(<span class="number">50000000</span>, <span class="number">100000000</span>))</span><br><span class="line">    p2.start()</span><br></pre></td></tr></table></figure>





<h2 id="2-多线程开发"><a href="#2-多线程开发" class="headerlink" title="2. 多线程开发"></a>2. 多线程开发</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个Thread对象（线程），并封装线程被CPU调度时应该执行的任务和相关参数。</span></span><br><span class="line">t = threading.Thread(target=task,args=(<span class="string">&#x27;xxx&#x27;</span>,))</span><br><span class="line"><span class="comment"># 线程准备就绪（等待CPU调度），代码继续向下执行。</span></span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;继续执行...&quot;</span>) <span class="comment"># 主线程执行完所有代码，不结束（等待子线程）</span></span><br></pre></td></tr></table></figure>



<p>线程的常见方法：</p>
<ul>
<li><p><code>t.start()</code>，当前线程准备就绪（等待CPU调度，具体时间是由CPU来决定）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">loop = <span class="number">10000000</span></span><br><span class="line">number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>(<span class="params">count</span>):</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">t = threading.Thread(target=_add,args=(loop,))</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>t.join()</code>，等待当前线程的任务执行完毕后再向下继续执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>():</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">t = threading.Thread(target=_add)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line">t.join() <span class="comment"># 主线程等待中...</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>():</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_sub</span>():</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000000</span>):</span><br><span class="line">        number -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=_add)</span><br><span class="line">t2 = threading.Thread(target=_sub)</span><br><span class="line">t1.start()</span><br><span class="line">t1.join()  <span class="comment"># t1线程执行完毕,才继续往后走</span></span><br><span class="line">t2.start()</span><br><span class="line">t2.join()  <span class="comment"># t2线程执行完毕,才继续往后走</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">loop = <span class="number">10000000</span></span><br><span class="line">number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>(<span class="params">count</span>):</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_sub</span>(<span class="params">count</span>):</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        number -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=_add, args=(loop,))</span><br><span class="line">t2 = threading.Thread(target=_sub, args=(loop,))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()  <span class="comment"># t1线程执行完毕,才继续往后走</span></span><br><span class="line">t2.join()  <span class="comment"># t2线程执行完毕,才继续往后走</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>t.setDaemon(布尔值)</code> ，守护线程（必须放在start之前）</p>
<ul>
<li><code>t.setDaemon(True)</code>，设置为守护线程，主线程执行完毕后，子线程也自动关闭。</li>
<li><code>t.setDaemon(False)</code>，设置为非守护线程，主线程等待子线程，子线程执行完毕后，主线程才结束。（默认）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;任务&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t = threading.Thread(target=task, args=(<span class="number">11</span>,))</span><br><span class="line">t.setDaemon(<span class="literal">True</span>) <span class="comment"># True/False</span></span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;END&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>线程名称的设置和获取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">arg</span>):</span><br><span class="line">    <span class="comment"># 获取当前执行此代码的线程</span></span><br><span class="line">    name = threading.current_thread().getName()</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task, args=(<span class="number">11</span>,))</span><br><span class="line">    t.setName(<span class="string">&#x27;日魔-&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义线程类，直接将线程需要做的事写到run方法中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span>(threading.Thread):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;执行此线程&#x27;</span>, self._args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = MyThread(args=(<span class="number">100</span>,))</span><br><span class="line">t.start()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DouYinThread</span>(threading.Thread):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        file_name, video_url = self._args</span><br><span class="line">        res = requests.get(video_url)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(res.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url_list = [</span><br><span class="line">    (<span class="string">&quot;东北F4模仿秀.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0300f570000bvbmace0gvch7lo53oog&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;卡特扣篮.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f3e0000bv52fpn5t6p007e34q1g&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;罗斯mvp.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span>)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> url_list:</span><br><span class="line">    t = DouYinThread(args=(item[<span class="number">0</span>], item[<span class="number">1</span>]))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-线程安全"><a href="#3-线程安全" class="headerlink" title="3. 线程安全"></a>3. 线程安全</h2><p>一个进程中可以有多个线程，且线程共享所有进程中的资源。</p>
<p>多个线程同时去操作一个”东西”，<strong>可能</strong>会存在数据混乱的情况，例如：</p>
<ul>
<li><p>示例1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">loop = <span class="number">10000000</span></span><br><span class="line">number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>(<span class="params">count</span>):</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_sub</span>(<span class="params">count</span>):</span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        number -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=_add, args=(loop,))</span><br><span class="line">t2 = threading.Thread(target=_sub, args=(loop,))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()  <span class="comment"># t1线程执行完毕,才继续往后走</span></span><br><span class="line">t2.join()  <span class="comment"># t2线程执行完毕,才继续往后走</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">lock_object = threading.RLock()</span><br><span class="line"></span><br><span class="line">loop = <span class="number">10000000</span></span><br><span class="line">number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>(<span class="params">count</span>):</span><br><span class="line">    lock_object.acquire() <span class="comment"># 加锁</span></span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line">    lock_object.release() <span class="comment"># 释放锁</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_sub</span>(<span class="params">count</span>):</span><br><span class="line">    lock_object.acquire() <span class="comment"># 申请锁（等待）</span></span><br><span class="line">    <span class="keyword">global</span> number</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        number -= <span class="number">1</span></span><br><span class="line">    lock_object.release() <span class="comment"># 释放锁</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=_add, args=(loop,))</span><br><span class="line">t2 = threading.Thread(target=_sub, args=(loop,))</span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br><span class="line"></span><br><span class="line">t1.join()  <span class="comment"># t1线程执行完毕,才继续往后走</span></span><br><span class="line">t2.join()  <span class="comment"># t2线程执行完毕,才继续往后走</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(number)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>示例2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">lock_object = threading.RLock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    lock_object.acquire()  <span class="comment"># 第1个抵达的线程进入并上锁，其他线程就需要再此等待。</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    lock_object.release()  <span class="comment"># 线程出去，并解开锁，其他线程就可以进入并执行了</span></span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">lock_object = threading.RLock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> lock_object: <span class="comment"># 基于上下文管理，内部自动执行 acquire 和 release</span></span><br><span class="line">        <span class="keyword">global</span> num</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">            num += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>在开发的过程中要注意有些操作默认都是 线程安全的（内部集成了锁的机制），我们在使用的时无需再通过锁再处理，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">data_list = []</span><br><span class="line"></span><br><span class="line">lock_object = threading.RLock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        data_list.append(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(data_list))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day22%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day22/image-20210225102151570.png" alt="image-20210225102151570"></p>
<p>所以，要多注意看一些开发文档中是否标明线程安全。</p>
<h2 id="4-线程锁"><a href="#4-线程锁" class="headerlink" title="4. 线程锁"></a>4. 线程锁</h2><p>在程序中如果想要自己手动加锁，一般有两种：Lock 和 RLock。</p>
<ul>
<li><p>Lock，同步锁。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">lock_object = threading.Lock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    lock_object.acquire()  <span class="comment"># 第1个抵达的线程进入并上锁，其他线程就需要再此等待。</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    lock_object.release()  <span class="comment"># 线程出去，并解开锁，其他线程就可以进入并执行了</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>RLock，递归锁。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">lock_object = threading.RLock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    lock_object.acquire()  <span class="comment"># 第1个抵达的线程进入并上锁，其他线程就需要再此等待。</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    lock_object.release()  <span class="comment"># 线程出去，并解开锁，其他线程就可以进入并执行了</span></span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>RLock支持多次申请锁和多次释放；Lock不支持。例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">lock_object = threading.RLock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    lock_object.acquire()</span><br><span class="line">    lock_object.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">123</span>)</span><br><span class="line">    lock_object.release()</span><br><span class="line">    lock_object.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">lock = threading.RLock()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序员A开发了一个函数，函数可以被其他开发者调用，内部需要基于锁保证数据安全。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">	<span class="keyword">with</span> lock:</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 程序员B开发了一个函数，可以直接调用这个函数。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他功能&quot;</span>)</span><br><span class="line">    func() <span class="comment"># 调用程序员A写的func函数，内部用到了锁。</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;其他功能&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 程序员C开发了一个函数，自己需要加锁，同时也需要调用func函数。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process</span>():</span><br><span class="line">    <span class="keyword">with</span> lock:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;其他功能&quot;</span>)</span><br><span class="line">        func() <span class="comment"># ----------------&gt; 此时就会出现多次锁的情况，只有RLock支持（Lock不支持）。</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;其他功能&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="5-死锁"><a href="#5-死锁" class="headerlink" title="5.死锁"></a>5.死锁</h2><p>死锁，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">lock_object = threading.Lock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始&quot;</span>)</span><br><span class="line">    lock_object.acquire()  <span class="comment"># 第1个抵达的线程进入并上锁，其他线程就需要再此等待。</span></span><br><span class="line">    lock_object.acquire()  <span class="comment"># 第1个抵达的线程进入并上锁，其他线程就需要再此等待。</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    lock_object.release()  <span class="comment"># 线程出去，并解开锁，其他线程就可以进入并执行了</span></span><br><span class="line">    lock_object.release()  <span class="comment"># 线程出去，并解开锁，其他线程就可以进入并执行了</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line">lock_1 = threading.Lock()</span><br><span class="line">lock_2 = threading.Lock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task1</span>():</span><br><span class="line">    lock_1.acquire()</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    lock_2.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">11</span>)</span><br><span class="line">    lock_2.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">111</span>)</span><br><span class="line">    lock_1.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1111</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task2</span>():</span><br><span class="line">    lock_2.acquire()</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    lock_1.acquire()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">22</span>)</span><br><span class="line">    lock_1.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">222</span>)</span><br><span class="line">    lock_2.release()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2222</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = threading.Thread(target=task1)</span><br><span class="line">t1.start()</span><br><span class="line"></span><br><span class="line">t2 = threading.Thread(target=task2)</span><br><span class="line">t2.start()</span><br></pre></td></tr></table></figure>



<h2 id="6-线程池"><a href="#6-线程池" class="headerlink" title="6.线程池"></a>6.线程池</h2><p>Python3中官方才正式提供线程池。</p>
<p>线程不是开的越多越好，开的多了可能会导致系统的性能更低了，例如：如下的代码是不推荐在项目开发中编写。</p>
<p><strong>不建议</strong>：无限制的创建线程。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">video_url</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">url_list = [<span class="string">&quot;www.xxxx-&#123;&#125;.com&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30000</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line">    t = threading.Thread(target=task, args=(url,))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这种每次都创建一个线程去操作，创建任务的太多，线程就会特别多，可能效率反倒降低了。</span></span><br></pre></td></tr></table></figure>

<p><strong>建议</strong>：使用线程池</p>
<p>示例1：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="comment"># pool = ThreadPoolExecutor(100)</span></span><br><span class="line"><span class="comment"># pool.submit(函数名,参数1，参数2，参数...)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">video_url,num</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始执行任务&quot;</span>, video_url)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程池，最多维护10个线程。</span></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">url_list = [<span class="string">&quot;www.xxxx-&#123;&#125;.com&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">300</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line">    <span class="comment"># 在线程池中提交一个任务，线程池中如果有空闲线程，则分配一个线程去执行，执行完毕后再将线程交还给线程池；如果没有空闲线程，则等待。</span></span><br><span class="line">    pool.submit(task, url,<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;END&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>示例2：等待线程池的任务执行完毕。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">video_url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始执行任务&quot;</span>, video_url)</span><br><span class="line">    time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程池，最多维护10个线程。</span></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">url_list = [<span class="string">&quot;www.xxxx-&#123;&#125;.com&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">300</span>)]</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line">    <span class="comment"># 在线程池中提交一个任务，线程池中如果有空闲线程，则分配一个线程去执行，执行完毕后再将线程交还给线程池；如果没有空闲线程，则等待。</span></span><br><span class="line">    pool.submit(task, url)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;执行中...&quot;</span>)</span><br><span class="line">pool.shutdown(<span class="literal">True</span>)  <span class="comment"># 等待线程池中的任务执行完毕后，在继续执行</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;继续往下走&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>示例3：任务执行完任务，再干点其他事。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, Future</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">video_url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始执行任务&quot;</span>, video_url)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> random.randint(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">done</span>(<span class="params">response</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;任务执行后的返回值&quot;</span>, response.result())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程池，最多维护10个线程。</span></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">url_list = [<span class="string">&quot;www.xxxx-&#123;&#125;.com&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line">    <span class="comment"># 在线程池中提交一个任务，线程池中如果有空闲线程，则分配一个线程去执行，执行完毕后再将线程交还给线程池；如果没有空闲线程，则等待。</span></span><br><span class="line">    future = pool.submit(task, url)</span><br><span class="line">    future.add_done_callback(done) <span class="comment"># 是子主线程执行</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 可以做分工，例如：task专门下载，done专门将下载的数据写入本地文件。</span></span><br></pre></td></tr></table></figure>



<p>示例4：最终统一获取结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor,Future</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>(<span class="params">video_url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始执行任务&quot;</span>, video_url)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> random.randint(<span class="number">0</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程池，最多维护10个线程。</span></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">future_list = []</span><br><span class="line"></span><br><span class="line">url_list = [<span class="string">&quot;www.xxxx-&#123;&#125;.com&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>)]</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> url_list:</span><br><span class="line">    <span class="comment"># 在线程池中提交一个任务，线程池中如果有空闲线程，则分配一个线程去执行，执行完毕后再将线程交还给线程池；如果没有空闲线程，则等待。</span></span><br><span class="line">    future = pool.submit(task, url)</span><br><span class="line">    future_list.append(future)</span><br><span class="line">    </span><br><span class="line">pool.shutdown(<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> fu <span class="keyword">in</span> future_list:</span><br><span class="line">    <span class="built_in">print</span>(fu.result())</span><br></pre></td></tr></table></figure>



<p>案例：基于线程池下载豆瓣图片。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">26044585,Hush,https://hbimg.huabanimg.com/51d46dc32abe7ac7f83b94c67bb88cacc46869954f478-aP4Q3V</span><br><span class="line">19318369,柒十一,https://hbimg.huabanimg.com/703fdb063bdc37b11033ef794f9b3a7adfa01fd21a6d1-wTFbnO</span><br><span class="line">15529690,Law344,https://hbimg.huabanimg.com/b438d8c61ed2abf50ca94e00f257ca7a223e3b364b471-xrzoQd</span><br><span class="line">18311394,Jennah·,https://hbimg.huabanimg.com/4edba1ed6a71797f52355aa1de5af961b85bf824cb71-px1nZz</span><br><span class="line">18009711,可洛爱画画,https://hbimg.huabanimg.com/03331ef39b5c7687f5cc47dbcbafd974403c962ae88ce-Co8AUI</span><br><span class="line">30574436,花姑凉~,https://hbimg.huabanimg.com/2f5b657edb9497ff8c41132e18000edb082d158c2404-8rYHbw</span><br><span class="line">17740339,小巫師,https://hbimg.huabanimg.com/dbc6fd49f1915545cc42c1a1492a418dbaebd2c21bb9-9aDqgl</span><br><span class="line">18741964,桐末tonmo,https://hbimg.huabanimg.com/b60cee303f62aaa592292f45a1ed8d5be9873b2ed5c-gAJehO</span><br><span class="line">30535005,TANGZHIQI,https://hbimg.huabanimg.com/bbd08ee168d54665bf9b07899a5c4a4d6bc1eb8af77a4-8Gz3K1</span><br><span class="line">31078743,你的老杨,https://hbimg.huabanimg.com/c46fbc3c9a01db37b8e786cbd7174bbd475e4cda220f4-F1u7MX</span><br><span class="line">25519376,尺尺寸,https://hbimg.huabanimg.com/ee29ee198efb98f970e3dc2b24c40d89bfb6f911126b6-KGvKes</span><br><span class="line">21113978,C-CLong,https://hbimg.huabanimg.com/7fa6b2a0d570e67246b34840a87d57c16a875dba9100-SXsSeY</span><br><span class="line">24674102,szaa,https://hbimg.huabanimg.com/0716687b0df93e8c3a8e0925b6d2e4135449cd27597c4-gWdv24</span><br><span class="line">30508507,爱起床的小灰灰,https://hbimg.huabanimg.com/4eafdbfa21b2f300a7becd8863f948e5e92ef789b5a5-1ozTKq</span><br><span class="line">12593664,yokozen,https://hbimg.huabanimg.com/cd07bbaf052b752ed5c287602404ea719d7dd8161321b-cJtHss</span><br><span class="line">16899164,一阵疯,https://hbimg.huabanimg.com/0940b557b28892658c3bcaf52f5ba8dc8402100e130b2-G966Uz</span><br><span class="line">847937,卩丬My㊊伴er彎,https://hbimg.huabanimg.com/e2d6bb5bc8498c6f607492a8f96164aa2366b104e7a-kWaH68</span><br><span class="line">31010628,慢慢即漫漫,https://hbimg.huabanimg.com/c4fb6718907a22f202e8dd14d52f0c369685e59cfea7-82FdsK</span><br><span class="line">13438168,海贼玩跑跑,https://hbimg.huabanimg.com/1edae3ce6fe0f6e95b67b4f8b57c4cebf19c501b397e-BXwiW6</span><br><span class="line">28593155,源稚生,https://hbimg.huabanimg.com/626cfd89ca4c10e6f875f3dfe1005331e4c0fd7fd429-9SeJeQ</span><br><span class="line">28201821,合伙哼哼,https://hbimg.huabanimg.com/f59d4780531aa1892b80e0ec94d4ec78dcba08ff18c416-769X6a</span><br><span class="line">28255146,漫步AAA,https://hbimg.huabanimg.com/3c034c520594e38353a039d7e7a5fd5e74fb53eb1086-KnpLaL</span><br><span class="line">30537613,配䦹,https://hbimg.huabanimg.com/efd81d22c1b1a2de77a0e0d8e853282b83b6bbc590fd-y3d4GJ</span><br><span class="line">22665880,日后必火,https://hbimg.huabanimg.com/69f0f959979a4fada9e9e55f565989544be88164d2b-INWbaF</span><br><span class="line">16748980,keer521521,https://hbimg.huabanimg.com/654953460733026a7ef6e101404055627ad51784a95c-B6OFs4</span><br><span class="line">30536510,“西辞”,https://hbimg.huabanimg.com/61cfffca6b2507bf51a507e8319d68a8b8c3a96968f-6IvMSk</span><br><span class="line">30986577,艺成背锅王,https://hbimg.huabanimg.com/c381ecc43d6c69758a86a30ebf72976906ae6c53291f9-9zroHF</span><br><span class="line">26409800,CsysADk7,https://hbimg.huabanimg.com/bf1d22092c2070d68ade012c588f2e410caaab1f58051-ahlgLm</span><br><span class="line">30469116,18啊全阿,https://hbimg.huabanimg.com/654953460733026a7ef6e101404055627ad51784a95c-B6OFs4</span><br><span class="line">17473505,椿の花,https://hbimg.huabanimg.com/0e38d810e5a24f91ebb251fd3aaaed8bb37655b14844c-pgNJBP</span><br><span class="line">19165177,っ思忆゜♪,https://hbimg.huabanimg.com/4815ea0e4905d0f3bb82a654b481811dadbfe5ce2673-vMVr0B</span><br><span class="line">16059616,格林熊丶,https://hbimg.huabanimg.com/8760a2b08d87e6ed4b7a9715b1a668176dbf84fec5b-jx14tZ</span><br><span class="line">30734152,sCWVkJDG,https://hbimg.huabanimg.com/f31a5305d1b8717bbfb897723f267d316e58e7b7dc40-GD3e22</span><br><span class="line">24019677,虚无本心,https://hbimg.huabanimg.com/6fdfa9834abe362e978b517275b06e7f0d5926aa650-N1xCXE</span><br><span class="line">16670283,Y-雨后天空,https://hbimg.huabanimg.com/a3bbb0045b536fc27a6d2effa64a0d43f9f5193c177f-I2vHaI</span><br><span class="line">21512483,汤姆2,https://hbimg.huabanimg.com/98cc50a61a7cc9b49a8af754ffb26bd15764a82f1133-AkiU7D</span><br><span class="line">16441049,笑潇啸逍小鱼,https://hbimg.huabanimg.com/ae8a70cd85aff3a8587ff6578d5cf7620f3691df13e46-lmrIi9</span><br><span class="line">24795603,⁢⁢⁢⁢⁢v,https://hbimg.huabanimg.com/a7183cc3a933aa129d7b3230bf1378fd8f5857846cc5-3tDtx3</span><br><span class="line">29819152,妮玛士珍多,https://hbimg.huabanimg.com/ca4ecb573bf1ff0415c7a873d64470dedc465ea1213c6-RAkArS</span><br><span class="line">19101282,陈勇敢❤,https://hbimg.huabanimg.com/ab6d04ebaff3176e3570139a65155856871241b58bc6-Qklj2E</span><br><span class="line">28337572,爱意随风散,https://hbimg.huabanimg.com/117ad8b6eeda57a562ac6ab2861111a793ca3d1d5543-SjWlk2</span><br><span class="line">17342758,幸运instant,https://hbimg.huabanimg.com/72b5f9042ec297ae57b83431123bc1c066cca90fa23-3MoJNj</span><br><span class="line">18483372,Beau染,https://hbimg.huabanimg.com/077115cb622b1ff3907ec6932e1b575393d5aae720487-d1cdT9</span><br><span class="line">22127102,栽花的小蜻蜓,https://hbimg.huabanimg.com/6c3cbf9f27e17898083186fc51985e43269018cc1e1df-QfOIBG</span><br><span class="line">13802024,LoveHsu,https://hbimg.huabanimg.com/f720a15f8b49b86a7c1ee4951263a8dbecfe3e43d2d-GPEauV</span><br><span class="line">22558931,白驹过隙丶梨花泪う,https://hbimg.huabanimg.com/e49e1341dfe5144da5c71bd15f1052ef07ba7a0e1296b-jfyfDJ</span><br><span class="line">11762339,cojoy,https://hbimg.huabanimg.com/5b27f876d5d391e7c4889bc5e8ba214419eb72b56822-83gYmB</span><br><span class="line">30711623,雪碧学长呀,https://hbimg.huabanimg.com/2c288a1535048b05537ba523b3fc9eacc1e81273212d1-nr8M4t</span><br><span class="line">18906718,西霸王,https://hbimg.huabanimg.com/7b02ad5e01bd8c0a29817e362814666a7800831c154a6-AvBDaG</span><br><span class="line">31037856,邵阳的小哥哥,https://hbimg.huabanimg.com/654953460733026a7ef6e101404055627ad51784a95c-B6OFs4</span><br><span class="line">26830711,稳健谭,https://hbimg.huabanimg.com/51547ade3f0aef134e8d268cfd4ad61110925aefec8a-NKPEYX</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">file_name, image_url</span>):</span><br><span class="line">    res = requests.get(</span><br><span class="line">        url=image_url,</span><br><span class="line">        headers=&#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># 检查images目录是否存在？不存在，则创建images目录</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;images&quot;</span>):</span><br><span class="line">        <span class="comment"># 创建images目录</span></span><br><span class="line">        os.makedirs(<span class="string">&quot;images&quot;</span>)</span><br><span class="line">    file_path = os.path.join(<span class="string">&quot;images&quot;</span>, file_name)</span><br><span class="line">    <span class="comment"># 2.将图片的内容写入到文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> img_object:</span><br><span class="line">        img_object.write(res.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程池，最多维护10个线程。</span></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;mv.csv&quot;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file_object:</span><br><span class="line">        nid, name, url = line.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        file_name = <span class="string">&quot;&#123;&#125;.png&quot;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">        pool.submit(download, file_name, url)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">image_url</span>):</span><br><span class="line">    res = requests.get(</span><br><span class="line">        url=image_url,</span><br><span class="line">        headers=&#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>(<span class="params">file_name</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">response</span>):</span><br><span class="line">        res = response.result()</span><br><span class="line">        <span class="comment"># 写入本地</span></span><br><span class="line">        <span class="comment"># # 检查images目录是否存在？不存在，则创建images目录</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;images&quot;</span>):</span><br><span class="line">            <span class="comment"># 创建images目录</span></span><br><span class="line">            os.makedirs(<span class="string">&quot;images&quot;</span>)</span><br><span class="line"></span><br><span class="line">        file_path = os.path.join(<span class="string">&quot;images&quot;</span>, file_name)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># # 2.将图片的内容写入到文件</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> img_object:</span><br><span class="line">            img_object.write(res.content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> save</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程池，最多维护10个线程。</span></span><br><span class="line">pool = ThreadPoolExecutor(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;mv.csv&quot;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file_object:</span><br><span class="line">        nid, name, url = line.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        file_name = <span class="string">&quot;&#123;&#125;.png&quot;</span>.<span class="built_in">format</span>(name)</span><br><span class="line">        fur = pool.submit(download, url)</span><br><span class="line">        fur.add_done_callback(outer(file_name))</span><br></pre></td></tr></table></figure>









<h2 id="7-单例模式（扩展）"><a href="#7-单例模式（扩展）" class="headerlink" title="7.单例模式（扩展）"></a>7.单例模式（扩展）</h2><p>面向对象 + 多线程相关的一个面试题（以后项目和源码中会用到）。</p>
<p>之前写一个类，每次执行 <code>类()</code> 都会实例化一个类的对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">obj1 = Foo()</span><br><span class="line"></span><br><span class="line">obj2 = Foo()</span><br><span class="line"><span class="built_in">print</span>(obj1,obj2)</span><br></pre></td></tr></table></figure>



<p>以后开发会遇到单例模式，每次实例化类的对象时，都是最开始创建的那个对象，不再重复创建对象。</p>
<ul>
<li><p>简单的实现单例模式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="comment"># 返回空对象</span></span><br><span class="line">        <span class="keyword">if</span> cls.instance:</span><br><span class="line">            <span class="keyword">return</span> cls.instance</span><br><span class="line">        cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line">obj1 = Singleton(<span class="string">&#x27;alex&#x27;</span>)</span><br><span class="line">obj2 = Singleton(<span class="string">&#x27;SB&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(obj1,obj2)</span><br></pre></td></tr></table></figure>
</li>
<li><p>多线程执行单例模式，有BUG</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">if</span> cls.instance:</span><br><span class="line">            <span class="keyword">return</span> cls.instance</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    obj = Singleton(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>加锁解决BUG</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line">    lock = threading.RLock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="keyword">with</span> cls.lock:</span><br><span class="line">            <span class="keyword">if</span> cls.instance:</span><br><span class="line">                <span class="keyword">return</span> cls.instance</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    obj = Singleton(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>
</li>
<li><p>加判断，提升性能</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span>:</span><br><span class="line">    instance = <span class="literal">None</span></span><br><span class="line">    lock = threading.RLock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cls.instance:</span><br><span class="line">            <span class="keyword">return</span> cls.instance</span><br><span class="line">        <span class="keyword">with</span> cls.lock:</span><br><span class="line">            <span class="keyword">if</span> cls.instance:</span><br><span class="line">                <span class="keyword">return</span> cls.instance</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            cls.instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">task</span>():</span><br><span class="line">    obj = Singleton(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行1000行代码</span></span><br><span class="line"></span><br><span class="line">data = Singleton(<span class="string">&#x27;asdfasdf&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>进程和线程的区别和应用场景。</li>
<li>什么是GIL锁</li>
<li>多线程和线程池的使用。</li>
<li>线程安全 &amp; 线程锁 &amp; 死锁</li>
<li>单例模式</li>
</ol>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ol>
<li><p>简述进程和线程的区别以及应用场景。</p>
</li>
<li><p>什么是GIL锁</p>
</li>
<li><p>手写单例模式</p>
</li>
<li><p>程序从flag a执行到falg b的时间大致是多少秒？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_wait</span>():</span><br><span class="line">	time.sleep(<span class="number">60</span>)</span><br><span class="line"><span class="comment"># flag a</span></span><br><span class="line">t = threading.Thread(target=_wait)</span><br><span class="line">t.setDaemon(<span class="literal">False</span>)</span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># flag b</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>程序从flag a执行到falg b的时间大致是多少秒？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_wait</span>():</span><br><span class="line">	time.sleep(<span class="number">60</span>)</span><br><span class="line"><span class="comment"># flag a</span></span><br><span class="line">t = threading.Thread(target=_wait)</span><br><span class="line">t.setDaemon(<span class="literal">True</span>)</span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># flag b</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>程序从flag a执行到falg b的时间大致是多少秒？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_wait</span>():</span><br><span class="line">	time.sleep(<span class="number">60</span>)</span><br><span class="line"><span class="comment"># flag a</span></span><br><span class="line">t = threading.Thread(target=_wait)</span><br><span class="line">t.start()</span><br><span class="line">t.join()</span><br><span class="line"><span class="comment"># flag b</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>读程序，请确认执行到最后number是否一定为0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">loop = <span class="built_in">int</span>(<span class="number">1E7</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>(<span class="params">loop = <span class="number">1</span></span>):</span><br><span class="line">	<span class="keyword">global</span> number</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(loop):</span><br><span class="line">		number += <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_sub</span>(<span class="params">loop = <span class="number">1</span></span>):</span><br><span class="line">	<span class="keyword">global</span> number</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(loop):</span><br><span class="line">		number -= <span class="number">1</span></span><br><span class="line">number = <span class="number">0</span></span><br><span class="line">ta = threading.Thread(target=_add,args=(loop,))</span><br><span class="line">ts = threading.Thread(target=_sub,args=(loop,))</span><br><span class="line">ta.start()</span><br><span class="line">ta.join()</span><br><span class="line">ts.start()</span><br><span class="line">ts.join()</span><br></pre></td></tr></table></figure>
</li>
<li><p>读程序，请确认执行到最后number是否一定为0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line">loop = <span class="built_in">int</span>(<span class="number">1E7</span>)</span><br><span class="line">number = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_add</span>(<span class="params">loop = <span class="number">1</span></span>):</span><br><span class="line">	<span class="keyword">global</span> number</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(loop):</span><br><span class="line">		number += <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_sub</span>(<span class="params">loop = <span class="number">1</span></span>):</span><br><span class="line">	<span class="keyword">global</span> number</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(loop):</span><br><span class="line">		number -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">ta = threading.Thread(target=_add,args=(loop,))</span><br><span class="line">ts = threading.Thread(target=_sub,args=(loop,))</span><br><span class="line">ta.start()</span><br><span class="line">ts.start()</span><br><span class="line">ta.join()</span><br><span class="line">ts.join()</span><br></pre></td></tr></table></figure>
</li>
<li><p>data.txt 文件中共有 10000 条数据，请为每 100行 数据创建一个线程，并在线程中把当前100条数据的num列相加并打印。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">subscription_id,erotic,num</span><br><span class="line">ASDFOKASDJF423KASDFJASDF,5,1</span><br><span class="line">FSD23R23SFSDF4DFGDFGDFGDF,5,99</span><br><span class="line">ASDDSFGWERTCERT44GFGDSFG,5,2</span><br><span class="line">FFFFFFSDSVFG5RTFGDDFFFFA,5,11</span><br><span class="line">ASDFASDF3234XCVWEGDFGSAF,5,1</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:32" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:32+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:33" itemprop="dateModified" datetime="2024-08-28T18:21:33+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day21-网络编程（下）"><a href="#day21-网络编程（下）" class="headerlink" title="day21 网络编程（下）"></a>day21 网络编程（下）</h1><p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210222072456318.png" alt="image-20210222072456318"></p>
<p>课程目标：学会网络编程开发的必备知识点。</p>
<p>今日概要：</p>
<ul>
<li>OSI7 层模型</li>
<li>TCP和UDP</li>
<li>粘包</li>
<li>阻塞和非阻塞</li>
<li>IO多路复用</li>
</ul>
<h2 id="1-OSI-7层模型"><a href="#1-OSI-7层模型" class="headerlink" title="1. OSI 7层模型"></a>1. OSI 7层模型</h2><p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210222072652918.png" alt="image-20210222072652918"></p>
<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210209113923860.png" alt="image-20210209113923860"></p>
<p>OSI的7层模型对于大家来说可能不太好理解，所以我们通过一个案例来讲解：</p>
<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210209101325856.png" alt="image-20210209101325856"></p>
<p>假设，你在浏览器上输入了一些关键字，内部通过DNS找到对应的IP后，再发送数据时内部会做如下的事：</p>
<ul>
<li><p>应用层：规定数据的格式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;GET /s?wd=你好 HTTP/1.1\r\nHost:www.baidu.com\r\n\r\n&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>表示层：对应用层数据的编码、压缩（解压缩）、分块、加密（解密）等任务。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;GET /s?wd=你好 HTTP/1.1\r\nHost:www.baidu.com\r\n\r\n你好&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>会话层：负责与目标建立、中断连接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在发送数据之前，需要会先发送 “连接” 的请求，与远程建立连接后，再发送数据。当然，发送完毕之后，也涉及中断连接的操作。</span><br></pre></td></tr></table></figure>
</li>
<li><p>传输层：建立端口到端口的通信，其实就确定双方的端口信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数据：&quot;GET /s?wd=你好 HTTP/1.1\r\nHost:www.baidu.com\r\n\r\n你好&quot;.encode(&#x27;utf-8&#x27;)</span><br><span class="line">端口：</span><br><span class="line">	- 目标：80</span><br><span class="line">	- 本地：6784</span><br></pre></td></tr></table></figure>
</li>
<li><p>网络层：标记目标IP信息（IP协议层）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">数据：&quot;GET /s?wd=你好 HTTP/1.1\r\nHost:www.baidu.com\r\n\r\n你好&quot;.encode(&#x27;utf-8&#x27;)</span><br><span class="line">端口：</span><br><span class="line">	- 目标：80</span><br><span class="line">	- 本地：6784</span><br><span class="line">IP：</span><br><span class="line">	- 目标IP：110.242.68.3（百度）</span><br><span class="line">	- 本地IP：192.168.10.1</span><br></pre></td></tr></table></figure>
</li>
<li><p>数据链路层：对数据进行分组并设置源和目标mac地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">数据：&quot;POST /s?wd=你好 HTTP/1.1\r\nHost:www.baidu.com\r\n\r\n你好&quot;.encode(&#x27;utf-8&#x27;)</span><br><span class="line">端口：</span><br><span class="line">	- 目标：80</span><br><span class="line">	- 本地：6784</span><br><span class="line">IP：</span><br><span class="line">	- 目标IP：110.242.68.3（百度）</span><br><span class="line">	- 本地IP：192.168.10.1</span><br><span class="line">MAC：</span><br><span class="line">	- 目标MAC：FF-FF-FF-FF-FF-FF </span><br><span class="line">	- 本机MAC：11-9d-d8-1a-dd-cd</span><br></pre></td></tr></table></figure>
</li>
<li><p>物理层：将二进制数据在物理媒体上传输。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过网线将二进制数据发送出去</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210209113923860.png" alt="image-20210209113923860"></p>
<p>每一层各司其职，最终保证数据呈现在到用户手中。</p>
<p>简单的可以理解为发快递：将数据外面套了7个箱子，最终用户收到箱子时需要打开7个箱子才能拿到数据。而在运输的过程中有些箱子是会被拆开并替换的，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">最终运送目标：上海 ~ 北京（中途可能需要中转站），在中转站会会打开箱子查看信息，在进行转发。</span><br><span class="line">	- 对于二级中转站（二层交换机）：拆开数据链路层的箱子，查看mac地址信息。</span><br><span class="line">	- 对于三级中转站（路由器或三层交换机）：拆开网络层的箱子，查看IP信息。</span><br></pre></td></tr></table></figure>



<p>在开发过程中其实只能体现：应用层、表示层、会话层、传输层，其他层的处理都是在网络设备中自动完成的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.connect((<span class="string">&#x27;110.242.68.3&#x27;</span>, <span class="number">80</span>)) <span class="comment"># 向服务端发送了数据包</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;你好&quot;</span></span><br><span class="line"><span class="comment"># 应用层</span></span><br><span class="line">content = <span class="string">&quot;GET /s?wd=&#123;&#125; http1.1\r\nHost:www.baidu.com\r\n\r\n&quot;</span>.<span class="built_in">format</span>(key)</span><br><span class="line"><span class="comment"># 表示层</span></span><br><span class="line">content = content.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">client.sendall(content)</span><br><span class="line">result = client.recv(<span class="number">8196</span>)</span><br><span class="line"><span class="built_in">print</span>(result.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会话层 &amp; 传输层</span></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>



<h2 id="2-UDP和TCP协议"><a href="#2-UDP和TCP协议" class="headerlink" title="2. UDP和TCP协议"></a>2. UDP和TCP协议</h2><p>协议，其实就是规定 连接、收发数据的一些规定。</p>
<p>在OSI的 传输层 除了定义端口信息以外，常见的还可以指定UDP或TCP的协议，协议不同连接和传输数据的细节也会不同。</p>
<ul>
<li><p>UDP（User Data Protocol）用户数据报协议， 是⼀个⽆连接的简单的⾯向数据报的传输层协议。 UDP不提供可靠性， 它只是把应⽤程序传给IP层的数据报发送出去， 但是并不能保证它们能到达⽬的地。 由于UDP在传输数据报前不⽤在客户和服务器之间建⽴⼀个连接， 且没有超时重发等机制， 故⽽传输速度很快。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">常见的有：语音通话、视频通话、实时游戏画面 等。</span><br></pre></td></tr></table></figure>
</li>
<li><p>TCP（Transmission Control Protocol，传输控制协议）是面向连接的协议，也就是说，在收发数据前，必须和对方建立可靠的连接，然后再进行收发数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">常见有：网站、手机APP数据获取等。</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-1-UDP和TCP-示例代码"><a href="#2-1-UDP和TCP-示例代码" class="headerlink" title="2.1 UDP和TCP 示例代码"></a>2.1 UDP和TCP 示例代码</h3><p>UDP示例如下：</p>
<ul>
<li><p>服务端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line">server.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8002</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data, (host, port) = server.recvfrom(<span class="number">1024</span>) <span class="comment"># 阻塞</span></span><br><span class="line">    <span class="built_in">print</span>(data, host, port)</span><br><span class="line">    server.sendto(<span class="string">&quot;好的&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>), (host, port))</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    text = <span class="built_in">input</span>(<span class="string">&quot;请输入要发送的内容：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> text.upper() == <span class="string">&#x27;Q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    client.sendto(text.encode(<span class="string">&#x27;utf-8&#x27;</span>), (<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8002</span>))</span><br><span class="line">    data, (host, port) = client.recvfrom(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>TCP示例如下：</p>
<ul>
<li><p>服务端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.监听本机的IP和端口</span></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 2.等待，有人来连接（阻塞）</span></span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.等待，连接者发送消息（阻塞）</span></span><br><span class="line">    client_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(client_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.给连接者回复消息</span></span><br><span class="line">    conn.sendall(<span class="string">b&quot;hello world&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.关闭连接</span></span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.停止服务端程序</span></span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 向指定IP发送连接请求</span></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 连接成功之后，发送消息</span></span><br><span class="line">client.sendall(<span class="string">b&#x27;hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 等待，消息的回复（阻塞）</span></span><br><span class="line">reply = client.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(reply)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 关闭连接</span></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-2-TCP三次握手和四次挥手"><a href="#2-2-TCP三次握手和四次挥手" class="headerlink" title="2.2 TCP三次握手和四次挥手"></a>2.2 TCP三次握手和四次挥手</h3><p>这是一个常见的面试题。</p>
<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210222072652918.png" alt="image-20210222072652918"></p>
<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210209113923860.png" alt="image-20210209113923860"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|          Source Port          |       Destination Port        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                        Sequence Number                        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Acknowledgment Number                      |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|  Data |           |U|A|P|R|S|F|                               |</span><br><span class="line">| Offset| Reserved  |R|C|S|S|Y|I|            Window             |</span><br><span class="line">|       |           |G|K|H|T|N|N|                               |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|           Checksum            |         Urgent Pointer        |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                    Options                    |    Padding    |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br><span class="line">|                             data                              |</span><br><span class="line">+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</span><br></pre></td></tr></table></figure>

<p>网络中的双方想要基于TCP连接进行通信，必须要经过：</p>
<ul>
<li><p>创建连接，客户端和服务端要进行三次握手。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn, addr = sock.accept() <span class="comment"># 等待客户端连接</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 客户端</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>)) <span class="comment"># 发起连接</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">      客户端                                                服务端</span><br><span class="line"></span><br><span class="line">  1.  SYN-SENT    --&gt; &lt;seq=100&gt;&lt;CTL=SYN&gt;               --&gt; SYN-RECEIVED</span><br><span class="line"></span><br><span class="line">  2.  ESTABLISHED &lt;-- &lt;seq=300&gt;&lt;ack=101&gt;&lt;CTL=SYN,ACK&gt;  &lt;-- SYN-RECEIVED</span><br><span class="line"></span><br><span class="line">  3.  ESTABLISHED --&gt; &lt;seq=101&gt;&lt;ack=301&gt;&lt;CTL=ACK&gt;       --&gt; ESTABLISHED</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">At this point, both the client and server have received an acknowledgment of the connection. The steps 1, 2 establish the connection parameter (sequence number) for one direction and it is acknowledged. The steps 2, 3 establish the connection parameter (sequence number) for the other direction and it is acknowledged. With these, a full-duplex communication is established.</span><br></pre></td></tr></table></figure>
</li>
<li><p>传输数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在收发数据的过程中，只有有数据的传送就会有应答（ack），如果没有ack，那么内部会尝试重复发送。</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭连接，客户端和服务端要进行4次挥手。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line">	...</span><br><span class="line">    conn.close() <span class="comment"># 关闭连接</span></span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">...</span><br><span class="line">client.close() <span class="comment"># 关闭连接</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">     TCP A                                                TCP B</span><br><span class="line">  </span><br><span class="line">1.  FIN-WAIT-1  --&gt; &lt;seq=100&gt;&lt;ack=300&gt;&lt;CTL=FIN,ACK&gt;  --&gt; CLOSE-WAIT</span><br><span class="line">  </span><br><span class="line">2.  FIN-WAIT-2  &lt;-- &lt;seq=300&gt;&lt;ack=101&gt;&lt;CTL=ACK&gt;      &lt;-- CLOSE-WAIT</span><br><span class="line">  </span><br><span class="line">3.  TIME-WAIT   &lt;-- &lt;seq=300&gt;&lt;ack=101&gt;&lt;CTL=FIN,ACK&gt;  &lt;-- LAST-ACK</span><br><span class="line">  </span><br><span class="line">4.  TIME-WAIT   --&gt; &lt;seq=101&gt;&lt;ack=301&gt;&lt;CTL=ACK&gt;      --&gt; CLOSED</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-粘包"><a href="#3-粘包" class="headerlink" title="3. 粘包"></a>3. 粘包</h2><p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210222072652918.png" alt="image-20210222072652918"></p>
<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210215074546610.png" alt="image-20210215074546610"></p>
<p>两台电脑在进行收发数据时，其实不是直接将数据传输给对方。</p>
<ul>
<li>对于发送者，执行 <code>sendall/send</code> 发送消息时，是将数据先发送至自己网卡的 写缓冲区 ，再由缓冲区将数据发送给到对方网卡的读缓冲区。</li>
<li>对于接受者，执行 <code>recv</code> 接收消息时，是从自己网卡的读缓冲区获取数据。</li>
</ul>
<p>所以，如果发送者连续快速的发送了2条信息，接收者在读取时会认为这是1条信息，即：<span style="color:red;"><strong>2个数据包粘在了一起。</strong></span>例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># socket客户端（发送者）</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line">client.sendall(<span class="string">&#x27;alex正在吃&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">client.sendall(<span class="string">&#x27;翔&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">client.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># socket服务端（接收者）</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line">conn, addr = sock.accept()</span><br><span class="line"></span><br><span class="line">client_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(client_data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure>



<p><strong>如何解决粘包的问题？</strong></p>
<blockquote>
<p>每次发送的消息时，都将消息划分为 头部（固定字节长度） 和 数据 两部分。例如：头部，用4个字节表示后面数据的长度。</p>
<ul>
<li>发送数据，先发送数据的长度，再发送数据（或拼接起来再发送）。</li>
<li>接收数据，先读4个字节就可以知道自己这个数据包中的数据长度，再根据长度读取到数据。</li>
</ul>
<p>对于头部需要一个数字并固定为4个字节，这个功能可以借助python的struct包来实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># ########### 数值转换为固定4个字节，四个字节的范围 -2147483648 &lt;= number &lt;= 2147483647  ###########</span></span><br><span class="line">v1 = struct.pack(<span class="string">&#x27;i&#x27;</span>, <span class="number">199</span>)</span><br><span class="line"><span class="built_in">print</span>(v1)  <span class="comment"># b&#x27;\xc7\x00\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> v1:</span><br><span class="line">    <span class="built_in">print</span>(item, <span class="built_in">bin</span>(item))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># ########### 4个字节转换为数字 ###########</span></span><br><span class="line">v2 = struct.unpack(<span class="string">&#x27;i&#x27;</span>, v1) <span class="comment"># v1= b&#x27;\xc7\x00\x00\x00&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(v2) <span class="comment"># (199,)</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210215090446549.png" alt="image-20210215090446549"></p>
<p>示例代码：</p>
<ul>
<li><p>服务端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line">conn, addr = sock.accept()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 固定读取4字节</span></span><br><span class="line">header1 = conn.recv(<span class="number">4</span>)</span><br><span class="line">data_length1 = struct.unpack(<span class="string">&#x27;i&#x27;</span>, header1)[<span class="number">0</span>] <span class="comment"># 数据字节长度 21</span></span><br><span class="line">has_recv_len = <span class="number">0</span></span><br><span class="line">data1 = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    length = data_length1 - has_recv_len</span><br><span class="line">    <span class="keyword">if</span> length &gt; <span class="number">1024</span>:</span><br><span class="line">        lth = <span class="number">1024</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">        lth = length</span><br><span class="line">	chunk = conn.recv(lth) <span class="comment"># 可能一次收不完，自己可以计算长度再次使用recv收取，指导收完为止。 1024*8 = 8196</span></span><br><span class="line">    data1 += chunk</span><br><span class="line">    has_recv_len += <span class="built_in">len</span>(chunk)</span><br><span class="line">    <span class="keyword">if</span> has_recv_len == data_length1:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(data1.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 固定读取4字节</span></span><br><span class="line">header2 = conn.recv(<span class="number">4</span>)</span><br><span class="line">data_length2 = struct.unpack(<span class="string">&#x27;i&#x27;</span>, header2)[<span class="number">0</span>] <span class="comment"># 数据字节长度</span></span><br><span class="line">data2 = conn.recv(data_length2) <span class="comment"># 长度</span></span><br><span class="line"><span class="built_in">print</span>(data2.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一条数据</span></span><br><span class="line">data1 = <span class="string">&#x27;alex正在吃&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">header1 = struct.pack(<span class="string">&#x27;i&#x27;</span>, <span class="built_in">len</span>(data1))</span><br><span class="line"></span><br><span class="line">client.sendall(header1)</span><br><span class="line">client.sendall(data1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二条数据</span></span><br><span class="line">data2 = <span class="string">&#x27;翔&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">header2 = struct.pack(<span class="string">&#x27;i&#x27;</span>, <span class="built_in">len</span>(data2))</span><br><span class="line">client.sendall(header2)</span><br><span class="line">client.sendall(data2)</span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<h3 id="案例：消息-文件上传"><a href="#案例：消息-文件上传" class="headerlink" title="案例：消息 &amp; 文件上传"></a>案例：消息 &amp; 文件上传</h3><ul>
<li><p>服务端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_data</span>(<span class="params">conn, chunk_size=<span class="number">1024</span></span>):</span><br><span class="line">    <span class="comment"># 获取头部信息：数据长度</span></span><br><span class="line">    has_read_size = <span class="number">0</span></span><br><span class="line">    bytes_list = []</span><br><span class="line">    <span class="keyword">while</span> has_read_size &lt; <span class="number">4</span>:</span><br><span class="line">        chunk = conn.recv(<span class="number">4</span> - has_read_size)</span><br><span class="line">        has_read_size += <span class="built_in">len</span>(chunk)</span><br><span class="line">        bytes_list.append(chunk)</span><br><span class="line">    header = <span class="string">b&quot;&quot;</span>.join(bytes_list)</span><br><span class="line">    data_length = struct.unpack(<span class="string">&#x27;i&#x27;</span>, header)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    data_list = []</span><br><span class="line">    has_read_data_size = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> has_read_data_size &lt; data_length:</span><br><span class="line">        size = chunk_size <span class="keyword">if</span> (data_length - has_read_data_size) &gt; chunk_size <span class="keyword">else</span> data_length - has_read_data_size</span><br><span class="line">        chunk = conn.recv(size)</span><br><span class="line">        data_list.append(chunk)</span><br><span class="line">        has_read_data_size += <span class="built_in">len</span>(chunk)</span><br><span class="line"></span><br><span class="line">    data = <span class="string">b&quot;&quot;</span>.join(data_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_file</span>(<span class="params">conn, save_file_name, chunk_size=<span class="number">1024</span></span>):</span><br><span class="line">    save_file_path = os.path.join(<span class="string">&#x27;files&#x27;</span>, save_file_name)</span><br><span class="line">    <span class="comment"># 获取头部信息：数据长度</span></span><br><span class="line">    has_read_size = <span class="number">0</span></span><br><span class="line">    bytes_list = []</span><br><span class="line">    <span class="keyword">while</span> has_read_size &lt; <span class="number">4</span>:</span><br><span class="line">        chunk = conn.recv(<span class="number">4</span> - has_read_size)</span><br><span class="line">        bytes_list.append(chunk)</span><br><span class="line">        has_read_size += <span class="built_in">len</span>(chunk)</span><br><span class="line">    header = <span class="string">b&quot;&quot;</span>.join(bytes_list)</span><br><span class="line">    data_length = struct.unpack(<span class="string">&#x27;i&#x27;</span>, header)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取数据</span></span><br><span class="line">    file_object = <span class="built_in">open</span>(save_file_path, mode=<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    has_read_data_size = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> has_read_data_size &lt; data_length:</span><br><span class="line">        size = chunk_size <span class="keyword">if</span> (data_length - has_read_data_size) &gt; chunk_size <span class="keyword">else</span> data_length - has_read_data_size</span><br><span class="line">        chunk = conn.recv(size)</span><br><span class="line">        file_object.write(chunk)</span><br><span class="line">        file_object.flush()</span><br><span class="line">        has_read_data_size += <span class="built_in">len</span>(chunk)</span><br><span class="line">    file_object.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    <span class="comment"># IP可复用</span></span><br><span class="line">    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">    sock.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        conn, addr = sock.accept()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># 获取消息类型</span></span><br><span class="line">            message_type = recv_data(conn).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> message_type == <span class="string">&#x27;close&#x27;</span>:  <span class="comment"># 四次挥手，空内容。</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;关闭连接&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># 文件：&#123;&#x27;msg_type&#x27;:&#x27;file&#x27;, &#x27;file_name&#x27;:&quot;xxxx.xx&quot; &#125;</span></span><br><span class="line">            <span class="comment"># 消息：&#123;&#x27;msg_type&#x27;:&#x27;msg&#x27;&#125;</span></span><br><span class="line">            message_type_info = json.loads(message_type)</span><br><span class="line">            <span class="keyword">if</span> message_type_info[<span class="string">&#x27;msg_type&#x27;</span>] == <span class="string">&#x27;msg&#x27;</span>:</span><br><span class="line">                data = recv_data(conn)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;接收到消息：&quot;</span>, data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                file_name = message_type_info[<span class="string">&#x27;file_name&#x27;</span>]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;接收到文件，要保存到：&quot;</span>, file_name)</span><br><span class="line">                recv_file(conn, file_name)</span><br><span class="line"></span><br><span class="line">        conn.close()</span><br><span class="line">    sock.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_data</span>(<span class="params">conn, content</span>):</span><br><span class="line">    data = content.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    header = struct.pack(<span class="string">&#x27;i&#x27;</span>, <span class="built_in">len</span>(data))</span><br><span class="line">    conn.sendall(header)</span><br><span class="line">    conn.sendall(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_file</span>(<span class="params">conn, file_path</span>):</span><br><span class="line">    file_size = os.stat(file_path).st_size</span><br><span class="line">    header = struct.pack(<span class="string">&#x27;i&#x27;</span>, file_size)</span><br><span class="line">    conn.sendall(header)</span><br><span class="line"></span><br><span class="line">    has_send_size = <span class="number">0</span></span><br><span class="line">    file_object = <span class="built_in">open</span>(file_path, mode=<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> has_send_size &lt; file_size:</span><br><span class="line">        chunk = file_object.read(<span class="number">2048</span>)</span><br><span class="line">        conn.sendall(chunk)</span><br><span class="line">        has_send_size += <span class="built_in">len</span>(chunk)</span><br><span class="line">    file_object.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    client = socket.socket()</span><br><span class="line">    client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        请发送消息，格式为：</span></span><br><span class="line"><span class="string">            - 消息：msg|你好呀</span></span><br><span class="line"><span class="string">            - 文件：file|xxxx.png</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        content = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)  <span class="comment"># msg or file</span></span><br><span class="line">        <span class="keyword">if</span> content.upper() == <span class="string">&#x27;Q&#x27;</span>:</span><br><span class="line">            send_data(client, <span class="string">&quot;close&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        input_text_list = content.split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(input_text_list) != <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;格式错误，请重新输入&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        message_type, info = input_text_list</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 发消息</span></span><br><span class="line">        <span class="keyword">if</span> message_type == <span class="string">&#x27;msg&#x27;</span>:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 发消息类型</span></span><br><span class="line">            send_data(client, json.dumps(&#123;<span class="string">&quot;msg_type&quot;</span>: <span class="string">&quot;msg&quot;</span>&#125;))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 发内容</span></span><br><span class="line">            send_data(client, info)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 发文件</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            file_name = info.rsplit(os.sep, maxsplit=<span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 发消息类型</span></span><br><span class="line">            send_data(client, json.dumps(&#123;<span class="string">&quot;msg_type&quot;</span>: <span class="string">&quot;file&quot;</span>, <span class="string">&#x27;file_name&#x27;</span>: file_name&#125;))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 发内容</span></span><br><span class="line">            send_file(client, info)</span><br><span class="line"></span><br><span class="line">    client.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-阻塞和非阻塞"><a href="#4-阻塞和非阻塞" class="headerlink" title="4. 阻塞和非阻塞"></a>4. 阻塞和非阻塞</h2><p>默认情况下我们编写的网络编程的代码都是阻塞的（等待），阻塞主要体现在：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ################### socket服务端（接收者）###################</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阻塞</span></span><br><span class="line">conn, addr = sock.accept()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阻塞</span></span><br><span class="line">client_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(client_data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">sock.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ################### socket客户端（发送者） ###################</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阻塞</span></span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line">client.sendall(<span class="string">&#x27;alex正在吃翔&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>



<p>如果想要让代码变为非阻塞，需要这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ################### socket服务端（接收者）###################</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">sock.setblocking(<span class="literal">False</span>) <span class="comment"># 加上就变为了非阻塞</span></span><br><span class="line"></span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 非阻塞</span></span><br><span class="line">conn, addr = sock.accept()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 非阻塞</span></span><br><span class="line">client_data = conn.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(client_data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">conn.close()</span><br><span class="line">sock.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ################### socket客户端（发送者） ###################</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line"></span><br><span class="line">client.setblocking(<span class="literal">False</span>) <span class="comment"># 加上就变为了非阻塞</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 非阻塞</span></span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line">client.sendall(<span class="string">&#x27;alex正在吃翔&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210216093805252.png" alt="image-20210216093805252"></p>
<p>如果代码变成了非阻塞，程序运行时一旦遇到 <code>accept</code>、<code>recv</code>、<code>connect</code> 就会抛出 BlockingIOError 的异常。</p>
<p>这不是代码编写的有错误，而是原来的IO阻塞变为非阻塞之后，由于没有接收到相关的IO请求抛出的固定错误。</p>
<p>非阻塞的代码一般与IO多路复用结合，可以迸发出更大的作用。</p>
<h2 id="5-IO多路复用"><a href="#5-IO多路复用" class="headerlink" title="5. IO多路复用"></a>5. IO多路复用</h2><p>I&#x2F;O多路复用指：通过一种机制，可以<strong>监视多个描述符</strong>，一旦某个描述符就绪（一般是读就绪或者写就绪），能够通知程序进行相应的读写操作。</p>
<p>IO多路复用 + 非阻塞，可以实现让TCP的服务端同时处理多个客户端的请求，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ################### socket服务端 ###################</span></span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">server.setblocking(<span class="literal">False</span>)  <span class="comment"># 加上就变为了非阻塞</span></span><br><span class="line">server.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line">server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">inputs = [server, ] <span class="comment"># socket对象列表 -&gt; [server, 第一个客户端连接conn ]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 当 参数1 序列中的socket对象发生可读时（accetp和read），则获取发生变化的对象并添加到 r列表中。</span></span><br><span class="line">    <span class="comment"># r = []</span></span><br><span class="line">    <span class="comment"># r = [server,]</span></span><br><span class="line">    <span class="comment"># r = [第一个客户端连接conn,]</span></span><br><span class="line">    <span class="comment"># r = [server,]</span></span><br><span class="line">    <span class="comment"># r = [第一个客户端连接conn，第二个客户端连接conn]</span></span><br><span class="line">    <span class="comment"># r = [第二个客户端连接conn,]</span></span><br><span class="line">    r, w, e = select.select(inputs, [], [], <span class="number">0.05</span>)</span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> r:</span><br><span class="line">        <span class="comment"># server</span></span><br><span class="line">        <span class="keyword">if</span> sock == server:</span><br><span class="line">            conn, addr = sock.accept() <span class="comment"># 接收新连接。</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;有新连接&quot;</span>)</span><br><span class="line">            <span class="comment"># conn.sendall()</span></span><br><span class="line">            <span class="comment"># conn.recv(&quot;xx&quot;)</span></span><br><span class="line">            inputs.append(conn)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data = sock.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;收到消息：&quot;</span>, data)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;关闭连接&quot;</span>)</span><br><span class="line">                inputs.remove(sock)</span><br><span class="line">	<span class="comment"># 干点其他事 20s</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">优点：</span></span><br><span class="line"><span class="string">	1. 干点那其他的事。</span></span><br><span class="line"><span class="string">	2. 让服务端支持多个客户端同时来连接。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ################### socket客户端 ###################</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line"><span class="comment"># 阻塞</span></span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    content = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> content.upper() == <span class="string">&#x27;Q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    client.sendall(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ################### socket客户端 ###################</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line"><span class="comment"># 阻塞</span></span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    content = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> content.upper() == <span class="string">&#x27;Q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    client.sendall(content.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">client.close() <span class="comment"># 与服务端断开连接（四次挥手），默认会想服务端发送空数据。</span></span><br></pre></td></tr></table></figure>



<p>IO多路复用 + 非阻塞，可以实现让TCP的客户端同时发送多个请求，例如：去某个网站发送下载图片的请求。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> select</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">client_list = []  <span class="comment"># socket对象列表</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    client = socket.socket()</span><br><span class="line">    client.setblocking(<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 连接百度，虽然有异常BlockingIOError，但向还是正常发送连接的请求</span></span><br><span class="line">        client.connect((<span class="string">&#x27;47.98.134.86&#x27;</span>, <span class="number">80</span>))</span><br><span class="line">    <span class="keyword">except</span> BlockingIOError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    client_list.append(client)</span><br><span class="line"></span><br><span class="line">recv_list = []  <span class="comment"># 放已连接成功，且已经把下载图片的请求发过去的socket</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># w = [第一个socket对象,]</span></span><br><span class="line">    <span class="comment"># r = [socket对象,]</span></span><br><span class="line">    r, w, e = select.select(recv_list, client_list, [], <span class="number">0.1</span>)</span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> w:</span><br><span class="line">        <span class="comment"># 连接成功，发送数据</span></span><br><span class="line">        <span class="comment"># 下载图片的请求</span></span><br><span class="line">        sock.sendall(<span class="string">b&quot;GET /nginx-logo.png HTTP/1.1\r\nHost:47.98.134.86\r\n\r\n&quot;</span>)</span><br><span class="line">        recv_list.append(sock)</span><br><span class="line">        client_list.remove(sock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sock <span class="keyword">in</span> r:</span><br><span class="line">        <span class="comment"># 数据发送成功后，接收的返回值（图片）并写入到本地文件中</span></span><br><span class="line">        data = sock.recv(<span class="number">8196</span>)</span><br><span class="line">        content = data.split(<span class="string">b&#x27;\r\n\r\n&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        random_file_name = <span class="string">&quot;&#123;&#125;.png&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(uuid.uuid4()))</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(<span class="string">&quot;images&quot;</span>, random_file_name), mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(content)</span><br><span class="line">        recv_list.remove(sock)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> recv_list <span class="keyword">and</span> <span class="keyword">not</span> client_list:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">优点：</span></span><br><span class="line"><span class="string">	1. 可以伪造除并发的现象。</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>



<p>基于 IO多路复用 + 非阻塞的特性，无论编写socket的服务端和客户端都可以提升性能。其中</p>
<ul>
<li>IO多路复用，监测socket对象是否有变化（是否连接成功？是否有数据到来等）。</li>
<li>非阻塞，socket的connect、recv过程不再等待。</li>
</ul>
<p>注意：IO多路复用只能用来监听 IO对象 是否发生变化，常见的有：文件是否可读写、电脑终端设备输入和输出、网络请求（常见）。</p>
<p>在Linux操作系统化中 IO多路复用 有三种模式，分别是：select，poll，epoll。（windows 只支持select模式）</p>
<blockquote>
<p>监测socket对象是否新连接到来 or 新数据到来。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line"> </span><br><span class="line">select最早于1983年出现在4.2BSD中，它通过一个select()系统调用来监视多个文件描述符的数组，当select()返回后，该数组中就绪的文件描述符便会被内核修改标志位，使得进程可以获得这些文件描述符从而进行后续的读写操作。</span><br><span class="line">select目前几乎在所有的平台上支持，其良好跨平台支持也是它的一个优点，事实上从现在看来，这也是它所剩不多的优点之一。</span><br><span class="line">select的一个缺点在于单个进程能够监视的文件描述符的数量存在最大限制，在Linux上一般为1024，不过可以通过修改宏定义甚至重新编译内核的方式提升这一限制。</span><br><span class="line">另外，select()所维护的存储大量文件描述符的数据结构，随着文件描述符数量的增大，其复制的开销也线性增长。同时，由于网络响应时间的延迟使得大量TCP连接处于非活跃状态，但调用select()会对所有socket进行一次线性扫描，所以这也浪费了一定的开销。</span><br><span class="line"> </span><br><span class="line">poll</span><br><span class="line"> </span><br><span class="line">poll在1986年诞生于System V Release 3，它和select在本质上没有多大差别，但是poll没有最大文件描述符数量的限制。</span><br><span class="line">poll和select同样存在一个缺点就是，包含大量文件描述符的数组被整体复制于用户态和内核的地址空间之间，而不论这些文件描述符是否就绪，它的开销随着文件描述符数量的增加而线性增大。</span><br><span class="line">另外，select()和poll()将就绪的文件描述符告诉进程后，如果进程没有对其进行IO操作，那么下次调用select()和poll()的时候将再次报告这些文件描述符，所以它们一般不会丢失就绪的消息，这种方式称为水平触发（Level Triggered）。</span><br><span class="line"> </span><br><span class="line">epoll</span><br><span class="line"> </span><br><span class="line">直到Linux2.6才出现了由内核直接支持的实现方法，那就是epoll，它几乎具备了之前所说的一切优点，被公认为Linux2.6下性能最好的多路I/O就绪通知方法。</span><br><span class="line">epoll可以同时支持水平触发和边缘触发（Edge Triggered，只告诉进程哪些文件描述符刚刚变为就绪状态，它只说一遍，如果我们没有采取行动，那么它将不会再次告知，这种方式称为边缘触发），理论上边缘触发的性能要更高一些，但是代码实现相当复杂。</span><br><span class="line">epoll同样只告知那些就绪的文件描述符，而且当我们调用epoll_wait()获得就绪文件描述符时，返回的不是实际的描述符，而是一个代表就绪描述符数量的值，你只需要去epoll指定的一个数组中依次取得相应数量的文件描述符即可，这里也使用了内存映射（mmap）技术，这样便彻底省掉了这些文件描述符在系统调用时复制的开销。</span><br><span class="line">另一个本质的改进在于epoll采用基于事件的就绪通知方式。在select/poll中，进程只有在调用一定的方法后，内核才对所有监视的文件描述符进行扫描，而epoll事先通过epoll_ctl()来注册一个文件描述符，一旦基于某个文件描述符就绪时，内核会采用类似callback的回调机制，迅速激活这个文件描述符，当进程调用epoll_wait()时便得到通知。</span><br></pre></td></tr></table></figure>



<p>补充：socket + 非阻塞+ IO多路复用（IO操作对象都可以监测 + 文件）。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>OSI 7层模型</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">应用层、表示层、会话层、传输层、网络层、数据链路层、物理层。</span><br></pre></td></tr></table></figure>
</li>
<li><p>UDP和TCP的区别</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UDP，速度快但无法保证数据的准确性。</span><br><span class="line">TCP，需要先创建可靠连接，在进行收发数据（ack）。</span><br></pre></td></tr></table></figure>
</li>
<li><p>TCP的三次握手和四次挥手</p>
</li>
<li><p>为什么会有粘包？如何解决？</p>
</li>
<li><p>如何让socket请求变成非阻塞？</p>
</li>
<li><p>IO多路复用的作用？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">监测多个 IO对象 是否发生变化（可读/可写）。</span><br></pre></td></tr></table></figure>

<ul>
<li>IO多路复用 + 非阻塞 + socket服务端，可以让服务端同时处理多个客户端的请求。</li>
<li>IO多路复用 + 非阻塞 + socket客户端，可以向服务端同时发起多个请求。</li>
</ul>
</li>
</ol>
<h2 id="作业（模块大作业）"><a href="#作业（模块大作业）" class="headerlink" title="作业（模块大作业）"></a>作业（模块大作业）</h2><p>请基于TCP协议实现一个网盘系统，包含客户端、服务端，各自需求如下：</p>
<ul>
<li><p>客户端</p>
<ul>
<li><p>用户注册，注册成功之后，在服务端的指定目录下为此用户创建一个文件夹，该文件夹下以后存储当前用户的数据（类似于网盘）。</p>
</li>
<li><p>用户登录</p>
</li>
<li><p>查看网盘目录下的所有文件（一级即可），ls命令</p>
</li>
<li><p>上传文件，如果网盘已存在则重新上传（覆盖）。</p>
</li>
<li><p>下载文件（进度条）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">先判断要下载本地路径中是否存在该文件。</span><br><span class="line">- 不存在，直接下载</span><br><span class="line">- 存在，则让用户选择是否续传（继续下载）。</span><br><span class="line">	- 续传，在上次的基础上继续下载。</span><br><span class="line">	- 不续传，从头开始下载。</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>服务端</p>
<ul>
<li><p>支持注册，并为用户初始化相关目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注册成功之后，将所有用户信息存储到特定的Excel文件中</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day21%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/%E7%AC%94%E8%AE%B0/day21/image-20210218163617245.png" alt="image-20210218163617245"></p>
</li>
<li><p>支持登录</p>
</li>
<li><p>支持查看当前用户网盘目录下的所有文件。</p>
</li>
<li><p>支持上传</p>
</li>
<li><p>支持下载</p>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:31" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:31+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:32" itemprop="dateModified" datetime="2024-08-28T18:21:32+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day20-网络编程"><a href="#day20-网络编程" class="headerlink" title="day20 网络编程"></a>day20 网络编程</h1><p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210220091551058.png" alt="image-20210220091551058"></p>
<p>课程目标：掌握网络相关的基础知识并可以基于Python开发程序（基于网络进行数据传输）。</p>
<p>课程概要：</p>
<ul>
<li>网络必备基础</li>
<li>网络编程（Python代码）</li>
<li>B&#x2F;S和C&#x2F;S架构</li>
</ul>
<h2 id="1-必备基础"><a href="#1-必备基础" class="headerlink" title="1.必备基础"></a>1.必备基础</h2><p>你必须了解的网络相关设备和基础概念。</p>
<h3 id="1-1-网络架构"><a href="#1-1-网络架构" class="headerlink" title="1.1 网络架构"></a>1.1 网络架构</h3><p>假设 <strong>alex</strong> 上了一个野鸡大学买了一台电脑，电脑里存了1部小电影，整宿整宿的在宿舍反复的看。</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210204184431053-3881170.png" alt="image-20210204184431053"></p>
<p><strong>alex</strong> 如何想要和室友 <strong>于超</strong> 进行收发数据，可以通过一根网线来进行连接，并进行数据的传输。</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210204185417337-3881170.png" alt="image-20210204185417337"></p>
<h4 id="1-1-1-交换机"><a href="#1-1-1-交换机" class="headerlink" title="1.1.1 交换机"></a>1.1.1 交换机</h4><p>其他2位室友如何也想和他们的电脑相互连接然后进行资源的共享，此时就需要一个设备 【二层交换机】组件一个局域网。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">当电脑接入交换机之后，我们需要为每台电脑分配一个IP，例如：</span><br><span class="line">    - 电脑<span class="number">1</span>：<span class="number">192.168</span><span class="number">.10</span><span class="number">.1</span></span><br><span class="line">    - 电脑<span class="number">2</span>：<span class="number">192.168</span><span class="number">.10</span><span class="number">.2</span></span><br><span class="line">    - 电脑<span class="number">3</span>：<span class="number">192.168</span><span class="number">.10</span><span class="number">.3</span></span><br><span class="line">    - 电脑<span class="number">4</span>：<span class="number">192.168</span><span class="number">.10</span><span class="number">.4</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">局域网内容个电脑之间是基于ARP协议来进行通信，例如：A电脑向 IP为192.168.10.3的另一个电脑发送消息。</span><br><span class="line"></span><br><span class="line">第一步：A封装数据包，此时只知道目标IP不知道目标mac地址（未知mac地址时默认会设置为FF）。</span><br><span class="line">第二步：将数据包发送到交换机，交换机通过广播的形式将数据发送给所有电脑。</span><br><span class="line">第三步：目标电脑接收到数据包后，监测自己是否是目标IP。</span><br><span class="line">		- 是，收到数据并回复。</span><br><span class="line">		- 不是，则丢弃包。</span><br><span class="line"></span><br><span class="line">为防止每次发送消息都是广播形式，每台电脑的内部都为维护了一个ARP表，接受到数据时（无论是否自己的）都会记录自己了解的IP和MAC的对应关系，例如：</span><br><span class="line">    Internet地址			       物理地址</span><br><span class="line">    192.168.10.1            14-9d-da-2a-dd-0a</span><br><span class="line">    192.168.10.3            14-9d-da-2a-dd-0c</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">以便于下次在发送消息时，就知道了目标的mac地址，直接让交换机转发给指定的电脑（单播）。</span><br><span class="line"></span><br><span class="line">同时，当有消息发送经过二层交换机时他的内容也会维护记录了交换机接口和连接的电脑的mac地址的对应关系，例如：</span><br><span class="line">    接口（网卡）               mac地址</span><br><span class="line">      接口1              14-9d-da-2a-dd-0A</span><br><span class="line">      接口2              14-9d-da-2a-dd-0B</span><br><span class="line">      接口3              14-9d-da-2a-dd-0C</span><br><span class="line">      ...</span><br><span class="line">这样一来，交换机在进行数据转发时，效率就更高了。</span><br><span class="line"></span><br><span class="line">注意：每台电脑出厂时在网卡中都设置了唯一的mac地址（不重复），网卡集成在主板上，如果更换了主板则mac地址也会变更。</span><br></pre></td></tr></table></figure>

<img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210221142111266.png" alt="image-20210221142111266" style="zoom:33%;">

<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210205143317465-3881170.png" alt="image-20210205143317465"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">头部信息：xxx</span><br><span class="line">数据：你好</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">头部信息：xxx</span><br><span class="line">数据：收到</span><br></pre></td></tr></table></figure>







<h4 id="1-1-2-路由器"><a href="#1-1-2-路由器" class="headerlink" title="1.1.2 路由器"></a>1.1.2 路由器</h4><p>多个宿舍之间想想要组建一个相互可以通信网络，此时需要【二层交换机】和【企业路由器】配合组建稍微大一点的局域网（同时也可缓解广播风暴）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">划分好网络结构之后，其实会给各宿舍的电脑分配IP和网关，例如：</span><br><span class="line">   宿舍A：</span><br><span class="line">		- 电脑1：192.168.10.1  网关：192.168.10.254</span><br><span class="line">		- 电脑2：192.168.10.2  网关：192.168.10.254</span><br><span class="line">		- 电脑3：192.168.10.3  网关：192.168.10.254</span><br><span class="line">		- 电脑4：192.168.10.4  网关：192.168.10.254</span><br><span class="line">   宿舍B</span><br><span class="line">		- 电脑1：192.168.20.1  网关：192.168.20.254</span><br><span class="line">		- 电脑2：192.168.20.2  网关：192.168.20.254</span><br><span class="line">		- 电脑3：192.168.20.3  网关：192.168.20.254</span><br><span class="line">		- 电脑4：192.168.20.4  网关：192.168.20.254</span><br><span class="line"></span><br><span class="line">然后再在路由器中配置路由表（包含网段和路由器上的接口的对应关系），例如：</span><br><span class="line">	 接口             IP</span><br><span class="line">     eth0   	  192.168.10.254（192.168.10网段）</span><br><span class="line">     eth1   	  192.168.20.254（192.168.20网段）</span><br><span class="line">    </span><br><span class="line">想与外部网络通信，需要配置网关，网关就是路由表中配置的指向此网段的IP。其实就类似于贸易出口都需要经过海关。</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">数据通信的过程结合了APR协议和IP协议，例如：宿舍A的电脑<span class="number">1</span>向宿舍B的电脑<span class="number">3</span>发送消息（目标IP：<span class="number">192.168</span><span class="number">.20</span><span class="number">.3</span>）。</span><br><span class="line"></span><br><span class="line">简化过程：</span><br><span class="line">	- 宿舍A的电脑<span class="number">1</span>，通过广播或单播将数据发送到网管（路由器）</span><br><span class="line">    - 路由器接收到数据之后，再通过对应的接口把数据通过广播的形式发送到宿舍B。</span><br><span class="line">注意：各自局域网内通过学习并记录相关mac地址后，就可以不再使用广播形式，而是使用单播来发送消息了。</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210204205902286-3890545.png" alt="image-20210204205902286"></p>
<img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210221145506980.png" alt="image-20210221145506980" style="zoom:33%;">

<h4 id="1-1-3-三层交换机"><a href="#1-1-3-三层交换机" class="headerlink" title="1.1.3 三层交换机"></a>1.1.3 三层交换机</h4><p>三层交换机集成了 交换机 &amp; 路由器的功能（大部分路由器功能），上述的三个设备其实可以用一个三层交换机就可以搞定。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">按照下图，在三层交换机上分别做如下几件事：</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 划分两个vlan，模拟出来路由器的两个接口。</span><br><span class="line"><span class="number">2.</span> 将交换机的接口划分给指定的vlan，例如：</span><br><span class="line">	接口<span class="number">1</span>、<span class="number">2</span>、<span class="number">3</span>划分给一个vlan，相当于交换机连接上了路由器。</span><br><span class="line">    接口<span class="number">4</span>、<span class="number">5</span>、<span class="number">6</span>划分给一个vlan，相当于交换机连接上了路由器。</span><br><span class="line"><span class="number">3.</span> 电脑连接上交换机。</span><br><span class="line"><span class="number">4.</span> 进行相应的配置。</span><br><span class="line">	宿舍A（左边）电脑配置：</span><br><span class="line">    	- 电脑<span class="number">1</span>：<span class="number">192.168</span><span class="number">.10</span><span class="number">.1</span>  网关：<span class="number">192.168</span><span class="number">.10</span><span class="number">.254</span>	对应交换机接口：<span class="number">1</span></span><br><span class="line">		- 电脑<span class="number">2</span>：<span class="number">192.168</span><span class="number">.10</span><span class="number">.2</span>  网关：<span class="number">192.168</span><span class="number">.10</span><span class="number">.254</span>	对应交换机接口：<span class="number">2</span></span><br><span class="line">		- 电脑<span class="number">3</span>：<span class="number">192.168</span><span class="number">.10</span><span class="number">.3</span>  网关：<span class="number">192.168</span><span class="number">.10</span><span class="number">.254</span>	对应交换机接口：<span class="number">3</span></span><br><span class="line">	宿舍B（右边）电脑配置：</span><br><span class="line">		- 电脑<span class="number">1</span>：<span class="number">192.168</span><span class="number">.20</span><span class="number">.1</span>  网关：<span class="number">192.168</span><span class="number">.20</span><span class="number">.254</span>	对应交换机接口：<span class="number">4</span></span><br><span class="line">		- 电脑<span class="number">2</span>：<span class="number">192.168</span><span class="number">.20</span><span class="number">.2</span>  网关：<span class="number">192.168</span><span class="number">.20</span><span class="number">.254</span>	对应交换机接口：<span class="number">5</span></span><br><span class="line">		- 电脑<span class="number">3</span>：<span class="number">192.168</span><span class="number">.20</span><span class="number">.3</span>  网关：<span class="number">192.168</span><span class="number">.20</span><span class="number">.254</span>	对应交换机接口：<span class="number">6</span></span><br><span class="line">	</span><br><span class="line">    交换机中的路由配置：</span><br><span class="line">    	  接口               IP</span><br><span class="line">         左vlan   	  <span class="number">192.168</span><span class="number">.10</span><span class="number">.254</span>（<span class="number">192.168</span><span class="number">.10</span>网段）</span><br><span class="line">         右vlan   	  <span class="number">192.168</span><span class="number">.20</span><span class="number">.254</span>（<span class="number">192.168</span><span class="number">.20</span>网段）</span><br><span class="line">        </span><br><span class="line">通过上述的配置之后，就可以实现宿舍A和宿舍B的网络通信了。</span><br></pre></td></tr></table></figure>



<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210206092454106-3881170.png" alt="image-20210206092454106"></p>
<h4 id="1-1-4-小型企业基础网络架构"><a href="#1-1-4-小型企业基础网络架构" class="headerlink" title="1.1.4 小型企业基础网络架构"></a>1.1.4 小型企业基础网络架构</h4><p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210206225844012.png" alt="image-20210206225844012"></p>
<h4 id="1-1-5-家庭网络架构"><a href="#1-1-5-家庭网络架构" class="headerlink" title="1.1.5 家庭网络架构"></a>1.1.5 家庭网络架构</h4><p>家用路由器集成了是交换机和路由的功能（性能差、价格便宜）。</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210206231121896.png" alt="image-20210206231121896"></p>
<h4 id="1-1-6-互联网"><a href="#1-1-6-互联网" class="headerlink" title="1.1.6 互联网"></a>1.1.6 互联网</h4><p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210206231602247.png" alt="image-20210206231602247"></p>
<h3 id="1-2-网络核心词汇"><a href="#1-2-网络核心词汇" class="headerlink" title="1.2 网络核心词汇"></a>1.2 网络核心词汇</h3><h4 id="1-2-1-子网掩码和IP"><a href="#1-2-1-子网掩码和IP" class="headerlink" title="1.2.1 子网掩码和IP"></a>1.2.1 子网掩码和IP</h4><p>之前说过，接入网络设备后，需要一个IP来代指次电脑，例如：192.168.10.1 。</p>
<p>IP其是一个32位的二进制，为了便于记忆就将它分为4组，每组8位，由小数点分开，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">二进制表示：00000000.10010111.11111111.00001111</span><br><span class="line">十进制表示：251.151.255.15</span><br><span class="line"></span><br><span class="line">0~255</span><br><span class="line">192.178.11.211</span><br><span class="line">192.178.11.311</span><br></pre></td></tr></table></figure>

<p>在网络中的每台电脑都会有一个IP与之绑定，这样通过IP就可以找到相应的电脑。</p>
<p>一个IP地址可以划分为两个部分，即：网络地址 + 主机地址。</p>
<ul>
<li><p>问题1：如何确定网络地址和主机地址呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">通过子网掩码就可以确定IP的网络地址和主机地址。</span><br><span class="line"></span><br><span class="line">示例1：</span><br><span class="line">    	IP：192.168.1.199      11000000.10101000.00000001.11000111</span><br><span class="line">	子网掩码：255.255.255.0     11111111.11111111.11111111.00000000</span><br><span class="line">此时，网络地址就是前24位 + 主机地址是后8位。你可能见过有些IP这样写 192.168.1.199/24，意思也是前24位是网络地址。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">示例2：</span><br><span class="line">    	IP：192.168.99.254     11000000.10101000.01100011.11111110</span><br><span class="line">	子网掩码：255.255.240.0     11111111.11111111.11111100.00000000</span><br><span class="line">此时，网络地址就是前22位 + 主机地址是后10位。你可能见过有些IP这样写 192.168.99.254/22，意思也是前22位是网络地址。</span><br></pre></td></tr></table></figure>
</li>
<li><p>问题2：划分 网络地址 + 主机地址 的意义是什么？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">网络地址相同的IP，也称为属于同一个网段。</span><br><span class="line">在局域网内只有同一个网段的IP才能相互通信，不同网段IP想要通信需要借助路由的转发才能通信。</span><br><span class="line"></span><br><span class="line">当了解子网掩码之后，其实就可以确定某个网段可以容纳的主机个数，例如：</span><br><span class="line">【IP: 192.168.10.2  掩码：255.255.255.0】 和 【192.168.10.251 掩码：255.255.255.0】 数据同一个网段。</span><br><span class="line"></span><br><span class="line">	示例网段的主机范围：11000000.10101000.00001010. 00000001  ~  11000000.10101000.00001010.  11111110</span><br><span class="line">	                 --------------------------              --------------------------</span><br><span class="line">	                          网络地址                                   网络地址</span><br><span class="line">				           192.168.10.1                 ~           192.168.10.254</span><br><span class="line">                           </span><br><span class="line">【IP: 192.168.8.1  掩码：255.255.240.0】 和 【192.168.11.254 掩码：255.255.240.0】 数据同一个网段。</span><br><span class="line">	子网掩码：255.255.240.0</span><br><span class="line">	示例网段的主机范围：11000000.10101000.000010 00.00000001  ~  11000000.10101000.000010 11.11111110</span><br><span class="line">	                 11111111.11111111.111111 00.00000000</span><br><span class="line">	                 ------------------------                 ------------------------</span><br><span class="line">	                          网络地址                                   网络地址</span><br><span class="line">				           192.168.8.1                 ~           192.168.11.254</span><br><span class="line">				           </span><br><span class="line">【IP: 192.168.96.1  掩码：255.255.240.0】 和 【192.168.99.254  掩码：255.255.240.0】 数据同一个网段。</span><br><span class="line">	示例网段的主机范围：11000000.10101000.011000 00.00000001  ~  11000000.10101000.011000 11.11111110</span><br><span class="line">	         </span><br><span class="line">	                 ------------------------                 ------------------------</span><br><span class="line">	                          网络地址                                   网络地址</span><br><span class="line">				           192.168.96.1                 ~           192.168.99.254    </span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207001644433.png" alt="image-20210207001644433"><br><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207135331788.png" alt="image-20210207135331788"></p>
</li>
</ul>
<h4 id="1-2-2-DHCP"><a href="#1-2-2-DHCP" class="headerlink" title="1.2.2 DHCP"></a>1.2.2 DHCP</h4><p>在一个局域网内想要给某台电脑分配IP有两种方式：</p>
<ul>
<li><p>手动设置，打开指定菜单栏在里面输入相应的IP信息。</p>
</li>
<li><p>自动获取</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 在电脑端，IP地址获取方式设置为自动。</span><br><span class="line">- 在路由器或三层交换机，开启DHCP服务，并设置IP地址池。（家用路由器上也是基于DHCP服务自动分配的IP）</span><br><span class="line"></span><br><span class="line">这样，电脑只要连接只该网络，DHCP服务就会为它自动分配IP、子网掩码、网关。</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207143152690.png" alt="image-20210207143152690"></p>
<img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207143340596.png" alt="image-20210207143340596" style="zoom:33%;">



<h4 id="1-2-3-内网和公网IP"><a href="#1-2-3-内网和公网IP" class="headerlink" title="1.2.3 内网和公网IP"></a>1.2.3 内网和公网IP</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一般情况下，内网IP都用这些（潜规则）：</span><br><span class="line">	- 10.0.0.0 到 10.255.255.255</span><br><span class="line">	- 172.16.0.0 到172.31.255.255</span><br><span class="line">	- 192.168.0.0 到192.168.255.255</span><br></pre></td></tr></table></figure>

<p>之前我们自己在一个局域网内为电脑分配的IP都称为<code>内网IP</code>，基于内网IP可以在一个局域网内进行相互通信（也需要相关的配置）。</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207211646642.png" alt="image-20210207211646642"></p>
<p>如果想要通过互联网进行通信，就必须借助公网IP。例如，右边家庭电脑想访问左边某公司服务器上的部署的网站：</p>
<ul>
<li>第一步：左边公司，去运营商申请公网的固定IP（办理专线宽带时运营商会分配至少1个固定的IP地址），其实运营商就是将你拉的这个专线和固定IP创建绑定关系。（假设公网IP：123.206.15.88）</li>
<li>第二步：配置公网IP与指定服务器的转发规则。</li>
<li>第二步：右边家庭，如果想要访问某个公司服务器上的网网站，只需要执行指定IP：123.206.15.88，运营商就会根据IP找到与之关联的公司专线，并通过公司路由器、防火墙等设备找到指定的服务器。</li>
</ul>
<p>按理说，每个从运营商接入网的用户都可以有一个外网IP，但由于全球用户太多而IP根本就不够分配，所以，运营商网络会进行划分，让多个家庭宽带用户共用一个公网IP（动态，可能每次上网公网IP都不一样）。</p>
<p>让家庭用户想要通过网络访问访问其他IP时，先发给运营商由运营商向外转发到其他IP。</p>
<p>注意：外部用户想要访问家庭宽带的IP时，运营商不会把请求转发到我们的电脑。</p>
<img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210221173632272.png" alt="image-20210221173632272" style="zoom:50%;">



<p>所以，以后如果你想开发一个网站供全球的用户访问，那你就需要做以下几件事：</p>
<ul>
<li>拉专线，申请固定公网IP</li>
<li>买一台服务器（就是性能好的电脑）</li>
<li>公网IP绑定至此服务器</li>
<li>将写好的代码放在服务器上并运行起来</li>
</ul>
<p>这样就可以搞定了…</p>
<p><strong>扩展</strong>：IPv4和IPv6</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IPv4，长度为 <span class="number">32</span> 位（<span class="number">4</span> 个字节）， 格式：A.B.C.D</span><br><span class="line">IPv6，长度为 <span class="number">128</span> 位（<span class="number">16</span> 个字节），用<span class="string">&quot;:&quot;</span>分成<span class="number">8</span>段，格式：XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX:XXXX（每个X是一个<span class="number">16</span>进制数）。</span><br></pre></td></tr></table></figure>



<h4 id="1-2-4-云服务器"><a href="#1-2-4-云服务器" class="headerlink" title="1.2.4 云服务器"></a>1.2.4 云服务器</h4><p>大家可能之前听说过：阿里云、腾讯云、亚马逊aws等之类的平台都在搞云服务器，那是个啥？</p>
<img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207214828047.png" alt="image-20210207214828047" style="zoom:50%;">



<p>简单的说：他们造了一个机房（网吧），买了很多很多的服务器（高性能电脑），然后将他们放在机房，然后通电+通网，主要对外去租赁这些服务器资源，让用户不必再自己  拉专线+配置网络+买服务器。</p>
<p>假设，你想要在腾讯云租一台服务器，就可以根据自己的需求去选择配置，腾讯云会根据配置在他的物理机上虚拟出一个服务器，并进行相应的环境初始化并绑定公网固定IP，这样你就可以快速拥有一台可以被大家访问的服务器了。</p>
<p>注意：一台性能非常高的物理机虚拟出很多虚拟机，类似于你在自己电脑上通过vmware、parallel等搞出多个虚拟机。</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207215523168.png" alt="image-20210207215523168"></p>
<h4 id="1-2-5-端口"><a href="#1-2-5-端口" class="headerlink" title="1.2.5 端口"></a>1.2.5 端口</h4><p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207221334711.png" alt="image-20210207221334711"></p>
<p>假设，你在腾讯租了一台云服务器（外网IP:123.206.15.88），然后又开发了 2 个网站运行在服务器上。</p>
<p>那么问题来了，用户在自己的电脑或手机上如何来分别访问同一台服务器上两个程序呢？</p>
<p>其实，在计算机中有一个 <code>端口</code> 的概念，每个程序想要通过网络进行通讯都必须要指定一个端口，例如：</p>
<ul>
<li>网站A：使用8001端口，那么用户在自己电脑上或手机上访问时指定 IP和端口 即可，如： <code>123.206.15.88:8001</code> </li>
<li>网站B：使用8002端口，那么用户在自己电脑上或手机上访问时指定 IP和端口 即可，如： <code>123.206.15.88:8002</code></li>
</ul>
<p>注意：端口的取值范围：0 ~ 65535，很多端口在计算机的内部已被使用，我们平时自定义时尽量选择5000之后的端口。</p>
<p>示例：访问百度</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207230929229.png" alt="image-20210207230929229"></p>
<p>提示：如果在浏览器上只写IP不写端口，则默认是80端口。</p>
<h4 id="1-2-6-域名"><a href="#1-2-6-域名" class="headerlink" title="1.2.6 域名"></a>1.2.6 域名</h4><p>假设你创业开发了一个网站，用户很难记住你的公网IP：<code>123.206.15.88:80</code>   &#96;&#96;123.206.15.88&#96;。</p>
<p>所以，域名就诞生了，让域名和IP创建对应关系，用户只需要记住域名就可以了，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www.baidu.com   --&gt;  110.242.68.3</span><br><span class="line">www.taobao.com  --&gt; 121.18.239.232</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>注意：域名只是和IP创建了对应关系，与端口无关 <code>www.baidu.com:80</code>。</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207221334711.png" alt="image-20210207221334711"></p>
<p>在用户在自己的电脑或手机上输入域名去访问时，其实要执行两个步骤：</p>
<ul>
<li>根据域名寻找IP。（寻找IP）</li>
<li>获得IP之后，再通过IP再去访问指定服务器。</li>
</ul>
<p>在电脑上属如域名后，寻找IP的过程如下：</p>
<ul>
<li><p>第一步：在自己电脑的DNS缓存记录中寻找 域名对应的IP，如果未命中，则执行下一步。</p>
</li>
<li><p>第二步：在自己电脑的hosts文件中寻找，如果未命中，则执行下一步。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- mac系统：/etc/hosts 文件中</span><br><span class="line">- win系统：C:\Windows\System32\drivers\etc\hosts 文件中</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内容示例</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>	localhost</span><br><span class="line"><span class="number">255.255</span><span class="number">.255</span><span class="number">.255</span>	broadcasthost</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> kubernetes.docker.internal</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.55</span> www.pythonav.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三步：在自己电脑上找到DNS配置的地址（本地域名服务器），去这个地址寻找域名对应的IP，如果未命中，则执行下一步。<br><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207233253951.png" alt="image-20210207233253951"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">常见的DNS服务器地址：</span><br><span class="line">	<span class="number">114.114</span><span class="number">.114</span><span class="number">.114</span>（<span class="number">114</span> DNS）</span><br><span class="line">    <span class="number">223.5</span><span class="number">.5</span><span class="number">.5</span>（阿里 AliDNS）</span><br><span class="line">    <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>（Google DNS，随着Google在中国的没落和国内官方的限制，已经不是太好用了）</span><br><span class="line">    ...</span><br><span class="line">    各大运营商也有相应的DNS服务器...</span><br><span class="line">    </span><br><span class="line">如果你选择的是自动获得DNS，那么就会使用本地运营商的DNS服务器了。</span><br></pre></td></tr></table></figure>
</li>
<li><p>第四步：去根域名服务器中询问（全球共13台根域名服务器，距离中国最近的一台是在日本）</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210208102929953.png" alt="image-20210208102929953"></p>
</li>
</ul>
<p><span style="color:red;"><strong>问题来了</strong></span></p>
<p>了解域名是怎么回事之后？现在你如果想要让自己的网站通过域名来访问，应该怎么办呢？【目前了解即可】</p>
<ul>
<li><p>租一个域名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ICANN，域名的总管理者（美国一个非营利机构），它仅制定域名政策，注册业务它会授权给一些顶级注册商。</span><br><span class="line">顶级注册商，可以对外销售域名，但要受国家 互联网络信息中心的管理。例如：中国万网(阿里云收购），中国新网，新网互联，商务中国，中国频道等。</span><br><span class="line">代理注册商，顶级注册上可以再招一些代理帮助他们卖域名。</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210208110607388.png" alt="image-20210208110607388"></p>
</li>
<li><p>备案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">现在国内注册域名后，需要进行备案（提交一些网站、个人或企业 等信息）后才能使用。</span><br><span class="line">注册成功后，可按照引导备案：https://beian.aliyun.com/</span><br><span class="line"></span><br><span class="line">注意：国外的域名无需备案就能使用。</span><br></pre></td></tr></table></figure>
</li>
<li><p>域名解析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">让域名和IP创建关联关系，并将关系同步到相关：本地域名服务器 和 根域名服务器（含顶级和二级域名服务器）。</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210208110829796.png" alt="image-20210208110829796"></p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210208110938038.png" alt="image-20210208110938038"></p>
</li>
</ul>
<h2 id="2-网络编程"><a href="#2-网络编程" class="headerlink" title="2. 网络编程"></a>2. 网络编程</h2><p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207221334711.png" alt="image-20210207221334711"></p>
<p>Python中内置了一个socket模块，可以快速实现网络之间进行传输数据。例如：</p>
<ul>
<li><p>服务端，放在左边云服务器中（有固定IP）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.监听本机的IP和端口</span></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;123.206.15.88&#x27;</span>, <span class="number">8001</span>)) <span class="comment"># IP,端口</span></span><br><span class="line">sock.listen(<span class="number">5</span>) <span class="comment"># 支持排队等待5人</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 2.等待，有人来连接（阻塞）</span></span><br><span class="line">    conn, addr = sock.accept() <span class="comment"># 等待客户端来连接（阻塞）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.等待，连接者发送消息（阻塞）</span></span><br><span class="line">    client_data = conn.recv(<span class="number">1024</span>) <span class="comment"># 等待接收客户端发来数据</span></span><br><span class="line">    <span class="built_in">print</span>(client_data.decode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="comment"># 字节</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4.给连接者回复消息</span></span><br><span class="line">    conn.sendall(<span class="string">&quot;hello world&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.关闭连接</span></span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.停止服务端程序</span></span><br><span class="line">sock.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端，放在右边用户电脑上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 向指定IP发送连接请求</span></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;123.206.15.88&#x27;</span>, <span class="number">8001</span>)) <span class="comment"># 向服务端发起连接（阻塞）10s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 连接成功之后，发送消息</span></span><br><span class="line">client.sendall(<span class="string">&#x27;hello&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 等待，消息的回复（阻塞）</span></span><br><span class="line">reply = client.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(reply)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 关闭连接</span></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>上述示例需要借助于互联网，你至少需要租一台云服务器才能通信。</p>
<p>为了节省学习成本，大家可以在自己电脑上模拟【服务端】和【客户端】，等以后项目开发完毕后，再租服务器并部署到服务器上。</p>
<p>注意：在自己本地运行上述代码时，要监听和连接时的IP地址。</p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210208164809572.png" alt="image-20210208164809572"></p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210221190543727.png" alt="image-20210221190543727"></p>
<p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210221190426551.png" alt="image-20210221190426551"></p>
<p>当然，你也可以把在自己的局域网内找两台电脑，A作为服务端，B作为客户端，这样两者也可以通信。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">服务端的代码需修改：监听的IP修改为A的IP地址。</span><br><span class="line">客户端的代码需修改：连接的IP修改为A的IP地址（客户端要去找到服务端，并与服务端创建连接）。</span><br></pre></td></tr></table></figure>



<p>注意事项：</p>
<ul>
<li><p>本机：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务端IP：127.0.0.1  / 192.168.28.92（局域网IP）</span><br></pre></td></tr></table></figure>
</li>
<li><p>局域网：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务端IP：<span class="number">192.168</span><span class="number">.28</span><span class="number">.92</span>（局域网IP）    </span><br></pre></td></tr></table></figure>
</li>
<li><p>互联网</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">服务端IP：<span class="number">123.206</span><span class="number">.15</span><span class="number">.88</span>（外网IP）</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="案例：智障客服"><a href="#案例：智障客服" class="headerlink" title="案例：智障客服"></a>案例：智障客服</h3><ul>
<li><p>服务端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.监听本机的IP和端口</span></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))  <span class="comment"># 127.0.0.1 或 查看自己局域网本地IP地址</span></span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 2.等待，有人来连接（阻塞）</span></span><br><span class="line">    conn, addr = sock.accept()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;有人来连接了...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.连接成功后立即发送</span></span><br><span class="line">    conn.sendall(<span class="string">&quot;欢迎使用xx系统，请输入您想要办理的业务！&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 3.等待接受信息</span></span><br><span class="line">        data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        data_string = data.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 4.回复消息</span></span><br><span class="line">        conn.sendall(<span class="string">&quot;你说啥？&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;断开连接了&quot;</span>)</span><br><span class="line">    <span class="comment"># 5.关闭与此人的连接</span></span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.停止服务端程序</span></span><br><span class="line">sock.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 向指定IP发送连接请求</span></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.连接成功后，获取系统登录信息</span></span><br><span class="line">message = client.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(message.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    content = <span class="built_in">input</span>(<span class="string">&quot;请输入(q/Q退出)：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> content.upper() == <span class="string">&#x27;Q&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    client.sendall(content.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 等待，消息的回复</span></span><br><span class="line">    reply = client.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(reply.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭连接，关闭连接时会向服务端发送空数据。</span></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="案例：文件上传"><a href="#案例：文件上传" class="headerlink" title="案例：文件上传"></a>案例：文件上传</h3><ul>
<li><p>服务端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.bind((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))  <span class="comment"># 127.0.0.1 或 查看自己局域网本地IP地址</span></span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">conn, addr = sock.accept()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收文件大小</span></span><br><span class="line">data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">total_file_size = <span class="built_in">int</span>(data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收文件内容</span></span><br><span class="line">file_object = <span class="built_in">open</span>(<span class="string">&#x27;xxx.png&#x27;</span>, mode=<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">recv_size = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 每次最多接收1024字节</span></span><br><span class="line">    data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">    file_object.write(data)</span><br><span class="line">    file_object.flush()</span><br><span class="line"></span><br><span class="line">    recv_size += <span class="built_in">len</span>(data)</span><br><span class="line">    <span class="comment"># 上传完成</span></span><br><span class="line">    <span class="keyword">if</span> recv_size == total_file_size:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收完毕，关闭连接</span></span><br><span class="line">conn.close()</span><br><span class="line">sock.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>客户端</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket()</span><br><span class="line">client.connect((<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8001</span>))</span><br><span class="line"></span><br><span class="line">file_path = <span class="built_in">input</span>(<span class="string">&quot;请输入要上传的文件：&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先发送文件大小</span></span><br><span class="line">file_size = os.stat(file_path).st_size</span><br><span class="line">client.sendall(<span class="built_in">str</span>(file_size).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;准备...&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;开始上传..&quot;</span>)</span><br><span class="line">file_object = <span class="built_in">open</span>(file_path, mode=<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">read_size = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    chunk = file_object.read(<span class="number">1024</span>) <span class="comment"># 每次读取1024字节</span></span><br><span class="line">    client.sendall(chunk)</span><br><span class="line">    read_size += <span class="built_in">len</span>(chunk)</span><br><span class="line">    <span class="keyword">if</span> read_size == file_size:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-B-S和C-S架构"><a href="#3-B-S和C-S架构" class="headerlink" title="3. B&#x2F;S和C&#x2F;S架构"></a>3. B&#x2F;S和C&#x2F;S架构</h2><p><img src="/2024/09/07/python_course-master/day20%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/%E7%AC%94%E8%AE%B0/day20/image-20210207221334711.png" alt="image-20210207221334711"></p>
<p>平时在开发或与人沟通时，经常会有人提到b&#x2F;s和c&#x2F;s架构，他们是啥意思呢？</p>
<ul>
<li><p>C&#x2F;S架构，是Client和Server的简称。开发这种架构的程序意味着你即需要开发客户端也需要开发服务端。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例如：你电脑的上QQ、百度网盘、钉钉、QQ音乐 等安装在电脑上的软件。</span><br><span class="line"></span><br><span class="line">服务端：互联网公司会开发一个程序放在他们的服务器上，用于给客户端提供数据支持。</span><br><span class="line">客户端：大家在电脑安装的相关程序，内部会连接服务端进行收发数据并提供 交互和展示的功能。</span><br></pre></td></tr></table></figure>
</li>
<li><p>B&#x2F;S架构，是Browser和Server的简称。开发这种架构的程序意味着你开发服务端即可，客户端用用户电脑上的浏览器来代替。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">例如：淘宝、京东等网站。</span><br><span class="line"></span><br><span class="line">服务端：互联网公司开发一个网站，放在他们的服务器上。</span><br><span class="line">客户端：不需要开发，用现成的浏览器即可。</span><br></pre></td></tr></table></figure></li>
</ul>
<p>简而言之，B&#x2F;S架构就是开发网站；C&#x2F;S架构就是开发安装在电脑的软件。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>了解常见设备和网络架构。</li>
<li>掌握常见网络词汇的意思。</li>
<li>了解B&#x2F;S和C&#x2F;S架构的区别。</li>
<li>基于Python的socket模块实现网络编程。</li>
</ol>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ol>
<li><p>简述 二层交换机 &amp; 路由器 &amp; 三层交换机 的作用。</p>
</li>
<li><p>简述常见词：IP、子网掩码、DHCP、公网IP、端口、域名的作用。</p>
</li>
<li><p>实现远程用户认证系统。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">客户端：</span><br><span class="line">	<span class="number">1.</span> 运行程序，连接服务端并获取服务端发送的欢迎使用xx系统信息。</span><br><span class="line">    <span class="number">2.</span> 输入用户名和密码，并将用户名和密码发送到服务端去校验。</span><br><span class="line">    <span class="number">3.</span> 登录失败，重试（Q退出）。</span><br><span class="line">    <span class="number">4.</span> 登录成功，进入系统，提示登录成功</span><br><span class="line">服务端：</span><br><span class="line">	<span class="number">1.</span> 客户端连接上服务端，返回 欢迎使用xx系统信息。</span><br><span class="line">    <span class="number">2.</span> 等待客户端发送用户名和密码进行校验（用户名和密码在文件中）</span><br><span class="line">    <span class="number">3.</span> 登录失败，返回错误信息。</span><br><span class="line">    <span class="number">4.</span> 登录成功，返回成功提示的内容。</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:31" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:31+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:30" itemprop="dateModified" datetime="2024-08-28T18:21:30+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day18-面向对象进阶"><a href="#day18-面向对象进阶" class="headerlink" title="day18 面向对象进阶"></a>day18 面向对象进阶</h1><p><img src="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/image-20210127104158850.png" alt="image-20210127104158850"></p>
<p>课程目标：掌握面向对象进阶相关知识点，能沟通更加自如的使用面向对象来进行编程。</p>
<p>今日概要：</p>
<ul>
<li><p>成员</p>
<ul>
<li>变量<ul>
<li>实例变量</li>
<li>类变量</li>
</ul>
</li>
<li>方法<ul>
<li>绑定方法</li>
<li>类方法</li>
<li>静态方法</li>
</ul>
</li>
<li>属性</li>
</ul>
</li>
<li><p>成员修饰符（公有&#x2F;私有）</p>
</li>
<li><p>“对象嵌套”</p>
</li>
<li><p>特殊成员</p>
</li>
</ul>
<h2 id="1-成员"><a href="#1-成员" class="headerlink" title="1.成员"></a>1.成员</h2><p>面向对象中的所有成员如下：</p>
<ul>
<li>变量<ul>
<li>实例变量</li>
<li>类变量</li>
</ul>
</li>
<li>方法<ul>
<li>绑定方法</li>
<li>类方法</li>
<li>静态方法</li>
</ul>
</li>
<li>属性</li>
</ul>
<p>通过面向对象进行编程时，会遇到很多种情况，也会使用不同的成员来实现，接下来我们来逐一介绍成员特性和应用场景。</p>
<h3 id="1-1-变量"><a href="#1-1-变量" class="headerlink" title="1.1 变量"></a>1.1 变量</h3><ul>
<li>实例变量，属于对象，每个对象中各自维护自己的数据。</li>
<li>类变量，属于类，可以被所有对象共享，一般用于给对象提供公共数据（类似于全局变量）。</li>
</ul>
<p><img src="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/image-20210127111042911.png" alt="image-20210127111042911"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    country = <span class="string">&quot;中国&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># message = &quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;.format(Person.country, self.name, self.age)</span></span><br><span class="line">        message = <span class="string">&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.country, self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Person.country) <span class="comment"># 中国</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = Person(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(p1.name)</span><br><span class="line"><span class="built_in">print</span>(p1.age)</span><br><span class="line"><span class="built_in">print</span>(p1.country) <span class="comment"># 中国</span></span><br><span class="line"></span><br><span class="line">p1.show() <span class="comment"># 中国-武沛齐-20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>提示：当把每个对象中都存在的相同的示例变量时，可以选择把它放在类变量中，这样就可以避免对象中维护多个相同数据。</p>
<h4 id="易错点-面试题"><a href="#易错点-面试题" class="headerlink" title="易错点 &amp; 面试题"></a>易错点 &amp; 面试题</h4><p>第一题：注意读和写的区别。</p>
<p><img src="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/image-20210127111042911.png" alt="image-20210127111042911"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    country = <span class="string">&quot;中国&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        message = <span class="string">&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.country, self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Person.country) <span class="comment"># 中国</span></span><br><span class="line"></span><br><span class="line">p1 = Person(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(p1.name) <span class="comment"># 武沛齐</span></span><br><span class="line"><span class="built_in">print</span>(p1.age) <span class="comment"># 20</span></span><br><span class="line"><span class="built_in">print</span>(p1.country) <span class="comment"># 中国</span></span><br><span class="line">p1.show() <span class="comment"># 中国-武沛齐-20</span></span><br><span class="line"></span><br><span class="line">p1.name = <span class="string">&quot;root&quot;</span>     <span class="comment"># 在对象p1中讲name重置为root</span></span><br><span class="line">p1.num = <span class="number">19</span>          <span class="comment"># 在对象p1中新增实例变量 num=19</span></span><br><span class="line">p1.country = <span class="string">&quot;china&quot;</span> <span class="comment"># 在对象p1中新增实例变量 country=&quot;china&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p1.country)   <span class="comment"># china</span></span><br><span class="line"><span class="built_in">print</span>(Person.country) <span class="comment"># 中国</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    country = <span class="string">&quot;中国&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        message = <span class="string">&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.country, self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Person.country) <span class="comment"># 中国</span></span><br><span class="line"></span><br><span class="line">Person.country = <span class="string">&quot;美国&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = Person(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(p1.name) <span class="comment"># 武沛齐</span></span><br><span class="line"><span class="built_in">print</span>(p1.age) <span class="comment"># 20</span></span><br><span class="line"><span class="built_in">print</span>(p1.country) <span class="comment"># 美国</span></span><br></pre></td></tr></table></figure>





<p>第二题：继承关系中的读写</p>
<p><img src="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/image-20210127124925846.png" alt="image-20210127124925846"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    country = <span class="string">&quot;中国&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        message = <span class="string">&quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(Person.country, self.name, self.age)</span><br><span class="line">        <span class="comment"># message = &quot;&#123;&#125;-&#123;&#125;-&#123;&#125;&quot;.format(self.country, self.name, self.age)</span></span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读</span></span><br><span class="line"><span class="built_in">print</span>(Base.country) <span class="comment"># 中国</span></span><br><span class="line"><span class="built_in">print</span>(Person.country) <span class="comment"># 中国</span></span><br><span class="line"></span><br><span class="line">obj = Person(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">19</span>)</span><br><span class="line"><span class="built_in">print</span>(obj.country) <span class="comment"># 中国</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写</span></span><br><span class="line">Base.country = <span class="string">&quot;china&quot;</span></span><br><span class="line">Person.country = <span class="string">&quot;泰国&quot;</span></span><br><span class="line">obj.country = <span class="string">&quot;日本&quot;</span></span><br></pre></td></tr></table></figure>

<p>面试题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child1</span>(<span class="title class_ inherited__">Parent</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child2</span>(<span class="title class_ inherited__">Parent</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Parent.x, Child1.x, Child2.x) <span class="comment"># 1 1 1</span></span><br><span class="line"></span><br><span class="line">Child1.x = <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(Parent.x, Child1.x, Child2.x) <span class="comment"># 1 2 1</span></span><br><span class="line"></span><br><span class="line">Parent.x = <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(Parent.x, Child1.x, Child2.x) <span class="comment"># 3 2 3</span></span><br></pre></td></tr></table></figure>



<h3 id="1-2-方法"><a href="#1-2-方法" class="headerlink" title="1.2 方法"></a>1.2 方法</h3><ul>
<li>绑定方法，默认有一个self参数，由对象进行调用（此时self就等于调用方法的这个对象）【对象&amp;类均可调用】</li>
<li>类方法，默认有一个cls参数，用类或对象都可以调用（此时cls就等于调用方法的这个类）【对象&amp;类均可调用】</li>
<li>静态方法，无默认参数，用类和对象都可以调用。【对象&amp;类均可调用】</li>
</ul>
<p><img src="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/image-20210127141701335.png" alt="image-20210127141701335"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name,age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;绑定方法&quot;</span>, self.name)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;类方法&quot;</span>, cls)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f3</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;静态方法&quot;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 绑定方法（对象）</span></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">20</span>)</span><br><span class="line">obj.f1() <span class="comment"># Foo.f1(obj)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 类方法</span></span><br><span class="line">Foo.f2()  <span class="comment"># cls就是当前调用这个方法的类。（类）</span></span><br><span class="line">obj.f2()  <span class="comment"># cls就是当前调用这个方法的对象的类。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 静态方法</span></span><br><span class="line">Foo.f3()  <span class="comment"># 类执行执行方法（类）</span></span><br><span class="line">obj.f3()  <span class="comment"># 对象执行执行方法</span></span><br></pre></td></tr></table></figure>

<p>在Python中比较灵活，方法都可以通过对象和类进行调用；而在java、c#等语言中，绑定方法只能由对象调用；类方法或静态方法只能由类调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Download</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, folder_path</span>):</span><br><span class="line">        self.folder_path = folder_path</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download_dou_yin</span>():</span><br><span class="line">        <span class="comment"># 下载抖音</span></span><br><span class="line">        res = requests.get(<span class="string">&#x27;.....&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;xxx.mp4&quot;</span>, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(res.content)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download_dou_yin_2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 下载抖音</span></span><br><span class="line">        res = requests.get(<span class="string">&#x27;.....&#x27;</span>)</span><br><span class="line">        path = os.path.join(self.folder_path, <span class="string">&#x27;xxx.mp4&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(res.content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Download(<span class="string">&quot;video&quot;</span>)</span><br><span class="line">obj.download_dou_yin()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>面试题：</p>
<p>在类中 @classmethod 和 @staticmethod 的作用？</p>
<h3 id="1-3-属性"><a href="#1-3-属性" class="headerlink" title="1.3 属性"></a>1.3 属性</h3><p>属性其实是由绑定方法 + 特殊装饰器 组合创造出来的，让我们以后在调用方法时可以不加括号，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>)</span><br><span class="line"></span><br><span class="line">v1 = obj.f1()</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line">v2 = obj.f2</span><br><span class="line"><span class="built_in">print</span>(v2)</span><br></pre></td></tr></table></figure>



<p>示例：以之前开发的分页的功能。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pagination</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, current_page, per_page_num=<span class="number">10</span></span>):</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> current_page.isdecimal():</span><br><span class="line">            self.current_page = <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line">        <span class="keyword">if</span> current_page &lt; <span class="number">1</span>:</span><br><span class="line">            self.current_page = <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.current_page = current_page</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.per_page_num</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">end</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.per_page_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user_list = [<span class="string">&quot;用户-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">3000</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页显示，每页显示10条</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    page = <span class="built_in">input</span>(<span class="string">&quot;请输入页码：&quot;</span>)</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># page，当前访问的页码</span></span><br><span class="line">    <span class="comment"># 10，每页显示10条数据</span></span><br><span class="line">	<span class="comment"># 内部执行Pagination类的init方法。</span></span><br><span class="line">    pg_object = Pagination(page, <span class="number">20</span>)</span><br><span class="line">    </span><br><span class="line">    page_data_list = user_list[ pg_object.start() : pg_object.end() ]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> page_data_list:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pagination</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, current_page, per_page_num=<span class="number">10</span></span>):</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> current_page.isdecimal():</span><br><span class="line">            self.current_page = <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line">        <span class="keyword">if</span> current_page &lt; <span class="number">1</span>:</span><br><span class="line">            self.current_page = <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.current_page = current_page</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.per_page_num</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">end</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.per_page_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user_list = [<span class="string">&quot;用户-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">3000</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页显示，每页显示10条</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    page = <span class="built_in">input</span>(<span class="string">&quot;请输入页码：&quot;</span>)</span><br><span class="line"></span><br><span class="line">    pg_object = Pagination(page, <span class="number">20</span>)</span><br><span class="line">    page_data_list = user_list[ pg_object.start : pg_object.end ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> page_data_list:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>



<p>其实，除了咱们写的示例意外，在很多模块和框架的源码中也有porperty的身影，例如：requests模块。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内部下载视频，并将下载好的数据分装到Response对象中。</span></span><br><span class="line">res = requests.get(</span><br><span class="line">    url=<span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span>,</span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 FS&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 去对象中获取text，其实需要读取原始文本字节并转换为字符串</span></span><br><span class="line">res.text</span><br></pre></td></tr></table></figure>



<p>关于属性的编写有两种方式：</p>
<ul>
<li><p>方式一，基于装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @x.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @x.deleter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">x</span>(<span class="params">self</span>):</span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">obj = C()</span><br><span class="line"></span><br><span class="line">obj.x</span><br><span class="line">obj.x = <span class="number">123</span></span><br><span class="line"><span class="keyword">del</span> obj.x</span><br></pre></td></tr></table></figure>
</li>
<li><p>方式二，基于定义变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getx</span>(<span class="params">self</span>): </span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setx</span>(<span class="params">self, value</span>): </span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">delx</span>(<span class="params">self</span>): </span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line">    x = <span class="built_in">property</span>(getx, setx, delx, <span class="string">&quot;I&#x27;m the &#x27;x&#x27; property.&quot;</span>)</span><br><span class="line">    </span><br><span class="line">obj = C()</span><br><span class="line"></span><br><span class="line">obj.x</span><br><span class="line">obj.x = <span class="number">123</span></span><br><span class="line"><span class="keyword">del</span> obj.x</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Django源码一撇：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WSGIRequest</span>(<span class="title class_ inherited__">HttpRequest</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, environ</span>):</span><br><span class="line">        script_name = get_script_name(environ)</span><br><span class="line">        <span class="comment"># If PATH_INFO is empty (e.g. accessing the SCRIPT_NAME URL without a</span></span><br><span class="line">        <span class="comment"># trailing slash), operate as if &#x27;/&#x27; was requested.</span></span><br><span class="line">        path_info = get_path_info(environ) <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        self.environ = environ</span><br><span class="line">        self.path_info = path_info</span><br><span class="line">        <span class="comment"># be careful to only replace the first slash in the path because of</span></span><br><span class="line">        <span class="comment"># http://test/something and http://test//something being different as</span></span><br><span class="line">        <span class="comment"># stated in https://www.ietf.org/rfc/rfc2396.txt</span></span><br><span class="line">        self.path = <span class="string">&#x27;%s/%s&#x27;</span> % (script_name.rstrip(<span class="string">&#x27;/&#x27;</span>),</span><br><span class="line">                               path_info.replace(<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">        self.META = environ</span><br><span class="line">        self.META[<span class="string">&#x27;PATH_INFO&#x27;</span>] = path_info</span><br><span class="line">        self.META[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>] = script_name</span><br><span class="line">        self.method = environ[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>].upper()</span><br><span class="line">        <span class="comment"># Set content_type, content_params, and encoding.</span></span><br><span class="line">        self._set_content_type_params(environ)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            content_length = <span class="built_in">int</span>(environ.get(<span class="string">&#x27;CONTENT_LENGTH&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> (ValueError, TypeError):</span><br><span class="line">            content_length = <span class="number">0</span></span><br><span class="line">        self._stream = LimitedStream(self.environ[<span class="string">&#x27;wsgi.input&#x27;</span>], content_length)</span><br><span class="line">        self._read_started = <span class="literal">False</span></span><br><span class="line">        self.resolver_match = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_scheme</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.environ.get(<span class="string">&#x27;wsgi.url_scheme&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_post</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;_post&#x27;</span>):</span><br><span class="line">            self._load_post_and_files()</span><br><span class="line">        <span class="keyword">return</span> self._post</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_set_post</span>(<span class="params">self, post</span>):</span><br><span class="line">        self._post = post</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">FILES</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(self, <span class="string">&#x27;_files&#x27;</span>):</span><br><span class="line">            self._load_post_and_files()</span><br><span class="line">        <span class="keyword">return</span> self._files</span><br><span class="line"></span><br><span class="line">    POST = <span class="built_in">property</span>(_get_post, _set_post)</span><br></pre></td></tr></table></figure>



<p>写在最后，对属性进行一个补充：</p>
<p>由于属性和实例变量的调用方式相同，所以在编写时需要注意：属性名称 不要 实例变量 重名。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">123</span>)</span><br><span class="line"><span class="built_in">print</span>(obj.name)</span><br><span class="line"><span class="built_in">print</span>(obj.func)</span><br></pre></td></tr></table></figure>



<p>一旦重名，可能就会有报错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name  <span class="comment"># 报错，错认为你想要调用 @name.setter 装饰的方法。</span></span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.name, self.age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">123</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name </span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.name, self.age) <span class="comment"># 报错，循环调用自己（直到层级太深报错）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @name.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="built_in">print</span>(value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">123</span>)</span><br><span class="line"><span class="built_in">print</span>(obj.name)</span><br></pre></td></tr></table></figure>



<p>如果真的想要在名称上创建一些关系，可以让实例变量加上一个下划线。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self._name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self._name, self.age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">123</span>)</span><br><span class="line"><span class="built_in">print</span>(obj._name)</span><br><span class="line"><span class="built_in">print</span>(obj.name)</span><br></pre></td></tr></table></figure>



<h2 id="2-成员修饰符"><a href="#2-成员修饰符" class="headerlink" title="2.成员修饰符"></a>2.成员修饰符</h2><p>Python中成员的修饰符就是指的是：公有、私有。</p>
<ul>
<li>公有，在任何地方都可以调用这个成员。</li>
<li>私有，只有在类的内部才可以调用改成员（成员是以两个下划线开头，则表示该成员为私有）。</li>
</ul>
<p>示例一：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.__name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">123</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 公有成员</span></span><br><span class="line"><span class="built_in">print</span>(obj.age)</span><br><span class="line">v1 = self.get_age()</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 私有成员</span></span><br><span class="line"><span class="comment"># print(obj.__name) # 错误，由于是私有成员，只能在类中进行使用。</span></span><br><span class="line">v2 = obj.get_data()</span><br><span class="line"><span class="built_in">print</span>(v2)</span><br></pre></td></tr></table></figure>



<p>示例2：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_age</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公有的get_age&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__get_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;私有的__get_data方法&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proxy</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公有的proxy&quot;</span>)</span><br><span class="line">        self.__get_data()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj.get_age()</span><br><span class="line"></span><br><span class="line">obj.proxy()</span><br></pre></td></tr></table></figure>



<p>示例3：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__name</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公有的get_age&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proxy</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;公有的proxy&quot;</span>)</span><br><span class="line">        self.__name</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">v1 = obj.proxy</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>特别提醒：父类中的私有成员，子类无法继承。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;base.__data&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">num</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;base.num&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        self.num()</span><br><span class="line">        self.__data() <span class="comment"># # 不允许执行父类中的私有方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj.func()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;base.__data&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">num</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;base.num&quot;</span>)</span><br><span class="line">        self.__data()  <span class="comment"># 不允许执行父类中的私有方法</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        self.num()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj.func()</span><br></pre></td></tr></table></figure>





<p>写在最后，按理说私有成员是无法被外部调用，但如果用一些特殊的语法也可以（Flask源码中有这种写法，大家写代码不推荐这样写）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.__num = <span class="number">123</span></span><br><span class="line">        self.age = <span class="number">19</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__msg</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line"><span class="built_in">print</span>(obj.age)</span><br><span class="line"><span class="built_in">print</span>(obj._Foo__num)</span><br><span class="line">obj._Foo__msg()</span><br></pre></td></tr></table></figure>



<p>成员是否可以作为独立的功能暴露给外部，让外部调用并使用。</p>
<ul>
<li>可以，公有。</li>
<li>不可以，内部其他放的一个辅助，私有。</li>
</ul>
<h2 id="3-对象嵌套"><a href="#3-对象嵌套" class="headerlink" title="3.对象嵌套"></a>3.对象嵌套</h2><p>在基于面向对象进行编程时，对象之间可以存在各种各样的关系，例如：组合、关联、依赖等（Java中的称呼），用大白话来说就是各种嵌套。</p>
<p>下面我们就用示例来学习常见的嵌套的情景：</p>
<p>情景一：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 学生类 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">message</span>(<span class="params">self</span>):</span><br><span class="line">        data = <span class="string">&quot;我是一名学生，我叫:&#123;&#125;,我今年&#123;&#125;岁&quot;</span>.<span class="built_in">format</span>(self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">s1 = Student(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">19</span>)</span><br><span class="line">s2 = Student(<span class="string">&quot;Alex&quot;</span>, <span class="number">19</span>)</span><br><span class="line">s3 = Student(<span class="string">&quot;日天&quot;</span>, <span class="number">19</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Classes</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 班级类 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, title</span>):</span><br><span class="line">        self.title = title</span><br><span class="line">        self.student_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_student</span>(<span class="params">self, stu_object</span>):</span><br><span class="line">        self.student_list.append(stu_object)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_students</span>(<span class="params">self, stu_object_list</span>):</span><br><span class="line">        <span class="keyword">for</span> stu <span class="keyword">in</span> stu_object_list:</span><br><span class="line">            self.add_student(stu)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_members</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.student_list:</span><br><span class="line">            <span class="comment"># print(item)</span></span><br><span class="line">            item.message()</span><br><span class="line"></span><br><span class="line">c1 = Classes(<span class="string">&quot;三年二班&quot;</span>)</span><br><span class="line">c1.add_student(s1)</span><br><span class="line">c1.add_students([s2, s3])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c1.title)</span><br><span class="line"><span class="built_in">print</span>(c1.student_list)</span><br></pre></td></tr></table></figure>



<p>情景二：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 学生类 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, class_object</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.class_object = class_object</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">message</span>(<span class="params">self</span>):</span><br><span class="line">        data = <span class="string">&quot;我是一名&#123;&#125;班的学生，我叫:&#123;&#125;,我今年&#123;&#125;岁&quot;</span>.<span class="built_in">format</span>(self.class_object.title, self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Classes</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 班级类 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, title</span>):</span><br><span class="line">        self.title = title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1 = Classes(<span class="string">&quot;Python全栈&quot;</span>)</span><br><span class="line">c2 = Classes(<span class="string">&quot;Linux云计算&quot;</span>)</span><br><span class="line"></span><br><span class="line">user_object_list = [</span><br><span class="line">    Student(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">19</span>, c1),</span><br><span class="line">    Student(<span class="string">&quot;Alex&quot;</span>, <span class="number">19</span>, c1),</span><br><span class="line">    Student(<span class="string">&quot;日天&quot;</span>, <span class="number">19</span>, c2)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> user_object_list:</span><br><span class="line">    <span class="built_in">print</span>(obj.name,obj.age, obj.class_object.title)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/image-20210127215951115.png" alt="image-20210127215951115"></p>
<p>情景三：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 学生类 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, class_object</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.class_object = class_object</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">message</span>(<span class="params">self</span>):</span><br><span class="line">        data = <span class="string">&quot;我是一名&#123;&#125;班的学生，我叫:&#123;&#125;,我今年&#123;&#125;岁&quot;</span>.<span class="built_in">format</span>(self.class_object.title, self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Classes</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 班级类 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, title, school_object</span>):</span><br><span class="line">        self.title = title</span><br><span class="line">        self.school_object = school_object</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">School</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 学校类 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1 = School(<span class="string">&quot;北京校区&quot;</span>)</span><br><span class="line">s2 = School(<span class="string">&quot;上海校区&quot;</span>)</span><br><span class="line"></span><br><span class="line">c1 = Classes(<span class="string">&quot;Python全栈&quot;</span>, s1)</span><br><span class="line">c2 = Classes(<span class="string">&quot;Linux云计算&quot;</span>, s2)</span><br><span class="line"></span><br><span class="line">user_object_list = [</span><br><span class="line">    Student(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">19</span>, c1),</span><br><span class="line">    Student(<span class="string">&quot;Alex&quot;</span>, <span class="number">19</span>, c1),</span><br><span class="line">    Student(<span class="string">&quot;日天&quot;</span>, <span class="number">19</span>, c2)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> user_object_list:</span><br><span class="line">    <span class="built_in">print</span>(obj.name, obj.class_object.title ,  obj.class_object.school_object.name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/2024/09/07/python_course-master/day18%20%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%BF%9B%E9%98%B6/%E7%AC%94%E8%AE%B0/day18/image-20210127220654414.png" alt="image-20210127220654414"></p>
<h2 id="4-特殊成员"><a href="#4-特殊成员" class="headerlink" title="4.特殊成员"></a>4.特殊成员</h2><p>在Python的类中存在一些特殊的方法，这些方法都是 <code>__方法__</code> 格式，这种方法在内部均有特殊的含义，接下来我们来讲一些常见的特殊成员：</p>
<ul>
<li><p><code>__init__</code>，初始化方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__new__</code>，构造方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;第二步：初始化对象，在空对象中创建数据&quot;</span>)</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;第一步：先创建空对象并返回&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">object</span>.__new__(cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__call__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;执行call方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj()</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__str__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;哈哈哈哈&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">data = <span class="built_in">str</span>(obj)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__dict__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">19</span>)</span><br><span class="line"><span class="built_in">print</span>(obj.__dict__)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__getitem__</code>、<code>__setitem__</code>、<code>__delitem__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__setitem__</span>(<span class="params">self, key, value</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__delitem__</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo(<span class="string">&quot;武沛齐&quot;</span>, <span class="number">19</span>)</span><br><span class="line"></span><br><span class="line">obj[<span class="string">&quot;x1&quot;</span>]</span><br><span class="line">obj[<span class="string">&#x27;x2&#x27;</span>] = <span class="number">123</span></span><br><span class="line"><span class="keyword">del</span> obj[<span class="string">&#x27;x3&#x27;</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__enter__</code>、<code>__exit__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;进入了&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">666</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;出去了&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line"><span class="keyword">with</span> obj <span class="keyword">as</span> data:</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">超前知识：数据连接，每次对远程的数据进行操作时候都必须经历。</span><br><span class="line"><span class="number">1.</span>连接 = 连接数据库</span><br><span class="line"><span class="number">2.</span>操作数据库</span><br><span class="line"><span class="number">3.</span>关闭连接</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SqlHelper</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        self.连接 = 连接数据库</span><br><span class="line">        <span class="keyword">return</span> 连接</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        self.连接.关闭</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">with</span> SqlHelper() <span class="keyword">as</span> 连接:</span><br><span class="line">    连接.操作..</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">with</span> SqlHelper() <span class="keyword">as</span> 连接:</span><br><span class="line">    连接.操作...</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 面试题（补充代码，实现如下功能）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;内部执行&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Context() <span class="keyword">as</span> ctx:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;内部执行&#x27;</span>)</span><br><span class="line">    ctx.do_something()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上下文管理的语法。</p>
</li>
<li><p><code>__add__</code> 等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__add__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.name, other.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">v1 = Foo(<span class="string">&quot;alex&quot;</span>)</span><br><span class="line">v2 = Foo(<span class="string">&quot;sb&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象+值，内部会去执行 对象.__add__方法，并将+后面的值当做参数传递过去。</span></span><br><span class="line">v3 = v1 + v2</span><br><span class="line"><span class="built_in">print</span>(v3)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>__iter__</code></p>
<ul>
<li><p>迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 迭代器类型的定义：</span></span><br><span class="line">    <span class="number">1.</span>当类中定义了 __iter__ 和 __next__ 两个方法。</span><br><span class="line">    <span class="number">2.</span>__iter__ 方法需要返回对象本身，即：self</span><br><span class="line">    <span class="number">3.</span> __next__ 方法，返回下一个数据，如果没有数据了，则需要抛出一个StopIteration的异常。</span><br><span class="line">	官方文档：https://docs.python.org/<span class="number">3</span>/library/stdtypes.html<span class="comment">#iterator-types</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># 创建 迭代器类型 ：</span></span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">IT</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">            self.counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">            self.counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> self.counter == <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">raise</span> StopIteration()</span><br><span class="line">            <span class="keyword">return</span> self.counter</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据类实例化创建一个迭代器对象：</span></span><br><span class="line">    obj1 = IT()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># v1 = obj1.__next__()</span></span><br><span class="line">    <span class="comment"># v2 = obj1.__next__()</span></span><br><span class="line">    <span class="comment"># v3 = obj1.__next__() # 抛出异常</span></span><br><span class="line">    </span><br><span class="line">    v1 = <span class="built_in">next</span>(obj1) <span class="comment"># obj1.__next__()</span></span><br><span class="line">    <span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line">    v2 = <span class="built_in">next</span>(obj1)</span><br><span class="line">    <span class="built_in">print</span>(v2)</span><br><span class="line"></span><br><span class="line">    v3 = <span class="built_in">next</span>(obj1)</span><br><span class="line">    <span class="built_in">print</span>(v3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    obj2 = IT()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> obj2:  <span class="comment"># 首先会执行迭代器对象的__iter__方法并获取返回值，一直去反复的执行 next(对象) </span></span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line">        </span><br><span class="line">迭代器对象支持通过<span class="built_in">next</span>取值，如果取值结束则自动抛出StopIteration。</span><br><span class="line"><span class="keyword">for</span>循环内部在循环时，先执行__iter__方法，获取一个迭代器对象，然后不断执行的<span class="built_in">next</span>取值（有异常StopIteration则终止循环）。</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建生成器函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 创建生成器对象（内部是根据生成器类generator创建的对象），生成器类的内部也声明了：__iter__、__next__ 方法。</span></span><br><span class="line">    obj1 = func()</span><br><span class="line">    </span><br><span class="line">    v1 = <span class="built_in">next</span>(obj1)</span><br><span class="line">    <span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line">    v2 = <span class="built_in">next</span>(obj1)</span><br><span class="line">    <span class="built_in">print</span>(v2)</span><br><span class="line"></span><br><span class="line">    v3 = <span class="built_in">next</span>(obj1)</span><br><span class="line">    <span class="built_in">print</span>(v3)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    obj2 = func()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> obj2:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line">如果按照迭代器的规定来看，其实生成器类也是一种特殊的迭代器类（生成器也是一个中特殊的迭代器）。</span><br></pre></td></tr></table></figure>
</li>
<li><p>可迭代对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果一个类中有__iter__方法且返回一个迭代器对象 ；则我们称以这个类创建的对象为可迭代对象。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> 迭代器对象(生成器对象)</span><br><span class="line">    </span><br><span class="line">obj = Foo() <span class="comment"># obj是 可迭代对象。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可迭代对象是可以使用for来进行循环，在循环的内部其实是先执行 __iter__ 方法，获取其迭代器对象，然后再在内部执行这个迭代器对象的next功能，逐步取值。</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> obj:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">IT</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        self.counter += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.counter == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration()</span><br><span class="line">        <span class="keyword">return</span> self.counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> IT()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo() <span class="comment"># 可迭代对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> obj: <span class="comment"># 循环可迭代对象时，内部先执行obj.__iter__并获取迭代器对象；不断地执行迭代器对象的next方法。</span></span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于可迭代对象&amp;迭代器实现：自定义range</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IterRange</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line">        self.counter = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        self.counter += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.counter == self.num:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration()</span><br><span class="line">        <span class="keyword">return</span> self.counter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Xrange</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, max_num</span>):</span><br><span class="line">        self.max_num = max_num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> IterRange(self.max_num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Xrange(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> obj:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> obj:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于可迭代对象&amp;生成器 实现：自定义range</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Xrange</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, max_num</span>):</span><br><span class="line">        self.max_num = max_num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        counter = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> counter &lt; self.max_num:</span><br><span class="line">            <span class="keyword">yield</span> counter</span><br><span class="line">            counter += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Xrange(<span class="number">100</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> obj:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<p>常见的数据类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v1 = <span class="built_in">list</span>([<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>])</span><br><span class="line"></span><br><span class="line">v1是一个可迭代对象，因为在列表中声明了一个 __iter__ 方法并且返回一个迭代器对象。</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterator, Iterable</span><br><span class="line"></span><br><span class="line">v1 = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]</span><br><span class="line"><span class="built_in">print</span>( <span class="built_in">isinstance</span>(v1, Iterator) )  <span class="comment"># false，判断是否是迭代器；判断依据是__iter__ 和 __next__。</span></span><br><span class="line">v2 = v1.__iter__()</span><br><span class="line"><span class="built_in">print</span>( <span class="built_in">isinstance</span>(v2, Iterator) )  <span class="comment"># True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">v1 = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]</span><br><span class="line"><span class="built_in">print</span>( <span class="built_in">isinstance</span>(v1, Iterable) )  <span class="comment"># True，判断依据是是否有 __iter__且返回迭代器对象。</span></span><br><span class="line"></span><br><span class="line">v2 = v1.__iter__()</span><br><span class="line"><span class="built_in">print</span>( <span class="built_in">isinstance</span>(v2, Iterable) )  <span class="comment"># True，判断依据是是否有 __iter__且返回迭代器对象。</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>面向对象编程中的成员</p>
<ul>
<li>变量<ul>
<li>实例变量</li>
<li>类变量</li>
</ul>
</li>
</ul>
</li>
</ol>
<ul>
<li>方法<br>- 绑定方法<br>- 类方法<br>- 静态方法<ul>
<li>属性</li>
</ul>
</li>
</ul>
<ol start="2">
<li>成员修饰符</li>
<li>对象中的数据嵌套</li>
<li>特殊成员</li>
<li>重要概念：<ul>
<li>迭代器</li>
<li>生成器</li>
<li>可迭代对象</li>
</ul>
</li>
</ol>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ol>
<li><p>列举面向对象的成员并简述他们的特点。</p>
</li>
<li><p>@staticmethod 和 @classmethod的作用是什么？</p>
</li>
<li><p>面向对象中如何让成员变为私有。</p>
</li>
<li><p><code>__new__</code>方法的作用？</p>
</li>
<li><p>简述你理解的：迭代器、生成器、可迭代对象。</p>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    a1 = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.num+self.a1)</span><br><span class="line">    </span><br><span class="line">obj1 = Foo(<span class="number">666</span>)</span><br><span class="line">obj2 = Foo(<span class="number">999</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(obj1.num)</span><br><span class="line"><span class="built_in">print</span>(obj1.a1)</span><br><span class="line"></span><br><span class="line">obj1.num = <span class="number">18</span></span><br><span class="line">obj1.a1 = <span class="number">99</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(obj1.num)</span><br><span class="line"><span class="built_in">print</span>(obj1.a1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(obj2.a1)</span><br><span class="line"><span class="built_in">print</span>(obj2.num)</span><br><span class="line"><span class="built_in">print</span>(obj2.num)</span><br><span class="line"><span class="built_in">print</span>(Foo.a1)</span><br><span class="line"><span class="built_in">print</span>(obj1.a1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果，注意返回值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">999</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        v = self.f1()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;f2&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f3</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;f3&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.f2()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        result = self.f3()</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">v1 = obj.run()</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果【如果有错误，则标注错误即可，并且假设程序报错可以继续执行】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;f1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;f2&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f1()</span><br><span class="line">obj.f2()</span><br><span class="line"></span><br><span class="line">Foo.f1()</span><br><span class="line">Foo.f2()</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果【如果有错误，则标注错误即可，并且假设程序报错可以继续执行】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">class Foo(object):</span><br><span class="line">    </span><br><span class="line">    def f1(self):</span><br><span class="line">        print(&#x27;f1&#x27;)</span><br><span class="line">        self.f2()</span><br><span class="line">        self.f3()</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def f2(cls):</span><br><span class="line">          print(&#x27;f2&#x27;)</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def f3():</span><br><span class="line">          print(&#x27;f3&#x27;)</span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f1()</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果【如果有错误，则标注错误即可，并且假设程序报错可以继续执行】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">cls</span>):</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;f2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f3</span>():</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">&#x27;f3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;f1&#x27;</span>)</span><br><span class="line">        self.f2()</span><br><span class="line">        self.f3()</span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f1()</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果【如果有错误，则标注错误即可，并且假设程序报错可以继续执行】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    a1 = <span class="number">1</span></span><br><span class="line">    __a2 = <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line">        self.__salary = <span class="number">1000</span></span><br><span class="line">        </span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">show_data</span>(<span class="params">self</span>):</span><br><span class="line">         <span class="built_in">print</span>(self.num+self.a1)</span><br><span class="line">    </span><br><span class="line">obj = Foo(<span class="number">666</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(obj.num)</span><br><span class="line"><span class="built_in">print</span>(obj.a1)</span><br><span class="line"><span class="built_in">print</span>(obj.__salary)</span><br><span class="line"><span class="built_in">print</span>(obj.__a2)</span><br><span class="line"><span class="built_in">print</span>(Foo.a1)</span><br><span class="line"><span class="built_in">print</span>(Foo.__a2)</span><br><span class="line">obj.show_data()</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, age</span>):</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">display</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data_list = [Foo(<span class="number">8</span>), Foo(<span class="number">9</span>)]</span><br><span class="line"><span class="comment"># print(data_list[0].age)</span></span><br><span class="line"><span class="comment"># data_list[1].display()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data_list:</span><br><span class="line">    <span class="built_in">print</span>(item.age, item.display()) </span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a1</span>):</span><br><span class="line">        self.a1 = a1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self, arg</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.a1, arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self, arg</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj_list = [Base(<span class="number">1</span>), Foo(<span class="number">2</span>), Foo(<span class="number">3</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> obj_list:</span><br><span class="line">    item.f2(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line">        </span><br><span class="line">v1 = [Foo <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">v2 = [Foo(<span class="number">5</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">v3 = [Foo(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"><span class="built_in">print</span>(v2)</span><br><span class="line"><span class="built_in">print</span>(v3)</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StarkConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">changelist</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.num, request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config_obj_list = [ StarkConfig(<span class="number">1</span>),  StarkConfig(<span class="number">2</span>),  StarkConfig(<span class="number">3</span>) ]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> config_obj_list:</span><br><span class="line">    <span class="built_in">print</span>(item.num)</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StarkConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">changelist</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.num, request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config_obj_list = [StarkConfig(<span class="number">1</span>), StarkConfig(<span class="number">2</span>), StarkConfig(<span class="number">3</span>)]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> config_obj_list:</span><br><span class="line">    item.changelist(<span class="number">666</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StarkConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">changelist</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.num, request)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        self.changelist(<span class="number">999</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoleConfig</span>(<span class="title class_ inherited__">StarkConfig</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">changelist</span>(<span class="params">self, request</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">666</span>, self.num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AdminSite</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._registry = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">self, k, v</span>):</span><br><span class="line">        self._registry[k] = v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">site = AdminSite()</span><br><span class="line"></span><br><span class="line">site.register(<span class="string">&#x27;武沛齐&#x27;</span>, StarkConfig(<span class="number">19</span>))</span><br><span class="line">site.register(<span class="string">&#x27;root&#x27;</span>, StarkConfig(<span class="number">20</span>))</span><br><span class="line">site.register(<span class="string">&quot;admin&quot;</span>, RoleConfig(<span class="number">33</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(site._registry))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, row <span class="keyword">in</span> site._registry.items():</span><br><span class="line">    row.changelist(<span class="number">5</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果（如有报错，请标注报错位置）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">StarkConfig</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num</span>):</span><br><span class="line">        self.num = num</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        self()</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(self.num)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RoleConfig</span>(<span class="title class_ inherited__">StarkConfig</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">345</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> self.num[item]</span><br><span class="line">    </span><br><span class="line">v1 = RoleConfig(<span class="string">&#x27;alex&#x27;</span>)</span><br><span class="line">v2 = StarkConfig(<span class="string">&quot;wupeiqi&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(v1[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(v2[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>
</li>
<li><p>补全代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span>:</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Context() <span class="keyword">as</span> ctx:</span><br><span class="line">    ctx.do_something()</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,title</span>):</span><br><span class="line">        self.title = title</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name,age,depart</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age </span><br><span class="line">        self.depart = depart</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">message</span>(<span class="params">self</span>):</span><br><span class="line">        msg = <span class="string">&quot;我是%s,年龄%s,属于%s&quot;</span> %(self.name,self.age,self.depart.title)</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">d1 = Department(<span class="string">&#x27;人事部&#x27;</span>)</span><br><span class="line">d2 = Department(<span class="string">&#x27;销售部&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p1 = Person(<span class="string">&#x27;武沛齐&#x27;</span>,<span class="number">18</span>,d1)</span><br><span class="line">p2 = Person(<span class="string">&#x27;alex&#x27;</span>,<span class="number">18</span>,d1)</span><br><span class="line"></span><br><span class="line">p1.message()</span><br><span class="line">p2.message()</span><br></pre></td></tr></table></figure>
</li>
<li><p>分析代码关系，并写出正确的输出结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, title</span>):</span><br><span class="line">        self.title = title</span><br><span class="line">        self.children = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, node</span>):</span><br><span class="line">        self.children.append(node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> self.children[item]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root = Node(<span class="string">&quot;中国&quot;</span>)</span><br><span class="line"></span><br><span class="line">root.add(Node(<span class="string">&quot;河南省&quot;</span>))</span><br><span class="line">root.add(Node(<span class="string">&quot;河北省&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(root.title)</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">0</span>].title)</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">1</span>].title)</span><br></pre></td></tr></table></figure>


</li>
<li><p>分析代码关系，并写出正确的输出结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, title</span>):</span><br><span class="line">        self.title = title</span><br><span class="line">        self.children = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, node</span>):</span><br><span class="line">        self.children.append(node)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, item</span>):</span><br><span class="line">        <span class="keyword">return</span> self.children[item]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root = Node(<span class="string">&quot;中国&quot;</span>)</span><br><span class="line"></span><br><span class="line">root.add(Node(<span class="string">&quot;河南省&quot;</span>))</span><br><span class="line">root.add(Node(<span class="string">&quot;河北省&quot;</span>))</span><br><span class="line">root.add(Node(<span class="string">&quot;陕西省&quot;</span>))</span><br><span class="line">root.add(Node(<span class="string">&quot;山东省&quot;</span>))</span><br><span class="line"></span><br><span class="line">root[<span class="number">1</span>].add(Node(<span class="string">&quot;石家庄&quot;</span>))</span><br><span class="line">root[<span class="number">1</span>].add(Node(<span class="string">&quot;保定&quot;</span>))</span><br><span class="line">root[<span class="number">1</span>].add(Node(<span class="string">&quot;廊坊&quot;</span>))</span><br><span class="line"></span><br><span class="line">root[<span class="number">3</span>].add(Node(<span class="string">&quot;潍坊&quot;</span>))</span><br><span class="line">root[<span class="number">3</span>].add(Node(<span class="string">&quot;烟台&quot;</span>))</span><br><span class="line">root[<span class="number">3</span>].add(Node(<span class="string">&quot;威海&quot;</span>))</span><br><span class="line"></span><br><span class="line">root[<span class="number">1</span>][<span class="number">1</span>].add(Node(<span class="string">&quot;雄安&quot;</span>))</span><br><span class="line">root[<span class="number">1</span>][<span class="number">1</span>].add(Node(<span class="string">&quot;望都&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(root.title)</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">0</span>].title)</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">1</span>].title)</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">1</span>][<span class="number">0</span>].title)</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">1</span>][<span class="number">2</span>].title)</span><br><span class="line"><span class="built_in">print</span>(root[<span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>].title)</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:31" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:31+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:30" itemprop="dateModified" datetime="2024-08-28T18:21:30+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第三模块-面向对象-网络-并发编程"><a href="#第三模块-面向对象-网络-并发编程" class="headerlink" title="第三模块 面向对象&amp;网络&amp;并发编程"></a>第三模块 面向对象&amp;网络&amp;并发编程</h1><p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210117230507748.png" alt="image-20210117230507748"></p>
<p>从今天开始，我们将进入系列课程第3个模块的的学习，此模块包含如下三大部分知识：</p>
<ul>
<li><p>面向对象，Python中支持两种编程方式来写代码，分别是：<code>函数式编程</code>、<code>面向对象式编程</code>。</p>
<ul>
<li><p>函数式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义函数，在函数中实现功能</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;一个NB的功能&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行函数</span></span><br><span class="line">func()</span><br></pre></td></tr></table></figure>
</li>
<li><p>面向对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment"># 在类中定义方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;一个NB的功能&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 实例化类的对象</span></span><br><span class="line">obj = Foo()</span><br><span class="line"><span class="comment"># 执行类中的方法</span></span><br><span class="line">obj.func()</span><br></pre></td></tr></table></figure></li>
</ul>
<p>Python支持两种编程方式（其他很多语言只支持一种），所以初学者在刚开始学习往往不知道应如何选择，并且行业内对于 函数式编程 vs 面向对象编程 之间谁更好的讨论也是难分胜负，其实在开发中无论要实现什么样的功能，两种编程模式都能实现，那种让我们能更好实现就选择谁？不必非纠结于那种方式更好，编程语言支持工具，最重要的是把功能实现。</p>
<p>初学者在选择编程方式时候，可以遵循如下规则：</p>
<ul>
<li><p>函数式，推荐初学者使用。理由：上手快且逻辑简单清晰。</p>
</li>
<li><p>面向对象，推荐有一些代码经验后使用。理由：面向对象的思想需要有一定的项目积累之后（写多了&amp;看的多）才能真正理解其精髓，基于面向对象可以编写出扩展性更强的代码（在一定程序上也可以简化代码）。</p>
</li>
</ul>
<p>现阶段，大家在学习面向对象时更重要的是：掌握相关知识点 &amp; 读懂源码 &amp; 编写简单的基于面向对象的程序。</p>
</li>
<li><p>网络编程，学习网络知识后，可以让我们的程序通过网络来进行数据交互和传输 并 掌握其本质。</p>
<p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210117224420539.png" alt="image-20210117224420539"></p>
</li>
<li><p>并发编程，一个程序想要执行的速度更快是必须要掌握并发编程的相关知识。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如：下载10个抖音视频，每个需要2分钟。</span><br><span class="line">- 按照以前的思路，逐一下载就需要20分钟。</span><br><span class="line">- 按照并发的思路，创建10个线程/进程来实现，大概需要2分钟就可以完成。</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="day17-面向对象基础"><a href="#day17-面向对象基础" class="headerlink" title="day17 面向对象基础"></a>day17 面向对象基础</h1><p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210118204107085.png" alt="image-20210118204107085"></p>
<p>课程目标：了解面向对象并可以根据面向对象知识进行编写代码。</p>
<p>课程概要：</p>
<ul>
<li>初识面向对象</li>
<li>三大特性（面向对象）<ul>
<li>封装</li>
<li>继承</li>
<li>多态</li>
</ul>
</li>
<li>再看数据类型</li>
</ul>
<h2 id="1-初识面向对象"><a href="#1-初识面向对象" class="headerlink" title="1. 初识面向对象"></a>1. 初识面向对象</h2><p>想要通过面向对象去实现某个或某些功能时需要2步：</p>
<ul>
<li><p>定义类，在类中定义方法，在方法中去实现具体的功能。</p>
</li>
<li><p>实例化类并的个一个对象，通过对象去调用并执行方法。</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">self, email, content</span>):</span><br><span class="line">        data = <span class="string">&quot;给&#123;&#125;发邮件，内容是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(email,content)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msg_object = Message() <span class="comment"># 实例化一个对象 msg_object，创建了一个一块区域。</span></span><br><span class="line">msg_object.send_email(<span class="string">&quot;wupeiqi@live.com&quot;</span>,<span class="string">&quot;注册成功&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>注意：1.类名称首字母大写&amp;驼峰式命名；2.py3之后默认类都继承object；3.在类种编写的函数称为方法；4.每个方法的第一个参数是self。</p>
<p>类中可以定义多个方法，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">self, email, content</span>):</span><br><span class="line">        data = <span class="string">&quot;给&#123;&#125;发邮件，内容是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(email, content)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_wechat</span>(<span class="params">self, vid, content</span>):</span><br><span class="line">        data = <span class="string">&quot;给&#123;&#125;发微信，内容是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(vid, content)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msg_object = Message()</span><br><span class="line">msg_object.send_email(<span class="string">&quot;wupeiqi@live.com&quot;</span>, <span class="string">&quot;注册成功&quot;</span>)</span><br><span class="line">msg_object.send_wechat(<span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;注册成功&quot;</span>)</span><br></pre></td></tr></table></figure>



<p>你会发现，用面向对象编程写的类有点像归类的意思：将某些相似的函数划分到一个类中。</p>
<p>但，这种编写方式让人感觉有些鸡肋，直接用 函数 写多好呀。对吧？ </p>
<p>别着急，记者往下看。</p>
<h3 id="1-1-对象和self"><a href="#1-1-对象和self" class="headerlink" title="1.1 对象和self"></a>1.1 对象和self</h3><p>在每个类中都可以定义个特殊的：<code>__init__ 初始化方法 </code>，在实例化类创建对象时自动执行，即：<code>对象=类()</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content</span>):</span><br><span class="line">        self.data = content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">self, email</span>):</span><br><span class="line">        data = <span class="string">&quot;给&#123;&#125;发邮件，内容是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(email, self.data)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_wechat</span>(<span class="params">self, vid</span>):</span><br><span class="line">        data = <span class="string">&quot;给&#123;&#125;发微信，内容是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(vid, self.data)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对象 = 类名() # 自动执行类中的 __init__ 方法。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 根据类型创建一个对象，内存的一块 区域 。</span></span><br><span class="line"><span class="comment"># 2. 执行__init__方法，模块会将创建的那块区域的内存地址当self参数传递进去。    往区域中(data=&quot;注册成功&quot;)</span></span><br><span class="line">msg_object = Message(<span class="string">&quot;注册成功&quot;</span>)</span><br><span class="line"></span><br><span class="line">msg_object.send_email(<span class="string">&quot;wupeiqi@live.com&quot;</span>) <span class="comment"># 给wupeiqi@live.com发邮件，内容是：注册成功</span></span><br><span class="line">msg_object.send_wechat(<span class="string">&quot;武沛齐&quot;</span>) <span class="comment"># 给武沛齐发微信，内容是：注册成功</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210123195714019.png" alt="image-20210123195714019"></p>
<p>通过上述的示例，你会发现：</p>
<ul>
<li>对象，让我们可以在它的内部先封装一部分数据，以后想要使用时，再去里面获取。</li>
<li>self，类中的方法需要由这个类的对象来触发并执行（ 对象.方法名 ），且在执行时会自动将对象当做参数传递给self，以供方法中获取对象中已封装的值。</li>
</ul>
<p>注意：除了self默认参数以外，方法中的参数的定义和执行与函数是相同。</p>
<p>当然，根据类也可以创建多个对象并执行其中的方法，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, content</span>):</span><br><span class="line">        self.data = content</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">self, email</span>):</span><br><span class="line">        data = <span class="string">&quot;给&#123;&#125;发邮件，内容是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(email, self.data)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_wechat</span>(<span class="params">self, vid</span>):</span><br><span class="line">        data = <span class="string">&quot;给&#123;&#125;发微信，内容是：&#123;&#125;&quot;</span>.<span class="built_in">format</span>(vid, self.data)</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msg_object = Message(<span class="string">&quot;注册成功&quot;</span>)</span><br><span class="line">msg_object.send_email(<span class="string">&quot;wupeiqi@live.com&quot;</span>) <span class="comment"># 给wupeiqi@live.com发邮件，内容是：注册成功</span></span><br><span class="line">msg_object.send_wechat(<span class="string">&quot;武沛齐&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">login_object = Message(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">login_object.send_email(<span class="string">&quot;wupeiqi@live.com&quot;</span>) <span class="comment"># 给wupeiqi@live.com发邮件，内容是：登录成功</span></span><br><span class="line">login_object.send_wechat(<span class="string">&quot;武沛齐&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210123195714019.png" alt="image-20210123195714019"></p>
<p>面向对象的思想：将一些数据封装到对象中，在执行方法时，再去对象中获取。</p>
<p>函数式的思想：函数内部需要的数据均通过参数的形式传递。</p>
<ul>
<li>self，本质上就是一个参数。这个参数是Python内部会提供，其实本质上就是调用当前方法的那个对象。</li>
<li>对象，基于类实例化出来”一块内存“，默认里面没有数据；经过类的 <code>__init__</code>方法，可以在内存中初始化一些数据。</li>
</ul>
<h3 id="1-2-常见成员"><a href="#1-2-常见成员" class="headerlink" title="1.2 常见成员"></a>1.2 常见成员</h3><p>在编写面向对象相关代码时，最常见成员有：</p>
<ul>
<li>实例变量，属于对象，只能通过对象调用。</li>
<li>绑定方法，属于类，通过对象调用 或 通过类调用。</li>
</ul>
<p>注意：还有很多其他的成员，后续再来介绍。</p>
<p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210126140807446.png" alt="image-20210126140807446"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, n1, n2</span>):</span><br><span class="line">        <span class="comment"># 实例变量</span></span><br><span class="line">        self.name = n1</span><br><span class="line">        self.age = n2</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 绑定方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        msg = <span class="string">&quot;我叫&#123;&#125;，今年&#123;&#125;岁。&quot;</span>.<span class="built_in">format</span>(self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">all_message</span>(<span class="params">self</span>):</span><br><span class="line">        msg = <span class="string">&quot;我是&#123;&#125;人，我叫&#123;&#125;，今年&#123;&#125;岁。&quot;</span>.<span class="built_in">format</span>(Person.country, self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">total_message</span>(<span class="params">self</span>):</span><br><span class="line">        msg = <span class="string">&quot;我是&#123;&#125;人，我叫&#123;&#125;，今年&#123;&#125;岁。&quot;</span>.<span class="built_in">format</span>(self.country, self.name, self.age)</span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行绑定方法</span></span><br><span class="line">p1 = Person(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">20</span>)</span><br><span class="line">p1.show()</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line"><span class="comment"># p1 = Person(&quot;武沛齐&quot;,20)</span></span><br><span class="line"><span class="comment"># Person.show(p1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化，实例化了Person类的对象叫p1</span></span><br><span class="line">p1 = Person(<span class="string">&quot;武沛齐&quot;</span>,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="1-3-应用示例"><a href="#1-3-应用示例" class="headerlink" title="1.3 应用示例"></a>1.3 应用示例</h3><ol>
<li><p>将数据封装到一个对象，便于以后使用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, pwd,age</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.password = pwd</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    user_object_list = []</span><br><span class="line">    <span class="comment"># 用户注册</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        user = <span class="built_in">input</span>(<span class="string">&quot;用户名：&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> user.upper() == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        pwd = <span class="built_in">input</span>(<span class="string">&quot;密码&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># user_object对象中有：name/password</span></span><br><span class="line">        user_object = UserInfo(user, pwd,<span class="number">19</span>)</span><br><span class="line">        <span class="comment"># user_dict = &#123;&quot;name&quot;:user,&quot;password&quot;:pwd&#125;</span></span><br><span class="line">        </span><br><span class="line">        user_object_list.append(user_object)</span><br><span class="line">     <span class="comment"># user_object_list.append(user_dict)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 展示用户信息</span></span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> user_object_list:</span><br><span class="line">        <span class="built_in">print</span>(obj.name, obj.password)</span><br><span class="line">        </span><br><span class="line">总结：</span><br><span class="line">	- 数据封装到对象，以后再去获取。</span><br><span class="line">    - 规范数据（约束）</span><br></pre></td></tr></table></figure>

<p>注意：用字典也可以实现做封装，只不过字典在操作值时还需要自己写key，面向对象只需要 <code>.</code> 即可获取对象中封装的数据。</p>
</li>
<li><p>将数据分装到对象中，在方法中对原始数据进行加工处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user_list = [<span class="string">&quot;用户-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">3000</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页显示，每页显示10条</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    page = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入页码：&quot;</span>))</span><br><span class="line"></span><br><span class="line">    start_index = (page - <span class="number">1</span>) * <span class="number">10</span></span><br><span class="line">    end_index = page * <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    page_data_list = user_list[start_index:end_index]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> page_data_list:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Pagination</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, current_page, per_page_num=<span class="number">10</span></span>):</span><br><span class="line">        self.per_page_num = per_page_num</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> current_page.isdecimal():</span><br><span class="line">            self.current_page = <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        current_page = <span class="built_in">int</span>(current_page)</span><br><span class="line">        <span class="keyword">if</span> current_page &lt; <span class="number">1</span>:</span><br><span class="line">            self.current_page = <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.current_page = current_page</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> (self.current_page - <span class="number">1</span>) * self.per_page_num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">end</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.current_page * self.per_page_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user_list = [<span class="string">&quot;用户-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">3000</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分页显示，每页显示10条</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    page = <span class="built_in">input</span>(<span class="string">&quot;请输入页码：&quot;</span>)</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># page，当前访问的页码</span></span><br><span class="line">    <span class="comment"># 10，每页显示10条数据</span></span><br><span class="line">	<span class="comment"># 内部执行Pagination类的init方法。</span></span><br><span class="line">    pg_object = Pagination(page, <span class="number">20</span>)</span><br><span class="line">    page_data_list = user_list[ pg_object.start() : pg_object.end() ]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> page_data_list:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>



<p>还有这个示例：将数据封装到一个对象中，然后再方法中对已封装的数据进行操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DouYin</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, folder_path</span>):</span><br><span class="line">        self.folder_path = folder_path</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(folder_path):</span><br><span class="line">            os.makedirs(folder_path)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">download</span>(<span class="params">self, file_name, url</span>):</span><br><span class="line">        res = requests.get(</span><br><span class="line">            url=url,</span><br><span class="line">            headers=&#123;</span><br><span class="line">                <span class="string">&quot;user-agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 FS&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">        file_path = os.path.join(self.folder_path, file_name)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_path, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(res.content)</span><br><span class="line">            f.flush()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multi_download</span>(<span class="params">self, video_list</span>):</span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> video_list:</span><br><span class="line">            self.download(item[<span class="number">0</span>], item[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    douyin_object = DouYin(<span class="string">&quot;videos&quot;</span>)</span><br><span class="line"></span><br><span class="line">    douyin_object.download(</span><br><span class="line">        <span class="string">&quot;罗斯.mp4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    video_list = [</span><br><span class="line">        (<span class="string">&quot;a1.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0300fc20000bvi413nedtlt5abaa8tg&quot;</span>),</span><br><span class="line">        (<span class="string">&quot;a2.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0d00fb60000bvi0ba63vni5gqts0uag&quot;</span>),</span><br><span class="line">        (<span class="string">&quot;a3.mp4&quot;</span>, <span class="string">&quot;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200f240000buuer5aa4tij4gv6ajqg&quot;</span>)</span><br><span class="line">    ]</span><br><span class="line">    douyin_object.multi_download(video_list)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据类创建多个对象，在方法中对对象中的数据进行修改。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Police</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;警察&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, role</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.role = role</span><br><span class="line">        <span class="keyword">if</span> role == <span class="string">&quot;队员&quot;</span>:</span><br><span class="line">            self.hit_points = <span class="number">200</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.hit_points = <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_status</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 查看警察状态 &quot;&quot;&quot;</span></span><br><span class="line">        message = <span class="string">&quot;警察&#123;&#125;的生命值为:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.name, self.hit_points)</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bomb</span>(<span class="params">self, terrorist_list</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 投炸弹，炸掉恐怖分子 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> terrorist <span class="keyword">in</span> terrorist_list:</span><br><span class="line">            terrorist.blood -= <span class="number">200</span></span><br><span class="line">            terrorist.show_status()</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">p1 = Police(&quot;武沛齐&quot;,&quot;队员&quot;)</span></span><br><span class="line"><span class="string">p1.show_status()</span></span><br><span class="line"><span class="string">p1.bomb([&quot;alex&quot;,&quot;李杰&quot;])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">p2 = Police(&quot;日天&quot;,&quot;队长&quot;)</span></span><br><span class="line"><span class="string">p2.show_status()</span></span><br><span class="line"><span class="string">p2.bomb([&quot;alex&quot;,&quot;李杰&quot;])</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Terrorist</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 恐怖分子 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, blood=<span class="number">300</span></span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.blood = blood</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">shoot</span>(<span class="params">self, police_object</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 开枪射击某个警察 &quot;&quot;&quot;</span></span><br><span class="line">        police_object.hit_points -= <span class="number">5</span></span><br><span class="line">        police_object.show_status()</span><br><span class="line">        </span><br><span class="line">        self.blood -= <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">strafe</span>(<span class="params">self, police_object_list</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 扫射某些警察 &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> police_object <span class="keyword">in</span> police_object_list:</span><br><span class="line">            police_object.hit_points -= <span class="number">8</span></span><br><span class="line">            police_object.show_status()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show_status</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot; 查看恐怖分子状态 &quot;&quot;&quot;</span></span><br><span class="line">        message = <span class="string">&quot;恐怖分子&#123;&#125;的血量值为:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.name, self.blood)</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">t1 = Terrorist(&#x27;alex&#x27;)</span></span><br><span class="line"><span class="string">t2 = Terrorist(&#x27;李杰&#x27;,200)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="comment"># 1.创建3个警察</span></span><br><span class="line">    p1 = Police(<span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;队员&quot;</span>)</span><br><span class="line">    p2 = Police(<span class="string">&quot;苑昊&quot;</span>, <span class="string">&quot;队员&quot;</span>)</span><br><span class="line">    p3 = Police(<span class="string">&quot;于超&quot;</span>, <span class="string">&quot;队长&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.创建2个匪徒</span></span><br><span class="line">    t1 = Terrorist(<span class="string">&quot;alex&quot;</span>)</span><br><span class="line">    t2 = Terrorist(<span class="string">&quot;eric&quot;</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># alex匪徒射击于超警察</span></span><br><span class="line">    t1.shoot(p3)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># alex扫射</span></span><br><span class="line">    t1.strafe([p1, p2, p3])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># eric射击苑昊</span></span><br><span class="line">    t2.shoot(p2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 武沛齐炸了那群匪徒王八蛋</span></span><br><span class="line">    p1.bomb([t1, t2])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 武沛齐又炸了一次alex</span></span><br><span class="line">    p1.bomb([t1])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure></li>
</ol>
<p>总结：</p>
<ul>
<li>仅做数据封装。</li>
<li>封装数据 + 方法再对数据进行加工处理。</li>
<li>创建同一类的数据且同类数据可以具有相同的功能（方法）。</li>
</ul>
<h2 id="2-三大特性"><a href="#2-三大特性" class="headerlink" title="2. 三大特性"></a>2. 三大特性</h2><p>面向对象编程在很多语言中都存在，这种编程方式有三大特性：封装、继承、多态。</p>
<h3 id="2-1-封装"><a href="#2-1-封装" class="headerlink" title="2.1 封装"></a>2.1 封装</h3><p>封装主要体现在两个方面：</p>
<ul>
<li>将同一类方法封装到了一个类中，例如上述示例中：匪徒的相关方法都写在Terrorist类中；警察的相关方法都写在Police类中。</li>
<li>将数据封装到了对象中，在实例化一个对象时，可以通过<code>__init__</code>初始化方法在对象中封装一些数据，便于以后使用。</li>
</ul>
<h3 id="2-2-继承"><a href="#2-2-继承" class="headerlink" title="2.2 继承"></a>2.2 继承</h3><p>传统的理念中有：儿子可以继承父亲的财产。</p>
<p>在面向对象中也有这样的理念，即：子类可以继承父类中的方法和类变量（不是拷贝一份，父类的还是属于父类，子类可以继承而已）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">父类</span><br><span class="line">子类</span><br><span class="line"></span><br><span class="line">基类</span><br><span class="line">派生类</span><br></pre></td></tr></table></figure>



<p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210126182724313.png" alt="image-20210126182724313"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Base.func&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Son</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Son.show&quot;</span>)</span><br><span class="line">        </span><br><span class="line">s1 = Son()</span><br><span class="line">s1.show()</span><br><span class="line">s1.func() <span class="comment"># 优先在自己的类中找，自己没有才去父类。</span></span><br><span class="line"></span><br><span class="line">s2 = Base()</span><br><span class="line">s2.func()</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bar</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f3</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">o1 = Foo()</span><br><span class="line">o1.f2()</span><br><span class="line">o1.f1()</span><br></pre></td></tr></table></figure>



<h3 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base.f1&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f2&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f1()</span><br><span class="line">obj.f2()</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base.f1&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;before&#x27;</span>)</span><br><span class="line">        self.f1() <span class="comment"># 调用了f1方法   obj.f1()</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f2&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f2()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>before</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base.f1</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo.f2</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base.f1&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;before&quot;</span>)</span><br><span class="line">        self.f1() <span class="comment"># obj,Foo类创建出来的对象。 obj.f1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f2&#x27;</span>)</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f1&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f1() <span class="comment"># obj对象到底是谁？优先就会先去谁里面找。</span></span><br><span class="line">obj.f2()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>before</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo.f1</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo.f2</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;before&#x27;</span>)</span><br><span class="line">        self.f2() <span class="comment"># slef是obj对象（Foo类创建的对象） obj.f2</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base.f1&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base.f2&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f2&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f1() <span class="comment"># 优先去Foo类中找f1，因为调用f1的那个对象是Foo类创建出来的。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>before</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>foo.f2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base.f1</span><br><span class="line"></span><br><span class="line">b1 = Base()</span><br><span class="line">b1.f1()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>before</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base.f2</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>base.f1</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TCPServer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;TCPServer&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadingMixIn</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ThreadingMixIn&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadingTCPServer</span>(ThreadingMixIn, TCPServer): </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;before&#x27;</span>)</span><br><span class="line">        self.f1()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;after&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">obj = ThreadingTCPServer()</span><br><span class="line">obj.run()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>before</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ThreadingMixIn</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>after</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BaseServer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serve_forever</span>(<span class="params">self, poll_interval=<span class="number">0.5</span></span>):</span><br><span class="line">        self._handle_request_noblock()</span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">_handle_request_noblock</span>(<span class="params">self</span>):</span><br><span class="line">        self.process_request(request, client_address)</span><br><span class="line">        </span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, client_address</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TCPServer</span>(<span class="title class_ inherited__">BaseServer</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadingMixIn</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, client_address</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadingTCPServer</span>(ThreadingMixIn, TCPServer): </span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">obj = ThreadingTCPServer()</span><br><span class="line">obj.serve_forever()</span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210126192330261.png" alt="image-20210126192330261"></p>
<p>小结：</p>
<ul>
<li>执行对象.方法时，优先去当前对象所关联的类中找，没有的话才去她的父类中查找。</li>
<li>Python支持多继承：先继承左边、再继承右边的。</li>
<li>self到底是谁？去self对应的那个类中去获取成员，没有就按照继承关系向上查找 。</li>
</ul>
<h3 id="2-3-多态"><a href="#2-3-多态" class="headerlink" title="2.3 多态"></a>2.3 多态</h3><p>多态，按字面翻译其实就是多种形态。</p>
<ul>
<li>其他编程语言多态</li>
<li>Python中多态</li>
</ul>
<p>其他编程语言中，是不允许这样类编写的，例如：Java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;吃鱼&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;吃骨头&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;看家&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       obj1 = Cat()</span><br><span class="line">	   obj2 = Cat()</span><br><span class="line">       show(obj1)</span><br><span class="line">       show(obj2)</span><br><span class="line">           </span><br><span class="line">		obj3 = Dog()</span><br><span class="line">        show(obj3)</span><br><span class="line">   &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(Cat a)</span>  &#123;</span><br><span class="line">      a.eat()</span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Animal</span> &#123;  </span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;吃鱼&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> <span class="keyword">extends</span> <span class="title class_">Animal</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;吃骨头&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">work</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;看家&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       obj1 = Cat()</span><br><span class="line">       show(obj1)</span><br><span class="line">           </span><br><span class="line">	   obj2 = Dog()</span><br><span class="line">	   show(obj2)</span><br><span class="line">   &#125;  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(Animal a)</span>  &#123;</span><br><span class="line">      a.eat()</span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>在java或其他语言中的多态是基于：接口 或 抽象类和抽象方法来实现，让数据可以以多种形态存在。</p>
<p>在Python中则不一样，由于Python对数据类型没有任何限制，所以他天生支持多态。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">arg</span>):</span><br><span class="line">    v1 = arg.copy() <span class="comment"># 浅拷贝</span></span><br><span class="line">    <span class="built_in">print</span>(v1)</span><br><span class="line">    </span><br><span class="line">func(<span class="string">&quot;武沛齐&quot;</span>)</span><br><span class="line">func([<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Email</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发邮件&quot;</span>)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;发短信&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">arg</span>):</span><br><span class="line">    v1 = arg.send()</span><br><span class="line">    <span class="built_in">print</span>(v1)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">v1 = Email()</span><br><span class="line">func(v1)</span><br><span class="line"></span><br><span class="line">v2 = Message()</span><br><span class="line">func(v2)</span><br></pre></td></tr></table></figure>

<p>在程序设计中，鸭子类型（duck typing）是动态类型的一种风格。在鸭子类型中，关注点在于对象的行为，能作什么；而不是关注对象所属的类型，例如：一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟可以被称为鸭子。</p>
<p>小结：</p>
<ul>
<li><p>封装，将方法封装到类中 或 将数据封装到对象中，便于以后使用。</p>
</li>
<li><p>继承，将类中的公共的方法提取到基类中去实现。</p>
</li>
<li><p>多态，Python默认支持多态（这种方式称之为鸭子类型），最简单的基础下面的这段代码即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">arg</span>):</span><br><span class="line">    v1 = arg.copy() <span class="comment"># 浅拷贝</span></span><br><span class="line">    <span class="built_in">print</span>(v1)</span><br><span class="line">    </span><br><span class="line">func(<span class="string">&quot;武沛齐&quot;</span>)</span><br><span class="line">func([<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>])</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-扩展：再看数据类型"><a href="#3-扩展：再看数据类型" class="headerlink" title="3. 扩展：再看数据类型"></a>3. 扩展：再看数据类型</h2><p>在初步了解面向对象之后，再来看看我们之前学习的：str、list、dict等数据类型，他们其实都一个类，根据类可以创建不同类的对象。</p>
<p><img src="/2024/09/07/python_course-master/day17%20%E5%88%9D%E8%AF%86%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/%E7%AC%94%E8%AE%B0/day17/image-20210118203012874.png" alt="image-20210118203012874"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实例化一个str类的对象v1</span></span><br><span class="line">v1 = <span class="built_in">str</span>(<span class="string">&quot;武沛齐&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过对象执行str类中的upper方法。</span></span><br><span class="line">data = v1.upper()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>





<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>类和对象的关系。</p>
</li>
<li><p>面向对象编程中常见的成员：</p>
<ul>
<li>绑定方法</li>
<li>实例变量</li>
</ul>
</li>
<li><p>self到底是什么？</p>
</li>
<li><p>面向对象的三大特性。</p>
</li>
<li><p>面向对象的应用场景</p>
<ol>
<li>数据封装。</li>
<li>封装数据 + 方法再对数据进行加工处理。</li>
<li>创建同一类的数据且同类数据可以具有相同的功能（方法）。</li>
</ol>
</li>
<li><p>补充：在Python3中编写类时，默认都会继承object（即使不写也会自动继承）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>这一点在Python2是不同的：</p>
<ul>
<li>继承object，新式类</li>
<li>不继承object，经典类</li>
</ul>
</li>
</ol>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><ol>
<li><p>简述面向对象三大特性?</p>
</li>
<li><p>将以下函数改成类的方式并调用 :  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">a1</span>):   </span><br><span class="line">    <span class="built_in">print</span>(a1) </span><br></pre></td></tr></table></figure>
</li>
<li><p>面向对象中的self指的是什么?</p>
</li>
<li><p>以下代码体现 向对象的什么特性?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age, gender</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Person(<span class="string">&#x27;武沛齐&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;男&#x27;</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以下代码体现 向对象的 么特点?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Message</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">email</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        发送邮件</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">msg</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        发送短信</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wechat</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        发送微信</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.func&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">obj = Foo()</span><br><span class="line">result = obj.func()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base1</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base1.f1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base1.f2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f3</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base1.f3&#x27;</span>)</span><br><span class="line">        self.f1()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base2</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base2.f1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(Base1, Base2):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f0</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f0&#x27;</span>)</span><br><span class="line">        self.f3()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f0()</span><br></pre></td></tr></table></figure>
</li>
<li><p>看代码写结果:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base.f1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f3</span>(<span class="params">self</span>):</span><br><span class="line">        self.f1()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;base.f3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f1</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f2</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;foo.f2&#x27;</span>)</span><br><span class="line">        self.f3()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = Foo()</span><br><span class="line">obj.f2()</span><br></pre></td></tr></table></figure>
</li>
<li><p>补充代码实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user_list = []</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    user = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名:&quot;</span>)</span><br><span class="line">    pwd = <span class="built_in">input</span>(<span class="string">&quot;请输入密码:&quot;</span>)</span><br><span class="line">    email = <span class="built_in">input</span>(<span class="string">&quot;请输入邮箱:&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># 需求</span></span><br><span class="line"><span class="string">1. while循环提示 户输 : 户名、密码、邮箱(正则满足邮箱格式)</span></span><br><span class="line"><span class="string">2. 为每个用户创建一个个对象，并添加到user_list中。</span></span><br><span class="line"><span class="string">3. 当列表中的添加 3个对象后，跳出循环并以此循环打印所有用户的姓名和邮箱</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>补充代码:实现 户注册和登录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, pwd</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.pwd = pwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 用户列表，数据格式：[user对象，user对象，user对象]</span></span><br><span class="line">        self.user_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        用户登录，输入用户名和密码然后去self.user_list中校验用户合法性</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        用户注册，没注册一个用户就创建一个user对象，然后添加到self.user_list中，表示注册成功。</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        主程序</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    obj = Account()</span><br><span class="line">    obj.run()</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day16%20%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E5%92%8C%E8%80%83%E8%AF%95/%E7%AC%94%E8%AE%B0/day16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day16%20%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E5%92%8C%E8%80%83%E8%AF%95/%E7%AC%94%E8%AE%B0/day16/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:30" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:30+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:29" itemprop="dateModified" datetime="2024-08-28T18:21:29+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day16-阶段总结"><a href="#day16-阶段总结" class="headerlink" title="day16 阶段总结"></a>day16 阶段总结</h1><p>课程目标：对第二模块  “函数和模块” 阶段的知识点进行总结和考试，让学员更好的掌握此模块的相关知识。</p>
<p>课程概要：</p>
<ul>
<li>知识补充</li>
<li>阶段总结（思维导图）</li>
<li>考试题</li>
</ul>
<h2 id="1-知识补充"><a href="#1-知识补充" class="headerlink" title="1.知识补充"></a>1.知识补充</h2><h3 id="1-1-nolocal关键字"><a href="#1-1-nolocal关键字" class="headerlink" title="1.1 nolocal关键字"></a>1.1 nolocal关键字</h3><p>在之前的课程中，我们学过global关键字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;root&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    name = <span class="string">&quot;武沛齐&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">global</span> name</span><br><span class="line">        name = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">    inner()</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="built_in">print</span>(name)</span><br></pre></td></tr></table></figure>



<p>其实，还有一个nolocal关键字，用的比较少，此处作为了解即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;root&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    name = <span class="string">&quot;武沛齐&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> name</span><br><span class="line">        name = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">    inner()</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="built_in">print</span>(name)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;root&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    name = <span class="string">&#x27;alex&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">        name = <span class="string">&quot;武沛齐&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">            <span class="keyword">nonlocal</span> name</span><br><span class="line">            name = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">        inner()</span><br><span class="line">        <span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line">    func()</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="built_in">print</span>(name)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;root&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outer</span>():</span><br><span class="line">    name = <span class="string">&#x27;alex&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> name</span><br><span class="line">        name = <span class="string">&quot;武沛齐&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">inner</span>():</span><br><span class="line">            <span class="keyword">nonlocal</span> name</span><br><span class="line">            name = <span class="number">123</span></span><br><span class="line"></span><br><span class="line">        inner()</span><br><span class="line">        <span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line">    func()</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outer()</span><br><span class="line"><span class="built_in">print</span>(name)</span><br></pre></td></tr></table></figure>



<h3 id="1-2-yield-from"><a href="#1-2-yield-from" class="headerlink" title="1.2 yield from"></a>1.2 yield from</h3><p>在生成器部分我们了解了yield关键字，其在python3.3之后有引入了一个yield from。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> foo()</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> func():</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>



<h3 id="1-3-深浅拷贝"><a href="#1-3-深浅拷贝" class="headerlink" title="1.3 深浅拷贝"></a>1.3 深浅拷贝</h3><ul>
<li><p>浅拷贝</p>
<ul>
<li><p>不可变类型，不拷贝。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">v1 = <span class="string">&quot;武沛齐&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1)) <span class="comment"># 140652260947312</span></span><br><span class="line"></span><br><span class="line">v2 = copy.copy(v1) </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2)) <span class="comment"># 140652260947312</span></span><br></pre></td></tr></table></figure>

<p>按理说拷贝v1之后，v2的内存地址应该不同，但由于python内部优化机制，内存地址是相同的，因为对不可变类型而言，如果以后修改值，会重新创建一份数据，不会影响原数据，所以，不拷贝也无妨。</p>
</li>
<li><p>可变类型，只拷贝第一层。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">v1 = [<span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;root&quot;</span>, [<span class="number">44</span>, <span class="number">55</span>]]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1))  <span class="comment"># 140405837216896</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>]))  <span class="comment"># 140405837214592</span></span><br><span class="line"></span><br><span class="line">v2 = copy.copy(v1)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2))  <span class="comment"># 140405837214784</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>]))  <span class="comment"># 140405837214592</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day16%20%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E5%92%8C%E8%80%83%E8%AF%95/%E7%AC%94%E8%AE%B0/day16/image-20210106151332792.png" alt="image-20210106151332792"></p>
</li>
</ul>
</li>
<li><p>深拷贝</p>
<ul>
<li><p>不可变类型，不拷贝</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">v1 = <span class="string">&quot;武沛齐&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1))  <span class="comment"># 140188538697072</span></span><br><span class="line"></span><br><span class="line">v2 = copy.deepcopy(v1)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2))  <span class="comment"># 140188538697072</span></span><br></pre></td></tr></table></figure>

<p>特殊的元组：</p>
<ul>
<li><p>元组元素中无可变类型，不拷贝</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">v1 = (<span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1))  <span class="comment"># 140243298961984</span></span><br><span class="line"></span><br><span class="line">v2 = copy.deepcopy(v1)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2))  <span class="comment"># 140243298961984</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>元素元素中有可变类型，找到所有【可变类型】或【含有可变类型的元组】   均拷贝一份</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">v1 = (<span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;root&quot;</span>, [<span class="number">11</span>, [<span class="number">44</span>, <span class="number">55</span>], (<span class="number">11</span>, <span class="number">22</span>), (<span class="number">11</span>, [], <span class="number">22</span>), <span class="number">33</span>])</span><br><span class="line">v2 = copy.deepcopy(v1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1))  <span class="comment"># 140391475456384</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2))  <span class="comment"># 140391475456640</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>]))  <span class="comment"># 140352552779008</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>]))  <span class="comment"># 140352552920448</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>][<span class="number">1</span>]))  <span class="comment"># 140642999940480</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>][<span class="number">1</span>]))  <span class="comment"># 140643000088832</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>][<span class="number">2</span>]))  <span class="comment"># 140467039914560</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>][<span class="number">2</span>]))  <span class="comment"># 140467039914560</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>][<span class="number">3</span>]))  <span class="comment"># 140675479841152</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>][<span class="number">3</span>]))  <span class="comment"># 140675480454784</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>可变类型，找到所有层级的 【可变类型】或【含有可变类型的元组】   均拷贝一份</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">v1 = [<span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;root&quot;</span>, [<span class="number">11</span>, [<span class="number">44</span>, <span class="number">55</span>], (<span class="number">11</span>, <span class="number">22</span>), (<span class="number">11</span>, [], <span class="number">22</span>), <span class="number">33</span>]]</span><br><span class="line">v2 = copy.deepcopy(v1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1))  <span class="comment"># 140391475456384</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2))  <span class="comment"># 140391475456640</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>]))  <span class="comment"># 140352552779008</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>]))  <span class="comment"># 140352552920448</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>][<span class="number">1</span>]))  <span class="comment"># 140642999940480</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>][<span class="number">1</span>]))  <span class="comment"># 140643000088832</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>][<span class="number">2</span>]))  <span class="comment"># 140467039914560</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>][<span class="number">2</span>]))  <span class="comment"># 140467039914560</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>][<span class="number">3</span>]))  <span class="comment"># 140675479841152</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>][<span class="number">3</span>]))  <span class="comment"># 140675480454784</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">v1 = [<span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;root&quot;</span>, [<span class="number">44</span>, <span class="number">55</span>]]</span><br><span class="line">v2 = copy.deepcopy(v1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1))  <span class="comment"># 140405837216896</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2))  <span class="comment"># 140405837214784</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v1[<span class="number">2</span>]))  <span class="comment"># 140563140392256</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(v2[<span class="number">2</span>]))  <span class="comment"># 140563140535744</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/09/07/python_course-master/day16%20%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E5%92%8C%E8%80%83%E8%AF%95/%E7%AC%94%E8%AE%B0/day16/image-20210106152704591.png" alt="image-20210106152704591"></p>
</li>
</ul>
</li>
</ul>
<h2 id="2-阶段总结"><a href="#2-阶段总结" class="headerlink" title="2.阶段总结"></a>2.阶段总结</h2><p><img src="/2024/09/07/python_course-master/day16%20%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E5%92%8C%E8%80%83%E8%AF%95/%E7%AC%94%E8%AE%B0/day16/image-20210106143928141.png" alt="image-20210106143928141"></p>
<h2 id="3-考试题"><a href="#3-考试题" class="headerlink" title="3.考试题"></a>3.考试题</h2><p>考试题的目的是让大家对自己近期知识点学习练习 以及 自测，请大家务必【独立】完成（切勿翻看笔记 &amp; 切勿网上搜索 ）。</p>
<ul>
<li><p>第一步：自己独立完成（编程题目可以在pycharm中编写）</p>
</li>
<li><p>第二步：做完之后，翻看自己笔记去修改和更正。</p>
</li>
<li><p>第三步：觉自己做的没问题了，最后再去看考试题的参考答案和讲解。</p>
</li>
</ul>
<p>详情见附件《第二阶段考试题.md》文件。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
      <meta itemprop="name" content="陈永辉">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="大帅哥">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-07 21:27:30" itemprop="dateCreated datePublished" datetime="2024-09-07T21:27:30+08:00">2024-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-28 18:21:29" itemprop="dateModified" datetime="2024-08-28T18:21:29+08:00">2024-08-28</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="day15-内置模块和开发规范"><a href="#day15-内置模块和开发规范" class="headerlink" title="day15 内置模块和开发规范"></a>day15 内置模块和开发规范</h1><p><img src="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/image-20210104122555935.png" alt="image-20210104122555935"></p>
<p>目标：掌握常见的内置模块的使用及了解软件开发的规范。</p>
<p>今日概要：</p>
<ul>
<li>内置模块<ul>
<li>json</li>
<li>time</li>
<li>datetime</li>
<li>re</li>
</ul>
</li>
<li>开发规范<ul>
<li>主文件</li>
<li>配置文件</li>
<li>数据</li>
<li>附件</li>
<li>业务代码</li>
</ul>
</li>
</ul>
<h2 id="1-内置模块"><a href="#1-内置模块" class="headerlink" title="1. 内置模块"></a>1. 内置模块</h2><h3 id="1-1-json"><a href="#1-1-json" class="headerlink" title="1.1 json"></a>1.1 json</h3><p>json模块，是python内部的一个模块，可以将python的数据格式 转换为json格式的数据，也可以将json格式的数据转换为python的数据格式。</p>
<p>json格式，是一个数据格式（本质上就是个字符串，常用语网络数据传输）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python中的数据类型的格式</span></span><br><span class="line">data = [</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;alex&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">    (<span class="string">&#x27;wupeiqi&#x27;</span>,<span class="number">123</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># JSON格式</span></span><br><span class="line">value = <span class="string">&#x27;[&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;武沛齐&quot;, &quot;age&quot;: 18&#125;, &#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;alex&quot;, &quot;age&quot;: 18&#125;,[&quot;wupeiqi&quot;,123]]&#x27;</span></span><br></pre></td></tr></table></figure>



<h4 id="1-1-1-核心功能"><a href="#1-1-1-核心功能" class="headerlink" title="1.1.1 核心功能"></a>1.1.1 核心功能</h4><p>json格式的作用？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">跨语言数据传输，例如：</span><br><span class="line">	A系统用Python开发，有列表类型和字典类型等。</span><br><span class="line">	B系统用Java开发，有数组、map等的类型。</span><br><span class="line"></span><br><span class="line">	语言不同，基础数据类型格式都不同。</span><br><span class="line">	</span><br><span class="line">	为了方便数据传输，大家约定一个格式：json格式，每种语言都是将自己数据类型转换为json格式，也可以将json格式的数据转换为自己的数据类型。</span><br></pre></td></tr></table></figure>



<p><img src="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/image-20210104123415566.png" alt="image-20210104123415566"></p>
<p>Python数据类型与json格式的相互转换：</p>
<ul>
<li><p>数据类型 -&gt; json ，一般称为：序列化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = [</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;alex&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">res = json.dumps(data)</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># &#x27;[&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;\u6b66\u6c9b\u9f50&quot;, &quot;age&quot;: 18&#125;, &#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;alex&quot;, &quot;age&quot;: 18&#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line">res = json.dumps(data, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># &#x27;[&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;武沛齐&quot;, &quot;age&quot;: 18&#125;, &#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;alex&quot;, &quot;age&quot;: 18&#125;]&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>json格式 -&gt; 数据类型，一般称为：反序列化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data_string = <span class="string">&#x27;[&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;武沛齐&quot;, &quot;age&quot;: 18&#125;, &#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;alex&quot;, &quot;age&quot;: 18&#125;]&#x27;</span></span><br><span class="line"></span><br><span class="line">data_list = json.loads(data_string)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data_list)</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h4><ol>
<li><p>写网站，给用户返回json格式数据</p>
<ul>
<li><p>安装flask模块，协助我们快速写网站（之前已安装过）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用flask写网站</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;首页&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">users</span>():</span><br><span class="line">    data = [</span><br><span class="line">        &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;alex&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> json.dumps(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.add_url_rule(<span class="string">&#x27;/index/&#x27;</span>, view_func=index, endpoint=<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">app.add_url_rule(<span class="string">&#x27;/users/&#x27;</span>, view_func=users, endpoint=<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>发送网络请求，获取json格式数据并处理。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://movie.douban.com/j/search_subjects?type=movie&amp;tag=%E7%83%AD%E9%97%A8&amp;sort=recommend&amp;page_limit=5&amp;page_start=20&quot;</span></span><br><span class="line"></span><br><span class="line">res = requests.get(</span><br><span class="line">    url=url,</span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json格式</span></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json格式转换为python数据类型</span></span><br><span class="line">data_dict = json.loads(res.text)</span><br><span class="line"><span class="built_in">print</span>(data_dict)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="1-1-2-类型要求"><a href="#1-1-2-类型要求" class="headerlink" title="1.1.2 类型要求"></a>1.1.2 类型要求</h4><p>python的数据类型转换为 json 格式，对数据类型是有要求的，默认只支持：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+-------------------+---------------+</span><br><span class="line">| Python            | JSON          |</span><br><span class="line">+===================+===============+</span><br><span class="line">| dict              | object        |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| list, tuple       | array         |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| str               | string        |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| int, float        | number        |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| True              | true          |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| False             | false         |</span><br><span class="line">+-------------------+---------------+</span><br><span class="line">| None              | null          |</span><br><span class="line">+-------------------+---------------+</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data = [</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;alex&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>其他类型如果想要支持，需要自定义<code>JSONEncoder </code>才能实现【目前只需要了解大概意思即可，以后项目开发中用到了还会讲解。】，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">data = [</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>, <span class="string">&#x27;size&#x27;</span>: Decimal(<span class="string">&quot;18.99&quot;</span>), <span class="string">&#x27;ctime&#x27;</span>: datetime.now()&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;alex&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>, <span class="string">&#x27;size&#x27;</span>: Decimal(<span class="string">&quot;9.99&quot;</span>), <span class="string">&#x27;ctime&#x27;</span>: datetime.now()&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyJSONEncoder</span>(json.JSONEncoder):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">default</span>(<span class="params">self, o</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(o) == Decimal:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(o)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">type</span>(o) == datetime:</span><br><span class="line">            <span class="keyword">return</span> o.strftime(<span class="string">&quot;%Y-%M-%d&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().default(o)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = json.dumps(data, cls=MyJSONEncoder)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>



<h4 id="1-1-3-其他功能"><a href="#1-1-3-其他功能" class="headerlink" title="1.1.3 其他功能"></a>1.1.3 其他功能</h4><p>json模块中常用的是：</p>
<ul>
<li><p><code>json.dumps</code>，序列化生成一个字符串。</p>
</li>
<li><p><code>json.loads</code>，发序列化生成python数据类型。</p>
</li>
<li><p><code>json.dump</code>，将数据序列化并写入文件（不常用）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = [</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">1</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;武沛齐&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;id&quot;</span>: <span class="number">2</span>, <span class="string">&quot;name&quot;</span>: <span class="string">&quot;alex&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">file_object = <span class="built_in">open</span>(<span class="string">&#x27;xxx.json&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">json.dump(data, file_object)</span><br><span class="line"></span><br><span class="line">file_object.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>json.load</code>，读取文件中的数据并反序列化为python的数据类型（不常用）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">file_object = <span class="built_in">open</span>(<span class="string">&#x27;xxx.json&#x27;</span>, mode=<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data = json.load(file_object)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">file_object.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-2-时间处理"><a href="#1-2-时间处理" class="headerlink" title="1.2 时间处理"></a>1.2 时间处理</h3><ul>
<li><p>UTC&#x2F;GMT：世界时间</p>
</li>
<li><p>本地时间：本地时区的时间。</p>
</li>
</ul>
<p>Python中关于时间处理的模块有两个，分别是time和datetime。</p>
<h4 id="1-2-1-time"><a href="#1-2-1-time" class="headerlink" title="1.2.1 time"></a>1.2.1 time</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前时间戳（自1970-1-1 00:00）</span></span><br><span class="line">v1 = time.time()</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时区</span></span><br><span class="line">v2 = time.timezone</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止n秒，再执行后续的代码。</span></span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>



<h4 id="1-2-2-datetime"><a href="#1-2-2-datetime" class="headerlink" title="1.2.2 datetime"></a>1.2.2 datetime</h4><p>在平时开发过程中的时间一般是以为如下三种格式存在：</p>
<ul>
<li><p>datetime</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timezone, timedelta</span><br><span class="line"></span><br><span class="line">v1 = datetime.now()  <span class="comment"># 当前本地时间</span></span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line">tz = timezone(timedelta(hours=<span class="number">7</span>))  <span class="comment"># 当前东7区时间</span></span><br><span class="line">v2 = datetime.now(tz)</span><br><span class="line"><span class="built_in">print</span>(v2)</span><br><span class="line"></span><br><span class="line">v3 = datetime.utcnow()  <span class="comment"># 当前UTC时间</span></span><br><span class="line"><span class="built_in">print</span>(v3)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta</span><br><span class="line"></span><br><span class="line">v1 = datetime.now()</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间的加减</span></span><br><span class="line">v2 = v1 + timedelta(days=<span class="number">140</span>, minutes=<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(v2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># datetime类型 + timedelta类型</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timezone, timedelta</span><br><span class="line"></span><br><span class="line">v1 = datetime.now()</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line">v2 = datetime.utcnow()  <span class="comment"># 当前UTC时间</span></span><br><span class="line"><span class="built_in">print</span>(v2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># datetime之间相减，计算间隔时间（不能相加）</span></span><br><span class="line">data = v1 - v2</span><br><span class="line"><span class="built_in">print</span>(data.days, data.seconds / <span class="number">60</span> / <span class="number">60</span>, data.microseconds)</span><br><span class="line"></span><br><span class="line"><span class="comment"># datetime类型 - datetime类型</span></span><br><span class="line"><span class="comment"># datetime类型 比较 datetime类型</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字符串格式的时间  ---&gt; 转换为datetime格式时间</span></span><br><span class="line">text = <span class="string">&quot;2021-11-11&quot;</span></span><br><span class="line">v1 = datetime.strptime(text,<span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="comment"># %Y 年，%m，月份，%d，天。</span></span><br><span class="line"><span class="built_in">print</span>(v1)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># datetime格式 ----&gt; 转换为字符串格式</span></span><br><span class="line">v1 = datetime.now()</span><br><span class="line">val = v1.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(val)</span><br></pre></td></tr></table></figure>
</li>
<li><p>时间戳</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 时间戳格式 --&gt; 转换为datetime格式</span></span><br><span class="line">ctime = time.time() <span class="comment"># 11213245345.123</span></span><br><span class="line">v1 = datetime.fromtimestamp(ctime)</span><br><span class="line"><span class="built_in">print</span>(v1)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># datetime格式 ---&gt; 转换为时间戳格式</span></span><br><span class="line">v1 = datetime.now()</span><br><span class="line">val = v1.timestamp()</span><br><span class="line"><span class="built_in">print</span>(val)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/image-20210104171741529.png" alt="image-20210104171741529"></p>
<h4 id="练习题-1"><a href="#练习题-1" class="headerlink" title="练习题"></a>练习题</h4><ol>
<li><p>日志记录，将用户输入的信息写入到文件，文件名格式为<code>年-月-日-时-分.txt</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    text = <span class="built_in">input</span>(<span class="string">&quot;请输入内容：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> text.upper() == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    current_datetime = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d-%H-%M&quot;</span>)</span><br><span class="line">    file_name = <span class="string">&quot;&#123;&#125;.txt&quot;</span>.<span class="built_in">format</span>(current_datetime)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">        file_object.write(text)</span><br><span class="line">        file_object.flush()</span><br></pre></td></tr></table></figure>
</li>
<li><p>用户注册，将用户信息写入Excel，其中包含：用户名、密码、注册时间 三列。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook</span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> workbook</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">FILE_NAME = <span class="string">&quot;db.xlsx&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">origin</span>):</span><br><span class="line">    hash_object = hashlib.md5(<span class="string">&quot;sdfsdfsdfsd23sd&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    hash_object.update(origin.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> hash_object.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">username, password</span>):</span><br><span class="line">    db_file_path = os.path.join(BASE_DIR, FILE_NAME)</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(db_file_path):</span><br><span class="line">        wb = load_workbook(db_file_path)</span><br><span class="line">        sheet = wb.worksheets[<span class="number">0</span>]</span><br><span class="line">        next_row_position = sheet.max_row + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        wb = workbook.Workbook()</span><br><span class="line">        sheet = wb.worksheets[<span class="number">0</span>]</span><br><span class="line">        next_row_position = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    user = sheet.cell(next_row_position, <span class="number">1</span>)</span><br><span class="line">    user.value = username</span><br><span class="line"></span><br><span class="line">    pwd = sheet.cell(next_row_position, <span class="number">2</span>)</span><br><span class="line">    pwd.value = md5(password)</span><br><span class="line"></span><br><span class="line">    ctime = sheet.cell(next_row_position, <span class="number">3</span>)</span><br><span class="line">    ctime.value = datetime.now().strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line"></span><br><span class="line">    wb.save(db_file_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        username = <span class="built_in">input</span>(<span class="string">&quot;请输入用户名：&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> username.upper() == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        password = <span class="built_in">input</span>(<span class="string">&quot;请输入密码：&quot;</span>)</span><br><span class="line">        register(username, password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="1-3-正则表达式相关"><a href="#1-3-正则表达式相关" class="headerlink" title="1.3 正则表达式相关"></a>1.3 正则表达式相关</h3><p>当给你一大堆文本信息，让你提取其中的指定数据时，可以使用正则来实现。例如：提取文本中的邮箱和手机号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line"></span><br><span class="line">phone_list = re.findall(<span class="string">&quot;1[3|5|8|9]\d&#123;9&#125;&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(phone_list)</span><br></pre></td></tr></table></figure>



<h4 id="1-3-1-正则表达式"><a href="#1-3-1-正则表达式" class="headerlink" title="1.3.1 正则表达式"></a>1.3.1 正则表达式</h4><h5 id="1-字符相关"><a href="#1-字符相关" class="headerlink" title="1. 字符相关"></a>1. 字符相关</h5><ul>
<li><p><code>wupeiqi</code> 匹配文本中的wupeiqi</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;你好wupeiqi,阿斯顿发wupeiqasd 阿士大夫能接受的wupeiqiff&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;wupeiqi&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;wupeiqi&#x27;, &#x27;wupeiqi&#x27;] 可用于计算字符串中某个字符出现的次数</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>[abc]</code> 匹配a或b或c 字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;你2b好wupeiqi,阿斯顿发awupeiqasd 阿士大夫a能接受的wffbbupqaceiqiff&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;[abc]&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;b&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;你2b好wupeiqi,阿斯顿发awupeiqasd 阿士大夫a能接受的wffbbupqcceiqiff&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;q[abc]&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;qa&#x27;, &#x27;qc&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>[^abc]</code> 匹配除了abc意外的其他字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;你wffbbupceiqiff&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;[^abc]&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [&#x27;你&#x27;, &#x27;w&#x27;, &#x27;f&#x27;, &#x27;f&#x27;, &#x27;u&#x27;, &#x27;p&#x27;, &#x27;e&#x27;, &#x27;i&#x27;, &#x27;q&#x27;, &#x27;i&#x27;, &#x27;f&#x27;, &#x27;f&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>[a-z]</code>  匹配a~z的任意字符（ [0-9]也可以 ）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;alexrootrootadmin&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;t[a-z]&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [&#x27;tr&#x27;, &#x27;ta&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>.</code>  代指除换行符以外的任意字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;alexraotrootadmin&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;r.o&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;rao&#x27;, &#x27;roo&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;alexraotrootadmin&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;r.+o&quot;</span>, text) <span class="comment"># 贪婪匹配</span></span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;raotroo&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;alexraotrootadmin&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;r.+?o&quot;</span>, text) <span class="comment"># 非贪婪匹配</span></span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;rao&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>\w</code> 代指字母或数字或下划线（汉字）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;北京武沛alex齐北  京武沛alex齐&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;武\w+x&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;武沛alex&#x27;, &#x27;武沛alex&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>\d</code> 代指数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;root-ad32min-add3-admd1in&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;d\d&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;d3&#x27;, &#x27;d3&#x27;, &#x27;d1&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;root-ad32min-add3-admd1in&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;d\d+&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;d32&#x27;, &#x27;d3&#x27;, &#x27;d1&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>\s</code> 代指任意的空白符，包括空格、制表符等。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;root admin add admin&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;a\w+\s\w+&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;admin add&#x27;]</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2-数量相关"><a href="#2-数量相关" class="headerlink" title="2. 数量相关"></a>2. 数量相关</h5><ul>
<li><p><code>*</code> 重复0次或更多次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;他是大B个，确实是个大2B。&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;大2*B&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;大B&#x27;, &#x27;大2B&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>+</code> 重复1次或更多次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;他是大B个，确实是个大2B，大3B，大66666B。&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;大\d+B&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;大2B&#x27;, &#x27;大3B&#x27;, &#x27;大66666B&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>?</code> 重复0次或1次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;他是大B个，确实是个大2B，大3B，大66666B。&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;大\d?B&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;大B&#x27;, &#x27;大2B&#x27;, &#x27;大3B&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>&#123;n&#125;</code> 重复n次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;151312\d&#123;5&#125;&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;15131255789&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>&#123;n,&#125;</code> 重复n次或更多次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;\d&#123;9,&#125;&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;442662578&#x27;, &#x27;15131255789&#x27;]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>&#123;n,m&#125;</code> 重复n到m次</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;\d&#123;10,15&#125;&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;15131255789&#x27;]</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3-括号（分组）"><a href="#3-括号（分组）" class="headerlink" title="3. 括号（分组）"></a>3. 括号（分组）</h5><ul>
<li><p>提取数据区域</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;15131(2\d&#123;5&#125;)&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [&#x27;255789&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来15131266666呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;15(13)1(2\d&#123;5&#125;)&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [ (&#x27;13&#x27;, &#x27;255789&#x27;)   ]</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;(15131(2\d&#123;5&#125;))&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [(&#x27;15131255789&#x27;, &#x27;255789&#x27;)]</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>获取指定区域 + 或条件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主15131root太牛15131alex逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;15131(2\d&#123;5&#125;|r\w+太)&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [&#x27;root太&#x27;, &#x27;255789&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主15131root太牛15131alex逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;(15131(2\d&#123;5&#125;|r\w+太))&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [(&#x27;15131root太&#x27;, &#x27;root太&#x27;), (&#x27;15131255789&#x27;, &#x27;255789&#x27;)]</span></span><br></pre></td></tr></table></figure>





<h5 id="练习题-2"><a href="#练习题-2" class="headerlink" title="练习题"></a>练习题</h5></li>
</ul>
<ol>
<li><p>利用正则匹配QQ号码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1-9]\d&#123;4,&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>身份证号码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;dsf130429191912015219k13042919591219521Xkk&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;\d&#123;17&#125;[\dX]&quot;</span>, text) <span class="comment"># [abc]</span></span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;130429191912015219&#x27;, &#x27;13042919591219521X&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;dsf130429191912015219k13042919591219521Xkk&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;\d&#123;17&#125;(\d|X)&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [&#x27;9&#x27;, &#x27;X&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;dsf130429191912015219k13042919591219521Xkk&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;(\d&#123;17&#125;(\d|X))&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [(&#x27;130429191912015219&#x27;, &#x27;9&#x27;), (&#x27;13042919591219521X&#x27;, &#x27;X&#x27;)]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;dsf130429191912015219k13042919591219521Xkk&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;(\d&#123;6&#125;)(\d&#123;4&#125;)(\d&#123;2&#125;)(\d&#123;2&#125;)(\d&#123;3&#125;)([0-9]|X)&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [(&#x27;130429&#x27;, &#x27;1919&#x27;, &#x27;12&#x27;, &#x27;01&#x27;, &#x27;521&#x27;, &#x27;9&#x27;), (&#x27;130429&#x27;, &#x27;1959&#x27;, &#x27;12&#x27;, &#x27;19&#x27;, &#x27;521&#x27;, &#x27;X&#x27;)]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>手机号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;我的手机哈是15133377892，你的手机号是1171123啊？&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;1[3-9]\d&#123;9&#125;&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list)  <span class="comment"># [&#x27;15133377892&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>邮箱地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">email_list = re.findall(<span class="string">&quot;\w+@\w+\.\w+&quot;</span>,text)</span><br><span class="line"><span class="built_in">print</span>(email_list) <span class="comment"># [&#x27;442662578@qq.com和xxxxx&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">email_list = re.findall(<span class="string">&quot;[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+&quot;</span>, text, re.ASCII)</span><br><span class="line"><span class="built_in">print</span>(email_list) <span class="comment"># [&#x27;442662578@qq.com&#x27;, &#x27;xxxxx@live.com&#x27;]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">email_list = re.findall(<span class="string">&quot;\w+@\w+\.\w+&quot;</span>, text, re.ASCII)</span><br><span class="line"><span class="built_in">print</span>(email_list) <span class="comment"># [&#x27;442662578@qq.com&#x27;, &#x27;xxxxx@live.com&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;楼主太牛44266-2578@qq.com逼了，在线想要 442662578@qq.com和xxxxx@live.com谢谢楼主，手机号也可15131255789，搞起来呀&quot;</span></span><br><span class="line">email_list = re.findall(<span class="string">&quot;(\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)&quot;</span>, text, re.ASCII)</span><br><span class="line"><span class="built_in">print</span>(email_list) <span class="comment"># [(&#x27;44266-2578@qq.com&#x27;, &#x27;-2578&#x27;, &#x27;&#x27;, &#x27;&#x27;), (&#x27;xxxxx@live.com&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;)]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>补充代码，实现获取页面上的所有评论（已实现），并提取里面的邮箱。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先安装两个模块</span></span><br><span class="line">pip3 install requests</span><br><span class="line">pip3 install beautifulsoup4</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">res = requests.get(</span><br><span class="line">    url=<span class="string">&quot;https://www.douban.com/group/topic/79870081/&quot;</span>,</span><br><span class="line">    headers=&#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">bs_object = BeautifulSoup(res.text, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">comment_object_list = bs_object.find_all(<span class="string">&quot;p&quot;</span>, attrs=&#123;<span class="string">&quot;class&quot;</span>: <span class="string">&quot;reply-content&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> comment_object <span class="keyword">in</span> comment_object_list:</span><br><span class="line">    text = comment_object.text</span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line">    <span class="comment"># 请继续补充代码，提取text中的邮箱地址</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="4-起始和结束"><a href="#4-起始和结束" class="headerlink" title="4. 起始和结束"></a>4. 起始和结束</h5><p>上述示例中都是去一段文本中提取数据，只要文本中存在即可。</p>
<p>但，如果要求用户输入的内容必须是指定的内容开头和结尾，比就需要用到如下两个字符。</p>
<ul>
<li><code>^</code> 开始</li>
<li><code>$</code> 结束</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;啊442662578@qq.com我靠&quot;</span></span><br><span class="line">email_list = re.findall(<span class="string">&quot;^\w+@\w+.\w+$&quot;</span>, text, re.ASCII)</span><br><span class="line"><span class="built_in">print</span>(email_list) <span class="comment"># []</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;442662578@qq.com&quot;</span></span><br><span class="line">email_list = re.findall(<span class="string">&quot;^\w+@\w+.\w+$&quot;</span>, text, re.ASCII)</span><br><span class="line"><span class="built_in">print</span>(email_list) <span class="comment"># [&#x27;442662578@qq.com&#x27;]</span></span><br></pre></td></tr></table></figure>



<p>这种一般用于对用户输入数据格式的校验比较多，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="built_in">input</span>(<span class="string">&quot;请输入邮箱：&quot;</span>)</span><br><span class="line">email = re.findall(<span class="string">&quot;^\w+@\w+.\w+$&quot;</span>, text, re.ASCII)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> email:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;邮箱格式错误&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(email)</span><br></pre></td></tr></table></figure>



<h5 id="5-特殊字符"><a href="#5-特殊字符" class="headerlink" title="5. 特殊字符"></a>5. 特殊字符</h5><p>由于正则表达式中 <code>*  .  \ &#123; &#125; ( ) </code> 等都具有特殊的含义，所以如果想要在正则中匹配这种指定的字符，需要转义，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;我是你&#123;5&#125;爸爸&quot;</span></span><br><span class="line">data = re.findall(<span class="string">&quot;你&#123;5&#125;爸&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data) <span class="comment"># []</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;我是你&#123;5&#125;爸爸&quot;</span></span><br><span class="line">data = re.findall(<span class="string">&quot;你\&#123;5\&#125;爸&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>



<h4 id="1-3-2-re模块"><a href="#1-3-2-re模块" class="headerlink" title="1.3.2 re模块"></a>1.3.2 re模块</h4><p>python中提供了re模块，可以处理正则表达式并对文本进行处理。</p>
<ul>
<li><p>findall，获取匹配到的所有数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;dsf130429191912015219k13042919591219521Xkk&quot;</span></span><br><span class="line">data_list = re.findall(<span class="string">&quot;(\d&#123;6&#125;)(\d&#123;4&#125;)(\d&#123;2&#125;)(\d&#123;2&#125;)(\d&#123;3&#125;)([0-9]|X)&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data_list) <span class="comment"># [(&#x27;130429&#x27;, &#x27;1919&#x27;, &#x27;12&#x27;, &#x27;01&#x27;, &#x27;521&#x27;, &#x27;9&#x27;), (&#x27;130429&#x27;, &#x27;1959&#x27;, &#x27;12&#x27;, &#x27;19&#x27;, &#x27;521&#x27;, &#x27;X&#x27;)]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>match，从起始位置开始匹配，匹配成功返回一个对象，未匹配成功返回None</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;大小逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.<span class="keyword">match</span>(<span class="string">&quot;逗\dB&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data) <span class="comment"># None</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.<span class="keyword">match</span>(<span class="string">&quot;逗\dB&quot;</span>, text)</span><br><span class="line"><span class="keyword">if</span> data:</span><br><span class="line">    content = data.group() <span class="comment"># &quot;逗2B&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(content)</span><br></pre></td></tr></table></figure>
</li>
<li><p>search，浏览整个字符串去匹配第一个，未匹配成功返回None</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;大小逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.search(<span class="string">&quot;逗\dB&quot;</span>, text)</span><br><span class="line"><span class="keyword">if</span> data:</span><br><span class="line">    <span class="built_in">print</span>(data.group())  <span class="comment"># &quot;逗2B&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>sub，替换匹配成功的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.sub(<span class="string">&quot;\dB&quot;</span>, <span class="string">&quot;沙雕&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data) <span class="comment"># 逗沙雕最逗沙雕欢乐</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.sub(<span class="string">&quot;\dB&quot;</span>, <span class="string">&quot;沙雕&quot;</span>, text, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(data) <span class="comment"># 逗沙雕最逗3B欢乐</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>split，根据匹配成功的位置分割</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.split(<span class="string">&quot;\dB&quot;</span>, text)</span><br><span class="line"><span class="built_in">print</span>(data) <span class="comment"># [&#x27;逗&#x27;, &#x27;最逗&#x27;, &#x27;欢乐&#x27;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.split(<span class="string">&quot;\dB&quot;</span>, text, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(data) <span class="comment"># [&#x27;逗&#x27;, &#x27;最逗3B欢乐&#x27;]</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>finditer</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.finditer(<span class="string">&quot;\dB&quot;</span>, text)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">    <span class="built_in">print</span>(item.group())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;逗2B最逗3B欢乐&quot;</span></span><br><span class="line">data = re.finditer(<span class="string">&quot;(?P&lt;xx&gt;\dB)&quot;</span>, text)  <span class="comment"># 命名分组</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">    <span class="built_in">print</span>(item.groupdict())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;dsf130429191912015219k13042919591219521Xkk&quot;</span></span><br><span class="line">data_list = re.finditer(<span class="string">&quot;\d&#123;6&#125;(?P&lt;year&gt;\d&#123;4&#125;)(?P&lt;month&gt;\d&#123;2&#125;)(?P&lt;day&gt;\d&#123;2&#125;)\d&#123;3&#125;[\d|X]&quot;</span>, text)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> data_list:</span><br><span class="line">    info_dict = item.groupdict()</span><br><span class="line">    <span class="built_in">print</span>(info_dict)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>到此，关于最常见的内置模块就全部讲完了（共11个），现阶段只需要掌握这些模块的使用即可，在后续的课程和练习题中也会涉及到一起其他内置模块。</p>
<ul>
<li>os</li>
<li>shutil</li>
<li>sys</li>
<li>random</li>
<li>hashlib</li>
<li>configparser</li>
<li>xml</li>
<li>json</li>
<li>time</li>
<li>datetime</li>
<li>re</li>
</ul>
<h2 id="2-项目开发规范"><a href="#2-项目开发规范" class="headerlink" title="2. 项目开发规范"></a>2. 项目开发规范</h2><p>现阶段，我们在开发一些程序时（终端运行），应该遵循一些结构的规范，让你的系统更加专业。</p>
<h3 id="2-1-单文件应用"><a href="#2-1-单文件应用" class="headerlink" title="2.1 单文件应用"></a>2.1 单文件应用</h3><p>当基于python开发简单应用时（一个py文件就能搞定），需要注意如下几点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">文件注释</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> openpyxl <span class="keyword">import</span> load_workbook</span><br><span class="line"></span><br><span class="line">DB = <span class="string">&quot;XXX&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_something</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 函数注释 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># TODO 待完成时，下一期实现xxx功能</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 函数注释 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对功能代码进行注释</span></span><br><span class="line">    text = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>



<img src="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/image-20210105160728297.png" alt="image-20210105160728297" style="zoom:50%;">





<h3 id="2-2-单可执行文件"><a href="#2-2-单可执行文件" class="headerlink" title="2.2 单可执行文件"></a>2.2 单可执行文件</h3><p>新创建一个项目，假设名字叫 【crm】，可以创建如下文件和文件夹来存放代码和数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">crm</span><br><span class="line">├── app.py        文件，程序的主文件（尽量精简）</span><br><span class="line">├── config.py     文件，配置文件（放相关配置信息，代码中读取配置信息，如果想要修改配置，即可以在此修改，不用再去代码中逐一修改了）</span><br><span class="line">├── db            文件夹，存放数据</span><br><span class="line">├── files         文件夹，存放文件</span><br><span class="line">├── src           包，业务处理的代码</span><br><span class="line">└── utils         包，公共功能</span><br></pre></td></tr></table></figure>

<p>示例程序见附件：crm.zip</p>
<p><img src="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/image-20210105163335127.png" alt="image-20210105163335127"></p>
<h3 id="2-3-多可执行文件"><a href="#2-3-多可执行文件" class="headerlink" title="2.3 多可执行文件"></a>2.3 多可执行文件</h3><p>新创建项目，假设名称叫【killer】，可以创建如下文件和文件夹来存放代码和数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">killer</span><br><span class="line">├── bin					文件夹，存放多个主文件（可运行）</span><br><span class="line">│   ├── app1.py</span><br><span class="line">│   └── app2.py</span><br><span class="line">├── config              包，配置文件</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   └── settings.py</span><br><span class="line">├── db                  文件夹，存放数据</span><br><span class="line">├── files               文件夹，存放文件</span><br><span class="line">├── src                 包，业务代码</span><br><span class="line">│   └── __init__.py</span><br><span class="line">└── utils               包，公共功能</span><br><span class="line">    └── __init__.py</span><br></pre></td></tr></table></figure>



<p>示例程序见附件：killer.zip</p>
<p><img src="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/image-20210105164740583.png" alt="image-20210105164740583"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>json格式和json模块</li>
<li>json模块处理特殊的数据类型</li>
<li>datetime格式与字符串、时间戳以及相关之间的转换。</li>
<li>datetime格式时间与timedelta的加减。</li>
<li>两个datetime相减可以计算时间间隔，得到的是一个timedelta格式的时间。</li>
<li>了解正则表达式的编写方式和python中re模块的使用。</li>
<li>项目开发规范。</li>
</ol>
<h2 id="作业：开发短视频资讯平台"><a href="#作业：开发短视频资讯平台" class="headerlink" title="作业：开发短视频资讯平台"></a>作业：开发短视频资讯平台</h2><ul>
<li><p>有video.csv视频库文件，其中有999条短视频数据，格式如下：【 video.csv 文件已为大家提供好，在day15课件目录下。 】</p>
<p><img src="/2024/09/07/python_course-master/day15%20%E5%86%85%E7%BD%AE%E5%92%8C%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/%E7%AC%94%E8%AE%B0/day15/image-20210105223331765.png" alt="image-20210105223331765"></p>
</li>
<li><p>项目的核心功能有：</p>
<ul>
<li><p>分页看新闻（每页显示10条），提示用户输入页码，根据页码显示指定页面的数据。</p>
<ul>
<li>提示用户输入页码，根据页码显示指定页面的数据。</li>
<li>当用户输入的页码不存在时，默认显示第1页</li>
</ul>
</li>
<li><p>搜索专区</p>
<ul>
<li>用户输入关键字，根据关键词筛选出所有匹配成功的短视频资讯。</li>
<li>支持的搜索两种搜索格式：<ul>
<li><code>id=1715025</code>，筛选出id等于1715025的视频（video.csv的第一列）。</li>
<li><code>key=文本</code>，模糊搜索，筛选包含关键字的所有新闻（video.csv的第二列）。</li>
</ul>
</li>
</ul>
</li>
<li><p>下载专区</p>
<ul>
<li><p>用户输入视频id，根据id找到对应的mp4视频下载地址，然后下载视频到项目的files目录。</p>
<ul>
<li><p>视频的文件名为：<code>视频id-年-月-日-时-分-秒.mp4</code></p>
</li>
<li><p>视频下载代码示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">res = requests.get(</span><br><span class="line">    url=<span class="string">&#x27;https://video.pearvideo.com/mp4/adshort/20210105/cont-1715046-15562045_adpkg-ad_hd.mp4&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 视频总大小（字节）</span></span><br><span class="line">file_size = <span class="built_in">int</span>(res.headers[<span class="string">&#x27;Content-Length&#x27;</span>])</span><br><span class="line"></span><br><span class="line">download_size = <span class="number">0</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;xxx.mp4&#x27;</span>, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">    <span class="comment"># 分块读取下载的视频文件（最多一次读128字节），并逐一写入到文件中。 len(chunk)表示实际读取到每块的视频文件大小。</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> res.iter_content(<span class="number">128</span>):</span><br><span class="line">        download_size += <span class="built_in">len</span>(chunk)</span><br><span class="line">        file_object.write(chunk)</span><br><span class="line">        file_object.flush()</span><br><span class="line">        message = <span class="string">&quot;视频总大小为：&#123;&#125;字节，已下载&#123;&#125;字节。&quot;</span>.<span class="built_in">format</span>(file_size, download_size)</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line">    file_object.close()</span><br><span class="line"></span><br><span class="line">res.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载的过程中，输出已下载的百分比，示例代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;正在下载中...&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>):</span><br><span class="line">    text = <span class="string">&quot;\r&#123;&#125;%&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">    <span class="built_in">print</span>(text, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n下载完成&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="附赠"><a href="#附赠" class="headerlink" title="附赠"></a>附赠</h2><p>自动采集梨视频1000条资讯的爬虫脚本。<span style="color:red;">梨视频平台系统更新后可能会导致下载失败，到时候需根据平台调整再来修改代码。</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">下载梨视频的：视频ID，视频标题，视频URL地址 并写入到本次 video.csv 文件中。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">运行此脚本需要预先安装：</span></span><br><span class="line"><span class="string">    pip install request</span></span><br><span class="line"><span class="string">    pip install beautifulsoup4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_mp4_url</span>(<span class="params">video_id</span>):</span><br><span class="line">    data = requests.get(</span><br><span class="line">        url=<span class="string">&quot;https://www.pearvideo.com/videoStatus.jsp?contId=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(video_id),</span><br><span class="line">        headers=&#123;</span><br><span class="line">            <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://www.pearvideo.com/video_&#123;&#125;&quot;</span>.<span class="built_in">format</span>(video_id),</span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">    response = data.json()</span><br><span class="line">    image_url = response[<span class="string">&#x27;videoInfo&#x27;</span>][<span class="string">&#x27;video_image&#x27;</span>]</span><br><span class="line">    video_url = response[<span class="string">&#x27;videoInfo&#x27;</span>][<span class="string">&#x27;videos&#x27;</span>][<span class="string">&#x27;srcUrl&#x27;</span>]</span><br><span class="line">    middle = image_url.rsplit(<span class="string">&#x27;/&#x27;</span>, <span class="number">1</span>)[-<span class="number">1</span>].rsplit(<span class="string">&#x27;-&#x27;</span>, <span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">    before, after = video_url.rsplit(<span class="string">&#x27;/&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">    suffix = after.split(<span class="string">&#x27;-&#x27;</span>, <span class="number">1</span>)[-<span class="number">1</span>]</span><br><span class="line">    url = <span class="string">&quot;&#123;&#125;/&#123;&#125;-&#123;&#125;&quot;</span>.<span class="built_in">format</span>(before, middle, suffix)</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_video</span>():</span><br><span class="line">    file_object = <span class="built_in">open</span>(<span class="string">&#x27;video.csv&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt;= <span class="number">999</span>:</span><br><span class="line">        res = requests.get(</span><br><span class="line">            url=<span class="string">&quot;https://www.pearvideo.com/category_loading.jsp?reqType=14&amp;categoryId=&amp;start=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(count)</span><br><span class="line">        )</span><br><span class="line">        bs = BeautifulSoup(res.text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">        a_list = bs.find_all(<span class="string">&quot;a&quot;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&quot;vervideo-lilink&quot;</span>&#125;)</span><br><span class="line">        <span class="keyword">for</span> tag <span class="keyword">in</span> a_list:</span><br><span class="line">            title = tag.find(<span class="string">&#x27;div&#x27;</span>, attrs=&#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&quot;vervideo-title&quot;</span>&#125;).text.strip()</span><br><span class="line">            video_id = tag.get(<span class="string">&#x27;href&#x27;</span>).split(<span class="string">&#x27;_&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            mp4_url = get_mp4_url(video_id)</span><br><span class="line">            row = <span class="string">&quot;&#123;&#125;,&#123;&#125;,&#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(video_id, title, mp4_url)</span><br><span class="line">            file_object.write(row)</span><br><span class="line">            file_object.flush()</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            message = <span class="string">&quot;已下载&#123;&#125;个&quot;</span>.<span class="built_in">format</span>(count)</span><br><span class="line">            <span class="built_in">print</span>(message)</span><br><span class="line">    file_object.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    download_video()</span><br></pre></td></tr></table></figure>
































































      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="陈永辉"
      src="https://image-cdn.hypb.st/https%3A%2F%2Fhypebeast.com%2Fwp-content%2Fblogs.dir%2F4%2Ffiles%2F2022%2F01%2Fnft-bored-ape-yacht-club-floor-price-100-eth-1.jpg?cbr=1&q=90">
  <p class="site-author-name" itemprop="name">陈永辉</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/cyhzuishuai" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cyhzuishuai" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/2426230801@qq.com" title="E-Mail → 2426230801@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/chenyonghuizui" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;chenyonghuizui" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈永辉</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共126.9k字</span>
</div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
